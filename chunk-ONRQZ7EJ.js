import"./chunk-BWMDETH3.js";import"./chunk-IIQXVS3T.js";import"./chunk-MNY2MIHO.js";import"./chunk-HSDYLB3Q.js";import"./chunk-54MZDVJV.js";import"./chunk-6SS4OFH7.js";import{c as ne}from"./chunk-VNQ7656W.js";import"./chunk-7HPKGXFV.js";import{c as oe}from"./chunk-ZUQEKNDW.js";import"./chunk-NVIMVT2T.js";import{l as re}from"./chunk-UCUMTS2Y.js";import"./chunk-INKIBVR7.js";import"./chunk-YPXKXPEB.js";import"./chunk-WATD7KOW.js";import{a as te,b as ie}from"./chunk-JRLPXEVI.js";import"./chunk-2GZLITG5.js";import{c as k,e as Q,f as K,k as W,l as X,o as Y,q as Z,s as ee}from"./chunk-BJV7KTFY.js";import"./chunk-JA5JV2TR.js";import"./chunk-GTN2YQGD.js";import{a as ae}from"./chunk-SFQLGEEG.js";import"./chunk-AII6RJAH.js";import{l as U,m as z,v as J}from"./chunk-GONTSOGY.js";import{Gb as l,Hb as T,Ia as V,Na as s,Ob as L,P as D,S as O,Vb as H,W as M,Wb as $,Za as B,aa as h,db as p,fa as N,fb as d,hb as _,jb as E,kb as A,mb as q,nb as G,o as y,ob as o,pa as v,pb as i,qa as x,qb as f,ra as C,rb as R,sa as b,sb as j,u as w,ub as I,xb as g,yb as m}from"./chunk-Y7HHJWJT.js";import{a as F,b as P}from"./chunk-MON7YFGF.js";var le=(()=>{let c=class c{constructor(){this.teacherService=h(re),this.commonService=h(ae)}getTeacherInfo(){return this.teacherService.apiTeacherInfoGet().pipe(y(e=>e.data))}getNationOptions(){return this.commonService.apiCommonOptionsNationGet().pipe(y(e=>e.data))}getTagOptions(){return this.commonService.apiCommonTagGet().pipe(y(e=>e.data))}formatTeacherData(e,a,t){let u=e.categories.map(S=>this.transTopicNameToId(S.category_id,a));return{introduction:e.introduction,nationality:this.transNationNameToId(e.nationality,t),topicControl:u,categories:e.categories}}transNationNameToId(e,a){return a.find(u=>u.label===e)?.value||""}transNationIdToName(e,a){return a.find(u=>u.value===e)?.label||""}transTopicNameToId(e,a){return a.find(u=>u.value===e)?.value||""}saveBaseInfo(e,a){let t={patchTeacherInfoBasicRequestModel:{nationality:this.transNationIdToName(e.nationality,a)??"",introduction:e.introduction??"",categories:e.categories}};return this.teacherService.apiTeacherInfoBasicPatch(t)}};c.\u0275fac=function(a){return new(a||c)},c.\u0275prov=M({token:c,factory:c.\u0275fac,providedIn:"root"});let n=c;return n})();function se(n,c){if(n&1){let r=I();o(0,"button",12),g("click",function(a){v(r);let t=m();return x(t.handleEditMode(a,"basicInfo"))}),l(1," \u7DE8\u8F2F "),i()}}function de(n,c){if(n&1){let r=I();o(0,"div",5)(1,"button",13),g("click",function(a){v(r);let t=m();return x(t.handleSave(a,"basicInfo"))}),l(2," \u5132\u5B58 "),i(),o(3,"button",12),g("click",function(a){v(r);let t=m();return x(t.handleCancel(a,"basicInfo"))}),l(4," \u53D6\u6D88 "),i()()}}function ue(n,c){if(n&1&&(o(0,"span"),l(1),i()),n&2){let r=m(2);s(),T(r.baseInfo().nationality)}}function me(n,c){if(n&1&&f(0,"tmf-option",20),n&2){let r=c.$implicit;d("value",r.value)("label",r.label)}}function pe(n,c){if(n&1&&(o(0,"tmf-select",18),p(1,me,1,2,"tmf-option",19),i()),n&2){let r=m(2);d("isRequired",!0)("multiSelect",!1),s(),d("ngForOf",r.nationOptions)}}function fe(n,c){if(n&1&&(o(0,"li")(1,"span"),l(2),H(3,"tmfCategory"),i(),l(4,"\uFF1A"),o(5,"span"),l(6),i()()),n&2){let r=c.$implicit;s(2),T($(3,2,r.category_id)),s(4),T(r.sub_categories==null?null:r.sub_categories.join(", "))}}function ge(n,c){if(n&1&&(o(0,"ul"),q(1,fe,7,4,"li",null,A),i()),n&2){let r=m(2);s(),G(r.baseInfo().categories)}}function _e(n,c){if(n&1&&f(0,"tmf-option",20),n&2){let r=c.$implicit,e=m(3);_("selected",e.fg.controls.topicControl.value==null?null:e.fg.controls.topicControl.value.includes(r.value)),d("value",r.value)("label",r.main_category)}}function he(n,c){if(n&1&&f(0,"tmf-option",20),n&2){let r=c.$implicit,e=m().$implicit;_("selected",e.controls.sub_categories.value==null?null:e.controls.sub_categories.value.includes(r)),d("value",r)("label",r)}}function ve(n,c){if(n&1&&(R(0),o(1,"tmf-select",27),p(2,he,1,4,"tmf-option",22),i(),j()),n&2){let r=c.$implicit,e=m(3);s(),d("label",e.getCategoryLabel(r.controls.category_id.value))("multiSelect",!0)("maxSelected",3)("isRequired",!0)("formControl",r.controls.sub_categories),s(),d("ngForOf",e.getSubCategoryOptions(r.controls.category_id.value))}}function xe(n,c){if(n&1){let r=I();o(0,"div")(1,"tmf-select",21),g("selectChange",function(a){v(r);let t=m(2);return x(t.handleCategoryChange(a))}),p(2,_e,1,4,"tmf-option",22),i(),o(3,"div",23)(4,"span",24),l(5,"\u6559\u5B78\u5C08\u9577"),i(),o(6,"span",25),l(7,"*\u76E1\u53EF\u80FD\u9078\u64C7\u71B1\u9580\u5C08\u9577\uFF0C\u4EE5\u7372\u5F97\u66F4\u591A\u62DB\u751F\u6A5F\u6703(3\u9805/\u79D1\u76EE)\u3002"),i()(),p(8,ve,3,6,"ng-container",26),i()}if(n&2){let r=m(2);s(),d("formControl",r.fg.controls.topicControl)("isRequired",!0)("multiSelect",!0)("maxSelected",3),s(),d("ngForOf",r.tagOptions),s(6),d("ngForOf",r.fg.controls.categories.controls)}}function Ce(n,c){if(n&1&&f(0,"p",17),n&2){let r=m(2);d("innerHTML",r.baseInfo().introduction,V)}}function Se(n,c){if(n&1){let r=I();o(0,"tmf-quill-editor",28),g("contentChangeEvent",function(a){v(r);let t=m(2);return x(t.fg.controls.introduction.setValue(a))}),i()}if(n&2){let r=m(2);d("isRequired",!0)("diabled",!r.editMode().basicInfo)("defaultContent",r.baseInfo().introduction)}}function be(n,c){if(n&1&&(o(0,"div",14)(1,"div",15)(2,"label",16),l(3,"\u570B\u7C4D"),i(),p(4,ue,2,1,"span")(5,pe,2,3),i(),o(6,"div",15)(7,"label",16),l(8,"\u6559\u5B78\u5C08\u9577"),i(),p(9,ge,3,0,"ul")(10,xe,9,6),i(),o(11,"div",15)(12,"label",16),l(13,"\u81EA\u6211\u4ECB\u7D39"),i(),p(14,Ce,1,1,"p",17)(15,Se,1,3),i()()),n&2){let r=m();d("formGroup",r.fg),s(4),E(4,r.editMode().basicInfo?5:4),s(5),E(9,r.editMode().basicInfo?10:9),s(5),E(14,r.editMode().basicInfo?15:14)}}function Ee(n,c){n&1&&(o(0,"div",15)(1,"div",29)(2,"span"),l(3,"2018 \u5E74 9 \u6708"),i(),o(4,"span"),l(5,"\u81F3"),i(),o(6,"span"),l(7,"2020\u5E746\u6708"),i()(),o(8,"div",30)(9,"div"),l(10,"\u53F0\u5317"),i(),o(11,"div"),l(12,"\u5D07\u97F3\u5275\u85DD\u97F3\u6A02\u5DE5\u4F5C\u5BA4"),i(),o(13,"div"),l(14,"\u97F3\u6A02\u6559\u80B2"),i(),o(15,"div"),l(16,"\u5409\u4ED6\u8B1B\u5E2B"),i()()())}function Ie(n,c){n&1&&(o(0,"div",15)(1,"div",29)(2,"span"),l(3,"2018 \u5E74 9 \u6708"),i(),o(4,"span"),l(5,"\u81F3"),i(),o(6,"span"),l(7,"2020\u5E746\u6708"),i()(),o(8,"div",30)(9,"div"),l(10,"\u53F0\u5317"),i(),o(11,"div"),l(12,"\u570B\u7ACB\u53F0\u7063\u85DD\u8853\u5927\u5B78"),i(),o(13,"div"),l(14,"\u97F3\u6A02\u5B78\u7CFB"),i(),o(15,"div"),l(16,"\u5B78\u58EB"),i()()())}function ye(n,c){n&1&&(o(0,"div",15)(1,"label",16),l(2,"\u97F3\u6A02"),i(),o(3,"span"),l(4,"\u5409\u4ED6"),i()())}function Te(n,c){n&1&&f(0,"div",31)}var $e=(()=>{let c=class c{constructor(){this.teacherInfoPageService=h(le),this.fb=h(Z),this.tagOptions=[],this.nationOptions=[],this.expandedSections={basicInfo:!0,workExperience:!0,education:!0,teaching:!0,video:!0},this.baseInfo=B({nationality:"",introduction:"",categories:[]}),this.editMode=B({basicInfo:!1,workExperience:!1,education:!1,teaching:!1,video:!1}),this.fg=this.fb.group({introduction:[""],nationality:[""],topicControl:[[]],categories:this.fb.array([])})}ngOnInit(){w({options:w({tags:this.teacherInfoPageService.getTagOptions(),nations:this.teacherInfoPageService.getNationOptions()}),teacherInfo:this.teacherInfoPageService.getTeacherInfo()}).subscribe(({options:e,teacherInfo:a})=>{this.tagOptions=e.tags.map(t=>({value:t._id,main_category:t.main_category,sub_category:t.sub_category})),this.nationOptions=e.nations,this.teacherInfo=a,this.baseInfo.set({nationality:this.teacherInfo.nationality,introduction:this.teacherInfo.introduction,categories:this.teacherInfo.categories}),this.initForm()})}initForm(){let e=this.prepareFormData();this.updateFormValues(e)}prepareFormData(){return this.teacherInfoPageService.formatTeacherData(this.teacherInfo,this.tagOptions,this.nationOptions)}updateFormValues(e){this.fg.patchValue({introduction:e.introduction,nationality:e.nationality,topicControl:e.topicControl}),this.handleCategoryChange(e.topicControl),this.updateSubCategories(e.categories)}updateSubCategories(e){e.forEach(a=>{let t=this.transTopicNameToId(a.category_id),u=this.fg.controls.categories.controls.find(S=>S.get("category_id")?.value===t);u&&u.patchValue({sub_categories:a.sub_categories})})}handleCategoryChange(e){let a=this.fg.controls.categories,t=new Set(e);this.removeUnusedCategories(a,t),this.addNewCategories(e,a)}removeUnusedCategories(e,a){for(let t=e.controls.length-1;t>=0;t--){let u=e.controls[t];a.has(u.get("category_id")?.value)||e.removeAt(t)}}addNewCategories(e,a){e.forEach(t=>{a.controls.some(S=>S.get("category_id")?.value===t)||a.push(this.fb.group({category_id:this.fb.control(t,[k.required]),sub_categories:this.fb.control([],[k.required])}))})}getCategoryLabel(e){return this.tagOptions.find(t=>t.value===e)?.main_category||""}getSubCategoryOptions(e){return this.tagOptions.find(t=>t.value===e)?.sub_category||[]}transTopicNameToId(e){return this.tagOptions.find(t=>t.value===e)?.value||""}toggleSection(e){this.expandedSections[e]=!this.expandedSections[e]}handleSave(e,a){switch(e.stopPropagation(),a){case"basicInfo":this.teacherInfoPageService.saveBaseInfo(this.fg.value,this.nationOptions).pipe(D(()=>this.teacherInfoPageService.getTeacherInfo()),O(t=>{this.teacherInfo=t,this.baseInfo.set({nationality:this.teacherInfo.nationality,introduction:this.teacherInfo.introduction,categories:this.teacherInfo.categories}),this.handleCancel(e,"basicInfo")})).subscribe();break}}handleCancel(e,a){e.stopPropagation(),this.editMode.set(P(F({},this.editMode()),{[a]:!1}))}handleEditMode(e,a){e.stopPropagation(),this.editMode.set(P(F({},this.editMode()),{[a]:!this.editMode()[a]}))}};c.\u0275fac=function(a){return new(a||c)},c.\u0275cmp=N({type:c,selectors:[["app-teacher-info-page"]],standalone:!0,features:[L],decls:53,vars:16,consts:[[1,"mb-6","text-3xl","font-bold","text-tmf-gray-1"],[1,"container","mx-auto","max-w-7xl","px-6"],[1,"mb-6","rounded-lg","bg-white","p-6","shadow-md"],[1,"mb-4","flex","cursor-pointer","items-center","justify-between",3,"click"],[1,"text-lg","font-bold"],[1,"flex","items-center"],[1,"mr-2","rounded","bg-gray-100","px-4","py-2","hover:bg-gray-200"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","transition-transform","duration-200"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],["class","space-y-4",3,"formGroup",4,"ngIf"],["class","flex",4,"ngIf"],["class","flex min-h-[200px] items-center justify-center rounded border-2 border-dashed border-gray-300",4,"ngIf"],[1,"mr-2","rounded","bg-gray-100","px-4","py-2","hover:bg-gray-200",3,"click"],[1,"mr-2","rounded","bg-tmf-orange-1","px-4","py-2","text-white",3,"click"],[1,"space-y-4",3,"formGroup"],[1,"flex"],[1,"min-w-[120px]","font-medium"],[1,"whitespace-pre-line","leading-relaxed",3,"innerHTML"],["label","\u570B\u5BB6","formControlName","nationality",1,"bg-white","text-gray-700",3,"isRequired","multiSelect"],[3,"value","label",4,"ngFor","ngForOf"],[3,"value","label"],["label","\u6559\u6388\u79D1\u76EE","info","*\u60A8\u6700\u591A\u53EA\u80FD\u6559\u6388\u4E09\u7A2E\u79D1\u76EE",1,"bg-white","text-gray-700",3,"selectChange","formControl","isRequired","multiSelect","maxSelected"],[3,"selected","value","label",4,"ngFor","ngForOf"],[1,"flex","flex-col"],[1,"mb-1","ml-1","inline-block","text-sm","font-medium","text-tmf-gray-2","md:text-[15px]","md:leading-6"],[1,"mb-2","ml-1","text-sm","text-gray-500"],[4,"ngFor","ngForOf"],[1,"bg-white","text-gray-700",3,"label","multiSelect","maxSelected","isRequired","formControl"],["label","\u6587\u7AE0\u5167\u6587","height","400px",1,"mb-6",3,"contentChangeEvent","isRequired","diabled","defaultContent"],[1,"min-w-[200px]","space-x-2"],[1,"space-y-2"],[1,"flex","min-h-[200px]","items-center","justify-center","rounded","border-2","border-dashed","border-gray-300"]],template:function(a,t){a&1&&(o(0,"h1",0),l(1,"\u8001\u5E2B\u500B\u4EBA\u8CC7\u8A0A"),i(),o(2,"div",1)(3,"div",2)(4,"div",3),g("click",function(){return t.toggleSection("basicInfo")}),o(5,"h2",4),l(6,"\u57FA\u672C\u8CC7\u6599"),i(),o(7,"div",5),p(8,se,2,0,"button",6)(9,de,5,0),C(),o(10,"svg",7),f(11,"path",8),i()()(),p(12,be,16,4,"div",9),i(),b(),o(13,"div",2)(14,"div",3),g("click",function(){return t.toggleSection("workExperience")}),o(15,"h2",4),l(16,"\u5DE5\u4F5C\u7D93\u9A57"),i(),o(17,"div",5)(18,"button",6),l(19," \u7DE8\u8F2F "),i(),C(),o(20,"svg",7),f(21,"path",8),i()()(),p(22,Ee,17,0,"div",10),i(),b(),o(23,"div",2)(24,"div",3),g("click",function(){return t.toggleSection("education")}),o(25,"h2",4),l(26,"\u5B78\u6B77\u80CC\u666F"),i(),o(27,"div",5)(28,"button",6),l(29," \u7DE8\u8F2F "),i(),C(),o(30,"svg",7),f(31,"path",8),i()()(),p(32,Ie,17,0,"div",10),i(),b(),o(33,"div",2)(34,"div",3),g("click",function(){return t.toggleSection("teaching")}),o(35,"h2",4),l(36,"\u6559\u5B78\u8B49\u7167"),i(),o(37,"div",5)(38,"button",6),l(39," \u7DE8\u8F2F "),i(),C(),o(40,"svg",7),f(41,"path",8),i()()(),p(42,ye,5,0,"div",10),i(),b(),o(43,"div",2)(44,"div",3),g("click",function(){return t.toggleSection("video")}),o(45,"h2",4),l(46,"\u81EA\u6211\u4ECB\u7D39\u5F71\u7247"),i(),o(47,"div",5)(48,"button",6),l(49," \u7DE8\u8F2F "),i(),C(),o(50,"svg",7),f(51,"path",8),i()()(),p(52,Te,1,0,"div",11),i()()),a&2&&(s(8),E(8,t.editMode().basicInfo?9:8),s(2),_("rotate-180",!t.expandedSections.basicInfo),s(2),d("ngIf",t.expandedSections.basicInfo),s(8),_("rotate-180",!t.expandedSections.workExperience),s(2),d("ngIf",t.expandedSections.workExperience),s(8),_("rotate-180",!t.expandedSections.education),s(2),d("ngIf",t.expandedSections.education),s(8),_("rotate-180",!t.expandedSections.teaching),s(2),d("ngIf",t.expandedSections.teaching),s(8),_("rotate-180",!t.expandedSections.video),s(2),d("ngIf",t.expandedSections.video))},dependencies:[J,U,z,ie,te,ee,Q,K,W,X,Y,ne,oe],encapsulation:2});let n=c;return n})();export{$e as default};

import{a as _e,b as Ie}from"./chunk-NTRBR66U.js";import{a as Ze}from"./chunk-UXYCZJ7K.js";import{a as rt}from"./chunk-UZIKW5L7.js";import{a as Ee}from"./chunk-CRTFZ5AR.js";import{a as it,b as nt,c as ot,d as xe}from"./chunk-EM2JKLY3.js";import{c as et,d as tt,e as be}from"./chunk-A333B47I.js";import"./chunk-KTGNIIQT.js";import{a as fe,d as he}from"./chunk-K4X6AKXN.js";import{e as ye,j as Se,n as we,o as Te}from"./chunk-T2S3BQ7X.js";import"./chunk-DCCBA6JN.js";import"./chunk-A6ZGQ5H3.js";import{a as ge,b as Ce}from"./chunk-GEWNISP5.js";import"./chunk-HDY35ZES.js";import{a as W,b as We,c as ee,e as U,f as le,g as se,h as Qe,i as Je,k as de,l as ue,o as ce,p as me,q as pe,r as Xe,s as Q}from"./chunk-J7X6Y7TH.js";import"./chunk-5AZTXUOI.js";import"./chunk-PDG62EJG.js";import{a as ve}from"./chunk-WALOVNFW.js";import"./chunk-ZYSDU26P.js";import{k as B,l as ae,m as Y,r as Ye,v as V}from"./chunk-QWUFOH72.js";import{Ba as Ke,Fb as N,Gb as d,Hb as T,Ib as F,Ja as re,Jb as je,Kb as Oe,Lb as Pe,Mb as ke,Na as s,Nb as j,O as Fe,Ob as I,P as Ae,Qb as w,Rb as z,S as De,V as $,Za as Z,Zb as ze,aa as b,db as _,ea as Re,fa as E,fb as u,gb as $e,jb as x,k as ne,lb as A,mb as D,nb as R,nc as Le,oa as He,ob as a,pa as f,pb as l,qa as h,qb as v,tb as Me,u as Ge,ub as y,xb as p,ya as oe,yb as c,za as Be}from"./chunk-NYBVSAW5.js";import{a as H,b as qe}from"./chunk-MON7YFGF.js";var te=function(e){return e.Name="name",e.Published="published",e}(te||{}),q=function(e){return e[e.DRAFT=0]="DRAFT",e[e.PUBLISHED=1]="PUBLISHED",e[e.UNPUBLISHED=2]="UNPUBLISHED",e}(q||{}),Ne=function(e){return e.View="view",e.Edit="edit",e.Delete="delete",e}(Ne||{}),ie=function(e){return e.Published="published",e.Unpublished="unpublished",e}(ie||{});var yt=e=>({text:"\u540D\u7A31",column:e}),at=e=>({$implicit:e}),St=e=>({text:"\u4E0A/\u4E0B\u67B6",column:e});function wt(e,r){e&1&&Me(0)}function Tt(e,r){e&1&&Me(0)}function Et(e,r){if(e&1&&v(0,"img",14),e&2){let o=c().$implicit;u("src",o.main_image,re)}}function It(e,r){if(e&1&&(a(0,"div",17),d(1),l()),e&2){let o=c().$implicit;s(),F(" ",o.main_category," ")}}function Vt(e,r){if(e&1&&(a(0,"div",17),d(1),l()),e&2){let o=c().$implicit;s(),F(" ",o.sub_category," ")}}function Ft(e,r){e&1&&(a(0,"p"),d(1,"\u672A\u9078\u64C7\u985E\u5225"),l())}function At(e,r){if(e&1){let o=y();a(0,"tmf-switch",23),p("valeuChange",function(){f(o);let i=c().$index,n=c();return h(n.togglePublished(i))}),l()}if(e&2){let o=c().$index,t=c();u("formControl",t.publishedArray.controls[o])}}function Dt(e,r){if(e&1){let o=y();a(0,"button",20),p("click",function(){f(o);let i=c().$implicit,n=c();return h(n.handleAction({type:n.ActionType.Edit,data:i}))}),d(1," \u7DE8\u8F2F "),l()}}function Rt(e,r){if(e&1){let o=y();a(0,"tr")(1,"td",12)(2,"div",13),_(3,Et,1,1,"img",14),l()(),a(4,"td",12)(5,"p",15),d(6),l()(),a(7,"td",12)(8,"div",16),_(9,It,2,1,"div",17)(10,Vt,2,1,"div",17)(11,Ft,2,0,"p"),l()(),a(12,"td",12)(13,"div",11),_(14,At,1,1,"tmf-switch",18),l()(),a(15,"td",12)(16,"div",19)(17,"button",20),p("click",function(){let i=f(o).$implicit,n=c();return h(n.handleAction({type:n.ActionType.View,data:i}))}),d(18," \u6AA2\u8996 "),l(),_(19,Dt,2,0,"button",21),a(20,"button",22),p("click",function(){let i=f(o).$implicit,n=c();return h(n.handleAction({type:n.ActionType.Delete,data:i}))}),d(21," \u522A\u9664 "),l()()()()}if(e&2){let o=r.$implicit,t=r.$index,i=c();s(3),x(3,o.main_image?3:-1),s(3),F(" ",o.name," "),s(3),x(9,o.main_category?9:-1),s(),x(10,o.sub_category?10:-1),s(),x(11,o.main_category&&o.sub_category?-1:11),s(3),u("ngIf",i.publishedArray.controls[t]),s(5),x(19,o.status!==i.CourseStatus.PUBLISHED?19:-1)}}function Bt(e,r){e&1&&(a(0,"span",5),d(1," arrow_upward_alt "),l())}function Mt(e,r){e&1&&(a(0,"span",5),d(1," arrow_downward_alt "),l())}function Ot(e,r){e&1&&(a(0,"span",5),d(1," swap_vert "),l())}function Pt(e,r){if(e&1){let o=y();a(0,"div",24),p("click",function(){let i=f(o).$implicit,n=c();return h(n.changeSort(i.column,n.sort()&&n.sort().split("-")[1]==="asc"?"desc":"asc"))}),a(1,"p",9),d(2),l(),_(3,Bt,2,0)(4,Mt,2,0)(5,Ot,2,0),l()}if(e&2){let o,t=r.$implicit,i=c();s(2),T(t.text),s(),x(3,(o=i.sort())===t.column+"-asc"?3:o===t.column+"-desc"?4:5)}}var lt=(()=>{let r=class r{constructor(){this.dialogService=b(xe),this.teacherCourseService=b(Se),this.changeView=oe(),this.dataSource=[],this.sort=Z(null),this.publishedArray=new me([]),this.SortColumn=te,this.ViewMode=M,this.ActionType=Ne,this.CourseStatus=q}ngOnInit(){this.getAllCourses()}getAllCourses(){this.teacherCourseService.apiTeacherCourseCoursesGet().subscribe(t=>{this.dataSource=t.data,this.resetPublishedArray()})}resetPublishedArray(){this.publishedArray.clear(),this.dataSource.length&&this.dataSource.forEach(t=>{let i=new se(t.status===q.PUBLISHED);this.publishedArray.push(i),t.status===q.DRAFT&&i.disable()})}changeSort(t,i){if(this.sort.set(`${t}-${i}`),t===te.Name){let n=[...this.dataSource];n.sort((m,g)=>i==="asc"?m.name.localeCompare(g.name):g.name.localeCompare(m.name)),this.dataSource=n}else if(t===te.Published){let n=[...this.dataSource];n.sort((m,g)=>{let C=i==="asc"?1:-1;return(m.status-g.status)*C}),this.dataSource=n}this.resetPublishedArray()}togglePublished(t){let i=this.publishedArray.at(t);this.handlePublishedChange(i,{type:i.value?ie.Published:ie.Unpublished,courseId:this.dataSource[t].id})}handleAction(t){switch(t.type){case"view":this.changeView.emit({mode:M.View,courseId:t.data.id});break;case"edit":this.changeView.emit({mode:M.Edit,courseId:t.data.id});break;case"delete":this.dialogService.openConfirmDialog({title:"\u78BA\u5B9A\u8981\u522A\u9664\u55CE?",content:"\u522A\u9664\u5F8C\u5C07\u7121\u6CD5\u6062\u5FA9\uFF0C\u4F60\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F",confirmBtnText:"\u78BA\u5B9A\u522A\u9664",btnType:"danger"}).subscribe(i=>{i&&this.teacherCourseService.apiTeacherCourseCoursesCourseIdDelete({courseId:t.data.id}).subscribe(n=>this.getAllCourses())});break}}handlePublishedChange(t,i){i.type===ie.Published?this.teacherCourseService.apiTeacherCourseCoursesCourseIdUnpublishPost({courseId:i.courseId}).subscribe({next:n=>{this.getAllCourses(),t.setValue(!t.value)},error:n=>{this.dialogService.openAlertDialog({title:"\u767C\u751F\u932F\u8AA4",content:n.error.message}).closed.subscribe(()=>this.getAllCourses())}}):this.teacherCourseService.apiTeacherCourseCoursesCourseIdPublishPost({courseId:i.courseId}).subscribe({next:n=>{this.getAllCourses(),t.setValue(!t.value)},error:n=>{this.dialogService.openAlertDialog({title:"\u767C\u751F\u932F\u8AA4",content:n.error.message}).closed.subscribe(()=>this.getAllCourses())}})}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=E({type:r,selectors:[["app-course-table"]],outputs:{changeView:"changeView"},standalone:!0,features:[I],decls:31,vars:12,consts:[["sortTh",""],[1,"mb-5","flex","w-full","justify-between"],[1,"text-[22px]","font-bold","leading-9","md:text-[26px]","lg:text-[30px]"],[1,"flex","items-center","gap-x-2"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","px-3","py-2","text-white",3,"click"],[1,"material-symbols-outlined"],[1,"w-full","overflow-auto"],[1,"w-full","min-w-[768px]"],[1,"py-2"],[1,"flex","justify-start"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"flex","justify-center"],[1,"py-[2px]"],[1,"flex","justify-start","h-[112px]","w-[200px]","bg-tmf-gray-5","rounded-md"],["alt","\u8AB2\u7A0B\u5716",1,"h-full","w-full","rounded-md","object-cover",3,"src"],[1,"flex","justify-start","text-[16px]","leading-6","text-tmf-gray-2"],[1,"flex","justify-start","gap-2"],[1,"rounded","bg-tmf-gray-5","px-2","py-1"],[3,"formControl","valeuChange",4,"ngIf"],[1,"flex","flex-col","items-center","gap-y-2"],[1,"rounded","border","border-tmf-gray-3","px-2","py-1","text-[14px]","leading-5","text-tmf-gray-3","duration-100","hover:border-tmf-orange-1","hover:bg-tmf-orange-1","hover:text-white","active:scale-95",3,"click"],[1,"rounded","border","border-tmf-gray-3","px-2","py-1","text-[14px]","leading-5","text-tmf-gray-3","duration-100","hover:border-tmf-orange-1","hover:bg-tmf-orange-1","hover:text-white","active:scale-95"],[1,"rounded","border","border-red-500","px-2","py-1","text-[14px]","leading-5","text-red-500","duration-100","hover:bg-red-500","hover:text-white","active:scale-95",3,"click"],[3,"valeuChange","formControl"],[1,"flex","cursor-pointer","select-none","justify-center",3,"click"]],template:function(i,n){if(i&1){let m=y();a(0,"div",1)(1,"h1",2),d(2," \u8AB2\u7A0B\u7BA1\u7406 "),l(),a(3,"div",3)(4,"button",4),p("click",function(){return f(m),h(n.changeView.emit({mode:n.ViewMode.Create}))}),a(5,"span",5),d(6," add "),l(),d(7," \u65B0\u589E\u8AB2\u7A0B "),l()()(),a(8,"div",6)(9,"table",7)(10,"thead")(11,"tr")(12,"th",8)(13,"p",9),d(14,"\u8AB2\u7A0B\u5716"),l()(),a(15,"th",8)(16,"div",9),_(17,wt,1,0,"ng-container",10),l()(),a(18,"th",8)(19,"p",9),d(20,"\u985E\u5225"),l()(),a(21,"th",8),_(22,Tt,1,0,"ng-container",10),l(),a(23,"th",8)(24,"p",11),d(25,"\u64CD\u4F5C"),l()()()(),a(26,"tbody"),D(27,Rt,22,7,"tr",null,A),l()()(),_(29,Pt,6,2,"ng-template",null,0,ze)}if(i&2){let m=N(30);s(17),u("ngTemplateOutlet",m)("ngTemplateOutletContext",w(6,at,w(4,yt,n.SortColumn.Name))),s(5),u("ngTemplateOutlet",m)("ngTemplateOutletContext",w(10,at,w(8,St,n.SortColumn.Published))),s(5),R(n.dataSource)}},dependencies:[V,Y,Ye,Q,U,de,_e],styles:["[_nghost-%COMP%]{display:block;width:100%}"]});let e=r;return e})();var P=function(e){return e.NAME="name",e.MAIN_IMAGE="main_image",e.CONTENT="content",e.PRICE_QUANTITY="price_quantity",e.MAIN_CATEGORY="main_category",e.SUB_CATEGORY="sub_category",e.CITY_ID="city_id",e.DIST_ID="dist_id",e.SURVEY_URL="survey_url",e.STATUS="status",e.TEACHER_ID="teacher_id",e.PURCHASE_MESSAGE="purchase_message",e.VIDEO_IDS="video_ids",e.FILE_DETAILS="file_details",e.FILE_URL_DETAILS="file_url_details",e}(P||{});var kt=e=>({"cursor-not-allowed !bg-tmf-gray-5":e});function Lt(e,r){if(e&1&&(a(0,"div",9),v(1,"tmf-checkbox",10),a(2,"div",11),v(3,"tmf-video-card",12),a(4,"div",13)(5,"p")(6,"span",14),d(7,"\u540D\u7A31\uFF1A"),l(),a(8,"span"),d(9),l()(),a(10,"p")(11,"span",14),d(12,"\u985E\u5225\uFF1A"),l(),a(13,"span"),d(14),l()(),a(15,"p")(16,"span",14),d(17,"\u7C21\u4ECB\uFF1A"),l(),a(18,"span"),d(19),l()()()()()),e&2){let o=r.$implicit,t=r.$index,i=c(3);s(),u("formControl",i.chks.at(t)),s(2),u("data",o),s(6),T(o.name),s(5),T(o.category),s(5),T(o.intro)}}function Nt(e,r){if(e&1&&(a(0,"div",8),D(1,Lt,20,5,"div",9,A),l()),e&2){let o=c(2);s(),R(o.videos)}}function Ut(e,r){if(e&1&&_(0,Nt,3,0,"div",8),e&2){let o=c();x(0,o.chks?0:-1)}}function qt(e,r){if(e&1&&v(0,"tmf-option",18),e&2){let o=r.$implicit;u("value",o.main_category)("label",o.main_category||"")}}function Gt(e,r){if(e&1&&v(0,"tmf-input",25),e&2){let o=c(2);u("isRequired",!0)("formControlName",o.UploadFormKey.URL)("inputType",o.InputType.Outline)}}function Ht(e,r){if(e&1){let o=y();a(0,"p",21)(1,"span",22),d(2,"\u5F71\u7247\u6A94\u6848"),l(),a(3,"span",23),d(4,"*"),l()(),a(5,"div",26)(6,"button",27),p("click",function(){f(o);let i=N(11);return h(i.click())}),d(7," \u4E0A\u50B3\u6A94\u6848 "),l(),a(8,"p"),d(9),l()(),a(10,"input",28,0),p("change",function(i){f(o);let n=c(2);return h(n.hanldeVideoChange(i))}),l()}if(e&2){let o=c(2);s(9),T(o.currentFile==null?null:o.currentFile.name)}}function Kt(e,r){if(e&1&&(a(0,"div",15),v(1,"tmf-input",16),a(2,"tmf-select",17),D(3,qt,1,2,"tmf-option",18,A),l(),v(5,"tmf-textarea",19),a(6,"div",20)(7,"p",21)(8,"span",22),d(9,"\u5F71\u7247\u70BA\u5916\u90E8\u9023\u7D50"),l(),a(10,"span",23),d(11,"*"),l()(),v(12,"tmf-switch",24),l(),_(13,Gt,1,3,"tmf-input",25)(14,Ht,12,1),l()),e&2){let o=c();u("formGroup",o.uploadForm),s(),u("isRequired",!0)("formControlName",o.UploadFormKey.NAME)("inputType",o.InputType.Outline),s(),u("isRequired",!0)("formControlName",o.UploadFormKey.CATEGORY),s(),R(o.categoryOptions),s(2),u("isRequired",!0)("formControlName",o.UploadFormKey.INTRO),s(7),u("formControlName",o.UploadFormKey.VIDEO_TYPE),s(),x(13,o.videoType.value?13:14)}}var G=function(e){return e.Select="select",e.Upload="upload",e}(G||{}),k=function(e){return e.NAME="name",e.CATEGORY="category",e.INTRO="intro",e.VIDEO_TYPE="video_type",e.URL="url",e.TEACHER_ID="teacher_id",e}(k||{}),st=(()=>{let r=class r{constructor(){this.teacherVideoService=b(we),this.commonService=b(ve),this.uploadService=b(Te),this.data=b(tt),this.dialogRef=b(et),this.fb=b(pe),this.mode=G.Select,this.videos=[],this.categoryOptions=[],this.uploadForm=this.fb.group({[k.NAME]:this.fb.control(null,[ee.required]),[k.CATEGORY]:this.fb.control(null,[ee.required]),[k.INTRO]:this.fb.control(null,[ee.required]),[k.VIDEO_TYPE]:this.fb.control(!1,[ee.required]),[k.URL]:this.fb.control(null)}),this.currentFile=null,this.VideoSelectMode=G,this.UploadFormKey=k,this.InputType=fe}get videoType(){return this.uploadForm.controls[k.VIDEO_TYPE]}get selectedVideoIds(){return this.data.videoIds}get courseId(){return this.data.courseId}get teacherId(){return this.data.teacherId}get canSubmit(){return this.mode===G.Upload?this.uploadForm.controls[k.VIDEO_TYPE].value?!this.uploadForm.invalid:this.currentFile&&!this.uploadForm.invalid:!0}ngOnInit(){this.teacherVideoService.apiTeacherVideoGet().subscribe(t=>{if(this.videos=t.data.map(i=>H({video_id:i._id,name:i.name,category:i.category,intro:i.intro,video_type:i.video_type,url:i.url,teacher_id:i.teacher_id},i.course_id?{course_id:i.course_id}:{})),this.videos&&this.videos.length){let i=new me([]);this.videos.forEach(n=>{let m=this.selectedVideoIds.some(g=>g===n.video_id);i.push(new se(m))}),this.chks=i}}),this.commonService.apiCommonTagGet().subscribe(t=>this.categoryOptions=t.data)}submit(){if(this.mode===G.Upload){let t=()=>{let{name:n,category:m,intro:g,url:C,video_type:L}=this.uploadForm.getRawValue();this.teacherVideoService.apiTeacherVideoPost({addTeacherVideoRequestModel:{name:n,category:m,intro:g,url:C,video_type:L?"youtube":"storage",course_id:this.courseId,teacher_id:this.teacherId}}).subscribe(()=>this.dialogRef.close())};if(this.uploadForm.controls[k.VIDEO_TYPE].value===!1){if(!this.currentFile)return;this.uploadService.apiUploadFilePost({fileType:"video",path:"user",file:this.currentFile}).subscribe(({fileUrl:n})=>{this.uploadForm.controls[k.URL].setValue(n||""),t()})}else t()}else{let t=this.videos.filter((i,n)=>this.chks.at(n).value);this.dialogRef.close(t)}}cancel(){this.dialogRef.close()}toggleMode(t){this.mode=t||this.mode===G.Select?G.Upload:G.Select}hanldeVideoChange(t){let i=t.target.files?.[0];i&&(this.currentFile=i)}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=E({type:r,selectors:[["app-video-select"]],standalone:!0,features:[I],decls:13,vars:5,consts:[["file",""],[1,"flex","h-full","flex-col","justify-between","gap-y-5","bg-white","p-5"],[1,"flex","justify-between"],[1,"text-xl","font-bold"],[1,"rounded-md","bg-tmf-orange-1","px-2","py-1","text-white",3,"click"],[1,"flex","justify-end","gap-5"],[1,"w-[100px]","rounded-md","border","py-1",3,"click"],[1,"w-[100px]","rounded-md","bg-tmf-orange-1","py-1","text-white",3,"click","ngClass"],[1,"flex","flex-col","gap-3","overflow-auto","rounded-xl","border","bg-tmf-orange-4","p-5"],[1,"flex","items-center","gap-3"],[3,"formControl"],[1,"flex","gap-5"],[3,"data"],[1,"flex","flex-col","gap-3"],[1,"text-gray-500"],[1,"flex","flex-col","overflow-auto",3,"formGroup"],["label","\u8AB2\u7A0B\u540D\u7A31","placeholder","\u8ACB\u8F38\u5165\u8AB2\u7A0B\u540D\u7A31",3,"isRequired","formControlName","inputType"],["label","\u5F71\u7247\u985E\u5225",1,"mb-6",3,"isRequired","formControlName"],[3,"value","label"],["label","\u5F71\u7247\u7C21\u4ECB","placeholder","\u8ACB\u8F38\u5165\u5F71\u7247\u7C21\u4ECB",3,"isRequired","formControlName"],[1,"mb-6","flex","flex-col"],[1,"mb-1"],[1,"select-label"],[1,"text-red-500"],[3,"formControlName"],["label","\u5F71\u7247\u9023\u7D50","placeholder","\u8ACB\u8F38\u5165\u5F71\u7247\u9023\u7D50",3,"isRequired","formControlName","inputType"],[1,"flex","items-center","gap-1"],[1,"w-[100px]","rounded-md","bg-tmf-orange-1","py-1","text-white",3,"click"],["type","file","hidden","","accept","video/*",3,"change"]],template:function(i,n){i&1&&(a(0,"div",1)(1,"div",2)(2,"h2",3),d(3,"\u7BA1\u7406\u77ED\u5F71\u7247"),l(),a(4,"button",4),p("click",function(){return n.toggleMode()}),d(5),l()(),_(6,Ut,1,1)(7,Kt,15,10),a(8,"div",5)(9,"button",6),p("click",function(){return n.cancel()}),d(10," \u53D6\u6D88 "),l(),a(11,"button",7),p("click",function(){return n.canSubmit?n.submit():null}),d(12," \u78BA\u5B9A "),l()()()),i&2&&(s(5),F(" ",n.mode===n.VideoSelectMode.Select?"\u4E0A\u50B3\u5F71\u7247":"\u7BA1\u7406\u5F71\u7247"," "),s(),x(6,n.mode===n.VideoSelectMode.Select?6:7),s(5),u("ngClass",w(3,kt,!n.canSubmit)))},dependencies:[V,B,Q,U,le,de,ue,ce,Ee,Ze,he,Ce,ge,_e,Ie],styles:["[_nghost-%COMP%]{display:block;height:100%}"]});let e=r;return e})();var $t=(e,r)=>({"mb-5":e,"cursor-not-allowed !bg-tmf-gray-3":r});function jt(e,r){if(e&1&&(a(0,"span",7),d(1),l()),e&2){let o=c();s(),T(o.label)}}function zt(e,r){e&1&&(a(0,"span",8),d(1,"*"),l())}function Yt(e,r){if(e&1&&(a(0,"p",9),d(1),l()),e&2){let o=c();s(),T(o.info)}}function Wt(e,r){if(e&1&&v(0,"tmf-video-card",6),e&2){let o=r.$implicit;u("data",o)}}var dt=(()=>{let r=class r{constructor(){this.teacherVideoService=b(we),this.dialog=b(be),this.label="",this.info="",this.isRequired=!1,this.videoIds=[],this.disabled=!1,this.courseId="",this.teacherId="",this.selectVideoChange=new Ke,this.videos=[],this.selectedVideos=[]}get selectVideos(){return this.selectedVideos.length>0?this.selectedVideos:this.videos.filter(t=>this.videoIds.includes(t.video_id))}ngOnChanges(t){t.videoIds&&t.videoIds.currentValue&&this.videoIds.length&&this.getAllVideos()}getAllVideos(){this.teacherVideoService.apiTeacherVideoGet().subscribe(t=>{this.videos=t.data.map(i=>H({video_id:i._id,name:i.name,category:i.category,intro:i.intro,video_type:i.video_type,url:i.url,teacher_id:i.teacher_id},i.course_id?{course_id:i.course_id}:{}))})}selectVideo(){this.dialog.open(st,{width:"100%",height:"100%",maxHeight:"80vh",maxWidth:"80vw",data:{videoIds:this.selectedVideos.length?this.selectedVideos.map(i=>i.video_id):this.videoIds,courseId:this.courseId,teacherId:this.teacherId}}).closed.subscribe(i=>{i&&(this.selectedVideos=i,this.selectVideoChange.emit(this.selectedVideos.map(n=>n.video_id)))})}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=E({type:r,selectors:[["app-video-list"]],inputs:{label:"label",info:"info",isRequired:"isRequired",videoIds:"videoIds",disabled:"disabled",courseId:"courseId",teacherId:"teacherId"},outputs:{selectVideoChange:"selectVideoChange"},standalone:!0,features:[He,I],decls:10,vars:7,consts:[[1,"mb-1","flex","flex-col"],["class","select-label",4,"ngIf"],["class","text-red-500",4,"ngIf"],["class","mb-2 ml-2 text-sm text-gray-500",4,"ngIf"],[1,"rounded-md","bg-tmf-orange-1","px-2","py-1","text-white",3,"click","ngClass"],[1,"flex","max-w-full","gap-3","overflow-auto"],[3,"data"],[1,"select-label"],[1,"text-red-500"],[1,"mb-2","ml-2","text-sm","text-gray-500"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"p"),_(2,jt,2,1,"span",1)(3,zt,2,0,"span",2),l(),_(4,Yt,2,1,"p",3),l(),a(5,"button",4),p("click",function(){return n.disabled?null:n.selectVideo()}),d(6," \u7BA1\u7406\u77ED\u5F71\u7247 "),l(),a(7,"div",5),D(8,Wt,1,1,"tmf-video-card",6,A),l()),i&2&&(s(2),u("ngIf",n.label),s(),u("ngIf",n.isRequired),s(),u("ngIf",n.info),s(),u("ngClass",z(4,$t,n.selectVideos.length>0,n.disabled)),s(3),R(n.selectVideos))},dependencies:[V,B,Y,Ee],styles:["[_nghost-%COMP%]{display:block}"]});let e=r;return e})();var ut=e=>({"cursor-not-allowed !bg-tmf-gray-5":e}),ct=e=>({"cursor-not-allowed bg-tmf-gray-5 text-tmf-gray-3":e});function Qt(e,r){if(e&1&&(a(0,"span",8),d(1),l()),e&2){let o=c();s(),T(o.label)}}function Jt(e,r){e&1&&(a(0,"span",9),d(1,"*"),l())}function Xt(e,r){if(e&1){let o=y();a(0,"div",10),v(1,"input",11),a(2,"label",12),d(3),l(),a(4,"div",13)(5,"input",14),ke("ngModelChange",function(i){let n=f(o).$implicit,m=c();return Pe(n[m.itemKey1],i)||(n[m.itemKey1]=i),h(i)}),p("ngModelChange",function(){f(o);let i=c();return h(i.updateFormControlValue())}),l()(),a(6,"label",12),d(7),l(),a(8,"div",13)(9,"input",14),ke("ngModelChange",function(i){let n=f(o).$implicit,m=c();return Pe(n[m.itemKey2],i)||(n[m.itemKey2]=i),h(i)}),p("ngModelChange",function(){f(o);let i=c();return h(i.updateFormControlValue())}),l()(),a(10,"button",15),p("click",function(){let i=f(o).index,n=c();return h(n.removePriceQuantity(i))}),a(11,"span",16),d(12," close "),l()()()}if(e&2){let o=r.$implicit,t=c();s(),u("value",o[t.idKey]),s(2),F("",t.itemLabel1,"\uFF1A"),s(),u("ngClass",w(16,ut,t.disabled)),s(),u("placeholder",t.itemPlaceHolder1)("type",t.itemType1)("ngClass",w(18,ct,t.disabled))("disabled",t.disabled),Oe("ngModel",o[t.itemKey1]),s(2),F("",t.itemLabel2,"\uFF1A"),s(),u("ngClass",w(20,ut,t.disabled)),s(),u("placeholder",t.itemPlaceHolder2)("type",t.itemType2)("ngClass",w(22,ct,t.disabled))("disabled",t.disabled),Oe("ngModel",o[t.itemKey2]),s(),u("disabled",t.disabled)}}var mt=(()=>{let r=class r{constructor(){this.label="",this.info="",this.isRequired=!1,this.idKey="",this.itemKey1="",this.itemLabel1="",this.itemPlaceHolder1="",this.itemType1="text",this.itemKey2="",this.itemLabel2="",this.itemPlaceHolder2="",this.itemType2="text",this.dataList=[],this.disabled=!1,this.onChange=()=>{},this.onTouched=()=>{}}addPriceQuantity(){this.dataList.push({[this.idKey]:null,[this.itemKey1]:null,[this.itemKey2]:null}),this.updateFormControlValue()}removePriceQuantity(t){this.dataList.splice(t,1),this.updateFormControlValue()}updateFormControlValue(){this.onChange(this.dataList),this.onTouched()}writeValue(t){t?this.dataList=t.map(i=>({[this.idKey]:i[this.idKey],[this.itemKey1]:i[this.itemKey1],[this.itemKey2]:i[this.itemKey2]})):this.dataList=[]}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=E({type:r,selectors:[["app-dynamic-input-list"]],inputs:{label:"label",info:"info",isRequired:"isRequired",idKey:"idKey",itemKey1:"itemKey1",itemLabel1:"itemLabel1",itemPlaceHolder1:"itemPlaceHolder1",itemType1:"itemType1",itemKey2:"itemKey2",itemLabel2:"itemLabel2",itemPlaceHolder2:"itemPlaceHolder2",itemType2:"itemType2"},standalone:!0,features:[j([{provide:W,useExisting:$(()=>r),multi:!0}]),I],decls:10,vars:4,consts:[[1,"mb-2","flex","items-center","justify-start","gap-2"],[1,"flex","flex-col"],["class","select-label",4,"ngIf"],["class","text-red-500",4,"ngIf"],["type","button",1,"flex","h-5","w-5","items-center","justify-center","rounded-full","bg-blue-500","text-white","hover:bg-blue-600","focus:outline-none","focus:ring-2","focus:ring-blue-500","disabled:cursor-not-allowed","disabled:bg-tmf-gray-3",3,"click","disabled"],[1,"material-icons","text-[16px]"],[1,"flex","max-w-[600px]","flex-col","gap-y-4"],["class","flex max-w-full flex-grow items-center",4,"ngFor","ngForOf"],[1,"select-label"],[1,"text-red-500"],[1,"flex","max-w-full","flex-grow","items-center"],["type","hidden",3,"value"],[1,"mr-1","whitespace-nowrap","text-[14px]","leading-4"],[1,"input-container","mr-2",3,"ngClass"],[1,"input",3,"ngModelChange","placeholder","type","ngClass","disabled","ngModel"],["type","button",1,"text-2xl","font-semibold","text-red-500","hover:text-red-700","focus:outline-none","focus:ring-2","focus:ring-red-500","disabled:cursor-not-allowed","disabled:text-tmf-gray-3",3,"click","disabled"],[1,"material-icons"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"div",1)(2,"p"),_(3,Qt,2,1,"span",2)(4,Jt,2,0,"span",3),l()(),a(5,"button",4),p("click",function(){return n.addPriceQuantity()}),a(6,"span",5),d(7," add "),l()()(),a(8,"div",6),_(9,Xt,13,24,"div",7),l()),i&2&&(s(3),u("ngIf",n.label),s(),u("ngIf",n.isRequired),s(),u("disabled",n.disabled),s(4),u("ngForOf",n.dataList))},dependencies:[V,B,ae,Y,Xe,We,U,Qe],styles:["[_nghost-%COMP%]{display:block}.input-container[_ngcontent-%COMP%]{position:relative;display:flex;height:36px;flex-grow:1;align-items:center;border-radius:.5rem;border-width:1px;--tw-border-opacity: 1;border-color:rgb(159 159 159 / var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity));padding-left:.75rem;padding-right:.75rem;transition-duration:75ms}.input-container[_ngcontent-%COMP%]:focus-within{--tw-border-opacity: 1;border-color:rgb(243 105 35 / var(--tw-border-opacity))}@media (min-width: 768px){.input-container[_ngcontent-%COMP%]{height:38px}}@media (min-width: 1024px){.input-container[_ngcontent-%COMP%]{height:40px}}.input[_ngcontent-%COMP%]{width:100%;max-width:100%;flex-grow:1;overflow:hidden;text-overflow:ellipsis;font-size:14px;line-height:1.25rem;outline:2px solid transparent;outline-offset:2px}@media (min-width: 768px){.input[_ngcontent-%COMP%]{font-size:16px;line-height:1.5rem}}"]});let e=r;return e})();var Zt=e=>({"cursor-not-allowed !bg-tmf-gray-3":e});function ei(e,r){if(e&1&&(a(0,"span",3),d(1),l()),e&2){let o=c();s(),je("(\u5C3A\u5BF8\u9650\u5236 ",o.sizeLimitWidth,"*",o.sizeLimitHeight,")")}}function ti(e,r){e&1&&(a(0,"span",4),d(1,"*"),l())}function ii(e,r){if(e&1&&v(0,"img",9),e&2){let o=c();u("src",o.imageUrl,re)}}function ni(e,r){e&1&&(a(0,"span",10),d(1,"\u5C1A\u672A\u4E0A\u50B3\u5716\u7247"),l())}var pt=(()=>{let r=class r{constructor(){this.dialog=b(be),this.isRequired=!1,this.label="",this.previewWidth=400,this.previewHeight=200,this.imageUrl=null,this.disabled=!1,this.onChange=()=>{},this.onTouched=()=>{}}onFileChange(t){let i=t.target;if(i.files&&i.files[0]){let n=i.files[0],m=new Image;m.src=URL.createObjectURL(n),m.onload=()=>{let g=C=>{let L=new FileReader;L.onload=()=>{this.imageUrl=L.result,this.onChange(C)},L.readAsDataURL(C)};this.sizeLimitWidth&&this.sizeLimitHeight?m.width===this.sizeLimitWidth&&m.height===this.sizeLimitHeight?g(n):this.openAlertDialog({title:"\u5716\u7247\u5C3A\u5BF8\u932F\u8AA4",content:`\u5716\u7247\u5C3A\u5BF8\u5FC5\u9808\u70BA ${this.sizeLimitWidth}x${this.sizeLimitHeight}\uFF0C\u8ACB\u91CD\u65B0\u4E0A\u50B3\u3002`}).closed.subscribe(()=>{this.imageUrl=null,this.onChange(null)}):g(n)}}}openAlertDialog(t){let i=t||new nt;return this.dialog.open(it,{data:i})}writeValue(t){t instanceof Blob||t instanceof File?this.imageUrl=URL.createObjectURL(t):typeof t=="string"?this.imageUrl=t:this.imageUrl=null}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}onTouchedHandler(){this.onTouched()}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=E({type:r,selectors:[["tmf-image-upload"]],inputs:{isRequired:"isRequired",label:"label",previewWidth:"previewWidth",previewHeight:"previewHeight",sizeLimitWidth:"sizeLimitWidth",sizeLimitHeight:"sizeLimitHeight"},standalone:!0,features:[j([{provide:W,useExisting:$(()=>r),multi:!0}]),I],decls:13,vars:16,consts:[["fileUpload",""],[1,"flex","items-center"],[1,"input-label"],[1,"text-sm","text-gray-500"],[1,"text-red-500"],[1,"ml-1","rounded-md","bg-tmf-orange-1","px-2","py-1","text-white",3,"click","ngClass"],[1,"flex","flex-col","space-y-2"],["type","file",1,"hidden",3,"change","disabled"],[1,"mt-4","flex","items-center","justify-center","bg-tmf-gray-5"],["alt","\u5DF2\u4E0A\u50B3\u7684\u5716\u7247\u9810\u89BD",1,"h-full","w-full","object-cover",3,"src"],[1,"text-tmf-gray-3"]],template:function(i,n){if(i&1){let m=y();a(0,"div",1)(1,"span",2),d(2),l(),_(3,ei,2,2,"span",3)(4,ti,2,0,"span",4),a(5,"button",5),p("click",function(){f(m);let C=N(9);return h(C.click())}),d(6," \u4E0A\u50B3\u5716\u7247 "),l()(),a(7,"div",6)(8,"input",7,0),p("change",function(C){return f(m),h(n.onFileChange(C))}),l(),a(10,"div",8),_(11,ii,1,1,"img",9)(12,ni,2,0),l()()}i&2&&(s(2),T(n.label),s(),x(3,n.sizeLimitWidth&&n.sizeLimitHeight?3:-1),s(),x(4,n.isRequired?4:-1),s(),u("ngClass",w(14,Zt,n.disabled)),s(3),u("disabled",n.disabled),s(2),$e("width",n.previewWidth,"px")("height",n.previewHeight,"px")("max-width","100%")("max-height","100%"),s(),x(11,n.imageUrl?11:12))},dependencies:[V,B],styles:["[_nghost-%COMP%]{display:block}"]});let e=r;return e})();var oi=e=>({"cursor-not-allowed !bg-tmf-gray-3":e}),ri=(e,r)=>({"cursor-not-allowed bg-tmf-gray-5 text-tmf-gray-3":e,"cursor-pointer":r});function ai(e,r){e&1&&(a(0,"span",3),d(1,"*"),l())}function li(e,r){if(e&1){let o=y();a(0,"div",8),p("click",function(){let i=f(o).$implicit,n=c();return h(n.disabled?null:n.downloadFile(i))}),a(1,"span",9),d(2),l(),a(3,"button",10),p("click",function(i){let n=f(o).index,m=c();return h(m.disabled?null:m.removeFile(i,n))}),a(4,"span",11),d(5,"close"),l()()()}if(e&2){let o=r.$implicit,t=c();u("ngClass",z(3,ri,t.disabled,(o.fileId||o.file)&&!t.disabled)),s(2),T(o.name),s(),u("disabled",t.disabled)}}var ft=(()=>{let r=class r{constructor(){this.downloadService=b(rt),this.fileService=b(ye),this.isRequired=!1,this.label="",this.files=[],this.disabled=!1,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(t){t&&(this.files=t.map(i=>({id:i.id||null,name:i.name,file:i.file||null,fileId:i.fileId||null})))}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}onFileChange(t){let i=t.target.files;i.length>0&&(Array.from(i).forEach(m=>{this.files.some(({file:C})=>C&&C.name===m.name&&C.size===m.size&&C.lastModified===m.lastModified)||this.files.push({id:null,name:m.name,file:m,fileId:null})}),this.onChange(this.files),this.onTouched())}removeFile(t,i){t.stopPropagation(),this.files.splice(i,1),this.onChange(this.files)}downloadFile(t){t.fileId?this.fileService.apiFileFileIdGet({fileId:t.fileId}).subscribe(i=>{this.downloadService.downloadFile(i,t.name)}):t.file&&this.downloadService.downloadFile(t.file,t.name)}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=E({type:r,selectors:[["app-file-uploader"]],inputs:{isRequired:"isRequired",label:"label"},standalone:!0,features:[j([{provide:W,useExisting:$(()=>r),multi:!0}]),I],decls:10,vars:6,consts:[["fileUpload",""],[1,"mb-2","flex","items-center"],[1,"input-label"],[1,"text-red-500"],[1,"ml-1","rounded-md","bg-tmf-orange-1","px-2","py-1","text-white",3,"click","ngClass"],[1,"flex","flex-wrap","gap-2"],["type","file","multiple","",1,"hidden",3,"change"],["class","file-container",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"file-container",3,"click","ngClass"],[1,"file-text"],["type","button",1,"h-6","text-red-500","hover:text-red-700","focus:outline-none","disabled:cursor-not-allowed","disabled:text-tmf-gray-3",3,"click","disabled"],[1,"material-icons"]],template:function(i,n){if(i&1){let m=y();a(0,"div",1)(1,"span",2),d(2),l(),_(3,ai,2,0,"span",3),a(4,"button",4),p("click",function(){f(m);let C=N(8);return h(C.click())}),d(5," \u4E0A\u50B3\u6A94\u6848 "),l()(),a(6,"div",5)(7,"input",6,0),p("change",function(C){return f(m),h(n.onFileChange(C))}),l(),_(9,li,6,6,"div",7),l()}i&2&&(s(2),T(n.label),s(),x(3,n.isRequired?3:-1),s(),u("ngClass",w(4,oi,n.disabled)),s(5),u("ngForOf",n.files))},dependencies:[V,B,ae],styles:["[_nghost-%COMP%]{display:block}.file-container[_ngcontent-%COMP%]{position:relative;display:flex;height:36px;align-items:center;border-radius:.5rem;border-width:1px;--tw-border-opacity: 1;border-color:rgb(159 159 159 / var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity));padding-left:.75rem;padding-right:.75rem;transition-duration:75ms}@media (min-width: 768px){.file-container[_ngcontent-%COMP%]{height:38px}}@media (min-width: 1024px){.file-container[_ngcontent-%COMP%]{height:40px}}.file-text[_ngcontent-%COMP%]{margin-right:.25rem;width:100%;max-width:100%;flex-grow:1;overflow:hidden;text-overflow:ellipsis;font-size:14px;line-height:1.25rem;outline:2px solid transparent;outline-offset:2px}@media (min-width: 768px){.file-text[_ngcontent-%COMP%]{font-size:16px;line-height:1.5rem}}"]});let e=r;return e})();var si=(e,r)=>({"text-green-500":e,"text-red-500":r}),di=e=>({"cursor-not-allowed !bg-tmf-gray-5 !text-white":e});function ui(e,r){if(e&1&&(a(0,"p",3),d(1," \u586B\u5BEB\u72C0\u614B\uFF1A "),a(2,"span",24),d(3),l()()),e&2){let o=c();s(2),u("ngClass",z(2,si,o.courseData.is_valid,!o.courseData.is_valid)),s(),F(" ",o.courseData.is_valid?"\u9A57\u8B49\u901A\u904E":"\u9A57\u8B49\u672A\u901A\u904E"," ")}}function ci(e,r){if(e&1){let o=y();a(0,"button",5),p("click",function(){f(o);let i=c();return h(i.changeView.emit({mode:i.ViewMode.Edit}))}),a(1,"span",6),d(2," edit_square "),l(),d(3," \u7DE8\u8F2F "),l()}}function mi(e,r){if(e&1){let o=y();a(0,"button",27),p("click",function(){f(o);let i=c(2);return h(i.togglePublished())}),a(1,"span",6),d(2),l(),a(3,"span",7),d(4),l()()}if(e&2){let o=c(2);u("ngClass",w(3,di,!o.courseData.is_valid)),s(2),F(" ",o.courseData.status===o.CourseStatus.UNPUBLISHED?"publish":"unpublished"," "),s(2),F(" ",o.courseData.status===o.CourseStatus.UNPUBLISHED?"\u4E0A\u67B6":"\u4E0B\u67B6"," ")}}function pi(e,r){if(e&1){let o=y();a(0,"button",5),p("click",function(){f(o);let i=c();return h(i.reset())}),a(1,"span",25),d(2," refresh "),l(),a(3,"span",7),d(4," \u91CD\u8A2D "),l()(),a(5,"button",5),p("click",function(){f(o);let i=c();return h(i.save())}),a(6,"span",6),d(7," save "),l(),a(8,"span",7),d(9," \u5132\u5B58 "),l()(),_(10,mi,5,5,"button",26)}if(e&2){let o=c();s(10),x(10,o.courseData&&o.courseData.is_valid?10:-1)}}function fi(e,r){if(e&1&&v(0,"tmf-option",14),e&2){let o=r.$implicit;u("value",o.value)("label",o.label)}}function hi(e,r){if(e&1&&v(0,"tmf-option",14),e&2){let o=r.$implicit;u("value",o.value)("label",o.label)}}function _i(e,r){if(e&1&&v(0,"tmf-option",14),e&2){let o=r.$implicit;u("value",o.main_category)("label",o.main_category||"")}}function gi(e,r){if(e&1&&v(0,"tmf-option",14),e&2){let o=r.$implicit;u("value",o)("label",o)}}var ht=(()=>{let r=class r{get content(){return this.formGroup.controls[P.CONTENT]}get videoIds(){return this.courseData&&this.courseData.video_ids&&this.courseData.video_ids.length?this.courseData.video_ids:[]}get subTagOptions(){let t=this.formGroup.value.main_category;return this.tagOptions.find(i=>i.main_category===t)?.sub_category||[]}constructor(){this.teacherCourseService=b(Se),this.commonService=b(ve),this.fileService=b(ye),this.uploadService=b(Te),this.fb=b(pe),this.dialogService=b(xe),this.mode=Be(),this.courseId=Be(),this.changeView=oe(),this.courseData=null,this.cityOptions=[],this.distOptions=[],this.tagOptions=[],this.formGroup=this.fb.group({name:this.fb.control(null),main_image:this.fb.control(null),content:this.fb.control(null),price_quantity:this.fb.control(null),main_category:this.fb.control(null),sub_category:this.fb.control(null),city_id:this.fb.control(null),dist_id:this.fb.control(null),survey_url:this.fb.control(null),status:this.fb.control(null),teacher_id:this.fb.control(null),purchase_message:this.fb.control(null),video_ids:this.fb.control([]),file_details:this.fb.control([]),file_url_details:this.fb.control([])}),this.ViewMode=M,this.CourseStatus=q,this.CourseDetailFormKey=P,this.InputType=fe,Le(()=>{this.courseId()&&this.getCourse()}),Le(()=>{this.mode()===M.View?this.formGroup.disable():this.formGroup.enable()})}ngOnInit(){this.initOptions(),this.handleValueChange()}handleValueChange(){this.formGroup.controls[P.CITY_ID].valueChanges.pipe(Fe(null),Ae(t=>{let i=this.formGroup.controls[P.DIST_ID];return t?(this.mode()!==M.View&&i.enable(),this.commonService.apiCommonOptionsDistPost({districtRequestModel:{is_oversea:!1,city_id:t}})):(i.reset(),i.disable(),ne(null))})).subscribe(t=>{t&&(this.distOptions=t.data)}),this.formGroup.controls[P.MAIN_CATEGORY].valueChanges.pipe(Fe(null)).subscribe(t=>{let i=this.formGroup.controls[P.SUB_CATEGORY];if(!t){i.reset(),i.disable();return}this.mode()!==M.View&&i.enable()})}handleSelectVideo(t){this.formGroup.controls[P.VIDEO_IDS].setValue(t)}initOptions(){this.commonService.apiCommonOptionsCityPost({cityRequestModel:{is_oversea:!1}}).subscribe(t=>this.cityOptions=t.data),this.commonService.apiCommonTagGet().subscribe(t=>{this.tagOptions=t.data})}getCourse(){this.teacherCourseService.apiTeacherCourseCoursesCourseIdGet({courseId:this.courseId()}).subscribe(t=>{this.courseData=t.data,this.setFormValues(this.courseData)})}save(){let t=this.formGroup.getRawValue(),i=t[P.FILE_DETAILS],m=(this.courseData?.file_details||[]).filter(S=>!i.some(X=>X.id===S.id)).filter(S=>S.fileId).map(S=>this.fileService.apiFileFileIdDelete({fileId:S.fileId})),g=i.filter(S=>S.file).map(S=>this.fileService.apiFilePost({file:S.file}).pipe(De(X=>S.fileId=X.data))),C=t[P.MAIN_IMAGE],L=typeof C!="string"&&C?this.uploadService.apiUploadFilePost({fileType:"image",path:"course",file:C}).pipe(De(S=>t.main_image=S.fileUrl||null)):ne(null),Ve=[...m,...g,L,ne(null)];Ge(Ve).pipe(Ae(()=>this.teacherCourseService.apiTeacherCourseCoursesDraftPost({postTeacherCourseDraftRequestModel:qe(H(H({},this.courseId()?{_id:this.courseId()}:{}),t),{file_details:i.map(S=>({id:S.id||null,name:S.name,fileId:S.fileId||null}))})}))).subscribe(()=>this.getCourse())}reset(){this.courseData?this.setFormValues(this.courseData):this.formGroup.reset()}togglePublished(){if(!this.courseId())return;(this.courseData?.status===q.PUBLISHED?this.teacherCourseService.apiTeacherCourseCoursesCourseIdUnpublishPost({courseId:this.courseId()}):this.teacherCourseService.apiTeacherCourseCoursesCourseIdPublishPost({courseId:this.courseId()})).subscribe({next:()=>{this.getCourse()},error:i=>{this.dialogService.openAlertDialog({title:"\u767C\u751F\u932F\u8AA4",content:i.error.message}).closed.subscribe(()=>this.getCourse())}})}setFormValues(t){let{name:i="",main_image:n="",content:m="",price_quantity:g=[],main_category:C=null,sub_category:L=null,city_id:Ve=null,dist_id:S=null,survey_url:X=null,status:_t=null,teacher_id:gt=null,purchase_message:Ct=null,video_ids:bt=[],file_details:xt=[],file_url_details:vt=[]}=t;this.formGroup.setValue({name:i,main_image:n,content:m,price_quantity:g.map(O=>({_id:O._id||null,price:O.price||null,quantity:O.quantity||null})),main_category:C,sub_category:L,city_id:Ve,dist_id:S,survey_url:X,status:_t,teacher_id:gt,purchase_message:Ct,video_ids:bt,file_details:xt.map(O=>({id:O.id||null,name:O.name||null,fileId:O.fileId||null})),file_url_details:vt.map(O=>({id:O.id||null,name:O.name||null,url:O.url||null}))})}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=E({type:r,selectors:[["app-course-detail"]],inputs:{mode:[Re.SignalBased,"mode"],courseId:[Re.SignalBased,"courseId"]},outputs:{changeView:"changeView"},standalone:!0,features:[I],decls:37,vars:32,consts:[[1,"mb-5","flex","w-full","justify-between"],[1,"text-[22px]","font-bold","leading-9","md:text-[26px]","lg:text-[30px]"],[1,"flex","flex-col","items-end","gap-x-2","md:flex-row","md:items-center"],[1,"font-bold","leading-9"],[1,"flex","h-full","items-center","gap-1"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","p-1","text-white","md:px-3","md:py-2",3,"click"],[1,"material-symbols-outlined","text-[20px]","md:text-[22px]"],[1,"hidden","lg:block"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","p-1","text-white","md:px-3","md:py-2"],[3,"formGroup"],["label","\u8AB2\u7A0B\u540D\u7A31","placeholder","\u8ACB\u8F38\u5165\u8AB2\u7A0B\u540D\u7A31",3,"isRequired","formControlName","inputType"],["label","\u5B9A\u50F9","idKey","_id","itemKey1","price","itemLabel1","\u50F9\u683C","itemPlaceholder1","\u8ACB\u8F38\u5165\u50F9\u683C","itemType1","number","itemKey2","quantity","itemLabel2","\u5802\u6578","itemPlaceholder2","\u8ACB\u8F38\u5165\u5802\u6578","itemType2","number",1,"mb-6",3,"isRequired","formControlName"],[1,"mb-6","flex","items-end","gap-2"],["label","\u6388\u8AB2\u5730\u9EDE",3,"isRequired","formControlName"],[3,"value","label"],[3,"isRequired","formControlName"],["label","\u8AB2\u7A0B\u985E\u5225",3,"isRequired","formControlName"],["label","\u6587\u7AE0\u5167\u6587","height","400px",1,"mb-6",3,"contentChangeEvent","isRequired","diabled","defaultContent"],["label","\u8AB2\u7A0B\u77ED\u5F71\u7247",1,"mb-6",3,"selectVideoChange","disabled","videoIds","courseId","teacherId"],["label","\u6587\u7AE0\u5C01\u9762\u5716\u7247",1,"mb-6",3,"isRequired","formControlName"],["label","\u8CFC\u8CB7\u6210\u529F\u8A0A\u606F",1,"mb-6",3,"isRequired","formControlName"],["label","\u8AB2\u7A0B\u6A94\u6848",1,"mb-6",3,"formControlName"],["label","\u8AB2\u7A0B\u6A94\u6848\u9023\u7D50","idKey","id","itemKey1","name","itemLabel1","\u6A94\u6848\u540D\u7A31","itemPlaceholder1","\u8ACB\u8F38\u5165\u6A94\u6848\u540D\u7A31","itemKey2","url","itemLabel2","\u6A94\u6848\u9023\u7D50","itemPlaceholder2","\u8ACB\u8F38\u5165\u6A94\u6848\u9023\u7D50",1,"mb-6",3,"formControlName"],["label","\u8AB2\u524D\u8AEE\u8A62\u554F\u5238\u9023\u7D50","placeholder","\u8ACB\u8F38\u5165\u8AB2\u524D\u8AEE\u8A62\u554F\u5238\u9023\u7D50",3,"isRequired","formControlName","inputType"],[3,"ngClass"],[1,"material-symbols-outlined","-scale-x-100","text-[20px]","md:text-[22px]"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","p-1","text-white","md:px-3","md:py-2",3,"ngClass"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","p-1","text-white","md:px-3","md:py-2",3,"click","ngClass"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"h1",1),d(2," \u8AB2\u7A0B\u7BA1\u7406 "),l(),a(3,"div",2),_(4,ui,4,5,"p",3),a(5,"div",4)(6,"button",5),p("click",function(){return n.changeView.emit({mode:n.ViewMode.List})}),a(7,"span",6),d(8," reply "),l(),a(9,"span",7),d(10," \u8FD4\u56DE "),l()(),_(11,ci,4,0,"button",8)(12,pi,11,1),l()()(),a(13,"form",9),v(14,"tmf-input",10)(15,"app-dynamic-input-list",11),a(16,"div",12)(17,"tmf-select",13),D(18,fi,1,2,"tmf-option",14,A),l(),a(20,"tmf-select",15),D(21,hi,1,2,"tmf-option",14,A),l()(),a(23,"div",12)(24,"tmf-select",16),D(25,_i,1,2,"tmf-option",14,A),l(),a(27,"tmf-select",15),D(28,gi,1,2,"tmf-option",14,A),l()(),a(30,"tmf-quill-editor",17),p("contentChangeEvent",function(g){return n.content.setValue(g)}),l(),a(31,"app-video-list",18),p("selectVideoChange",function(g){return n.handleSelectVideo(g)}),l(),v(32,"tmf-image-upload",19)(33,"tmf-textarea",20)(34,"app-file-uploader",21)(35,"app-dynamic-input-list",22)(36,"tmf-input",23),l()),i&2&&(s(4),x(4,(n.mode()===n.ViewMode.Edit||n.mode()===n.ViewMode.Create)&&n.courseData?4:-1),s(7),x(11,n.mode()===n.ViewMode.View&&n.courseData&&n.courseData.status!==n.CourseStatus.PUBLISHED?11:n.mode()===n.ViewMode.Edit||n.mode()===n.ViewMode.Create?12:-1),s(2),u("formGroup",n.formGroup),s(),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.NAME)("inputType",n.InputType.Outline),s(),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.PRICE_QUANTITY),s(2),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.CITY_ID),s(),R(n.cityOptions),s(2),u("isRequired",!1)("formControlName",n.CourseDetailFormKey.DIST_ID),s(),R(n.distOptions),s(3),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.MAIN_CATEGORY),s(),R(n.tagOptions),s(2),u("isRequired",!1)("formControlName",n.CourseDetailFormKey.SUB_CATEGORY),s(),R(n.subTagOptions),s(2),u("isRequired",!0)("diabled",n.content.disabled)("defaultContent",(n.courseData==null?null:n.courseData.content)||""),s(),u("disabled",n.formGroup.get(n.CourseDetailFormKey.VIDEO_IDS).disabled)("videoIds",n.videoIds)("courseId",n.courseId()||"")("teacherId",(n.courseData==null?null:n.courseData.teacher_id)||""),s(),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.MAIN_IMAGE),s(),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.PURCHASE_MESSAGE),s(),u("formControlName",n.CourseDetailFormKey.FILE_DETAILS),s(),u("formControlName",n.CourseDetailFormKey.FILE_URL_DETAILS),s(),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.SURVEY_URL)("inputType",n.InputType.Outline))},dependencies:[V,B,Q,Je,U,le,ue,ce,he,Ce,ge,Ie,ot,dt,mt,pt,ft],styles:["[_nghost-%COMP%]{display:block}"]});let e=r;return e})();function Ci(e,r){if(e&1){let o=y();a(0,"app-course-table",0),p("changeView",function(i){f(o);let n=c();return h(n.handleChangeView(i))}),l()}}function bi(e,r){if(e&1){let o=y();a(0,"app-course-detail",1),p("changeView",function(i){f(o);let n=c();return h(n.handleChangeView(i))}),l()}if(e&2){let o=c();u("mode",o.mode())("courseId",o.currentCourseId())}}var M=function(e){return e.List="list",e.View="view",e.Edit="edit",e.Create="create",e}(M||{}),Yn=(()=>{let r=class r{constructor(){this.mode=Z(M.List),this.currentCourseId=Z(null),this.ViewMode=M}handleChangeView(t){this.mode.set(t.mode),t.courseId&&this.currentCourseId.set(t.courseId)}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=E({type:r,selectors:[["app-teacher-courses-page"]],standalone:!0,features:[I],decls:2,vars:1,consts:[[3,"changeView"],[3,"changeView","mode","courseId"]],template:function(i,n){i&1&&_(0,Ci,1,0,"app-course-table")(1,bi,1,2),i&2&&x(0,n.mode()===n.ViewMode.List?0:1)},dependencies:[V,lt,ht],styles:["[_nghost-%COMP%]{display:block}"]});let e=r;return e})();export{M as ViewMode,Yn as default};

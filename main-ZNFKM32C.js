import{a as k}from"./chunk-XIR4PVUX.js";import{a as p,b as m}from"./chunk-DFTX4E4X.js";import{b as T,c as P,d as R}from"./chunk-LVRRSONG.js";import{a as w,b as A}from"./chunk-DDXRFZGT.js";import{a as E}from"./chunk-CJ7P5242.js";import{t as u,u as g,v as C}from"./chunk-74AGBKJB.js";import{$a as S,I as h,K as l,O as a,T as f,U as n,X as d,k as s,mb as v,u as c}from"./chunk-BZO4J33P.js";import"./chunk-2XJVAMHT.js";var I=[{path:"login",loadComponent:()=>import("./chunk-34XSNFTC.js").then(e=>e.LoginComponent)},{path:"sign-up",loadComponent:()=>import("./chunk-LXMJ5E7R.js").then(e=>e.SignUpComponent)},{path:"send-email",loadComponent:()=>import("./chunk-P4F3WTTL.js").then(e=>e.SendEmailComponent)},{path:"reset-password",loadComponent:()=>import("./chunk-QAI3S62N.js").then(e=>e.ResetPasswordComponent)},{path:"",loadComponent:()=>import("./chunk-FN2PCNIH.js"),loadChildren:()=>import("./chunk-E5C2PZTP.js")}];var j=(()=>{let t=class t{constructor(o){this.storageService=o}intercept(o,r){let i=this.storageService.getSessionItem("access_token");return i&&(o=o.clone({setHeaders:{Authorization:`Bearer ${i}`}})),r.handle(o)}};t.\u0275fac=function(r){return new(r||t)(f(p))},t.\u0275prov=a({token:t,factory:t.\u0275fac});let e=t;return e})();var x=[{pattern:"/api/auth/refresh",methods:["POST"]},{pattern:"/api/shop/cart",methods:["GET","DELETE"]}];var y=(()=>{let t=class t{constructor(){this.authService=n(A),this.storageService=n(p),this.authStatusService=n(m),this.router=n(P)}intercept(o,r){return this.isProtectedRoute(o.url,o.method)?r.handle(o).pipe(c(i=>i.status===401?this.handle401Error(o,r):s(()=>i))):r.handle(o)}isProtectedRoute(o,r){return x.some(i=>new RegExp(i.pattern).test(o)&&i.methods.includes(r))}handle401Error(o,r){let i=this.storageService.getSessionItem("refreshToken");return i?this.authService.apiAuthRefreshPost({refreshRequestModel:{refresh_token:i}}).pipe(l(O=>{this.authStatusService.setLoginStatus(O.data)}),h(()=>r.handle(o.clone())),c(()=>(this.logout(),s(()=>new Error("Session expired, please log in again"))))):(this.logout(),s(()=>new Error("No refresh token available, logging out")))}logout(){this.authStatusService.logout(),this.router.navigate(["/login"])}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=a({token:t,factory:t.\u0275fac});let e=t;return e})();var D={providers:[R(I),g(C()),{provide:u,useClass:j,multi:!0},{provide:u,useClass:y,multi:!0},{provide:w,useValue:k.basePath}]};var H=(()=>{let t=class t{constructor(){this.authStatusService=n(m)}ngOnInit(){this.authStatusService.checkLoginStatus()}};t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=d({type:t,selectors:[["app-root"]],standalone:!0,features:[v],decls:1,vars:0,template:function(r,i){r&1&&S(0,"router-outlet")},dependencies:[T]});let e=t;return e})();E(H,D).catch(e=>console.error(e));

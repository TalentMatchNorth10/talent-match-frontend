import{a as ce,b as de,c as ue,d as me}from"./chunk-HEXYBCXY.js";import{d as K}from"./chunk-EM2JKLY3.js";import"./chunk-A333B47I.js";import"./chunk-KTGNIIQT.js";import{m as T}from"./chunk-T2S3BQ7X.js";import"./chunk-DCCBA6JN.js";import{a as q}from"./chunk-QB7WMKJV.js";import"./chunk-A6ZGQ5H3.js";import{a as N,b as A}from"./chunk-GEWNISP5.js";import{b as ae,e as O,f as B,j as le,l as V,o as $,q as G,s as j}from"./chunk-J7X6Y7TH.js";import"./chunk-5AZTXUOI.js";import"./chunk-PDG62EJG.js";import"./chunk-WALOVNFW.js";import"./chunk-ZYSDU26P.js";import{k as L,v as I}from"./chunk-QWUFOH72.js";import{Gb as c,Hb as k,Ib as E,Jb as J,Na as l,Ob as S,Qb as oe,Rb as M,S as U,T as ne,Tb as se,Za as v,aa as f,db as y,ea as X,fa as b,fb as d,hb as z,jb as R,kb as D,lc as P,mb as x,na as ie,nb as C,ob as a,pa as g,pb as s,qa as h,qb as m,ub as w,xa as Y,xb as _,ya as re,yb as u,za as Z}from"./chunk-NYBVSAW5.js";import"./chunk-MON7YFGF.js";var Ee=t=>({"cursor-pointer":t}),Te=(t,e)=>({"bg-tmf-purple":t,"bg-tmf-blue-2":e});function Fe(t,e){if(t&1&&(a(0,"p",3),c(1),s()),t&2){let r=u();d("ngClass",M(2,Te,r.reserve.teacher_status==="reserved"&&r.reserve.student_status==="reserved",r.reserve.teacher_status==="completed"&&r.reserve.student_status==="reserved")),l(),E(" ",r.reserve.teacher_status==="reserved"&&r.reserve.student_status==="reserved"?"\u5F85\u5B8C\u6210":"\u5F85\u78BA\u8A8D"," ")}}function Me(t,e){t&1&&(a(0,"p",9),c(1," \u5DF2\u9810\u7D04 "),s())}var Q=(()=>{let e=class e{constructor(){this.expired=!1}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["tmf-reserve-card"]],inputs:{reserve:"reserve",expired:"expired"},standalone:!0,features:[S],decls:37,vars:12,consts:[[1,"w-[280px]","rounded-md","p-6","shadow-md",3,"ngClass"],[1,"flex","items-center","justify-between","border-b","pb-2"],[1,"text","text-base","font-bold"],[1,"min-w-[74px]","rounded-xl","px-4","py-1","text-sm","text-white",3,"ngClass"],[1,"flex","flex-col","gap-4","pt-2"],[1,"flex","items-center","gap-2"],[1,"material-icons","text-2xl","leading-6","text-tmf-gray-2"],[1,"material-icons-outlined","text-2xl","leading-6","text-tmf-gray-2"],[1,"overflow-hidden","text-ellipsis","whitespace-nowrap"],[1,"min-w-[74px]","rounded-xl","bg-green-500","px-4","py-1","text-sm","text-white"]],template:function(n,o){n&1&&(a(0,"div",0)(1,"div",1)(2,"p",2),c(3),s(),y(4,Fe,2,5,"p",3)(5,Me,2,0),s(),a(6,"div",4)(7,"div",5)(8,"span",6),c(9,"person"),s(),a(10,"p"),c(11),s()(),a(12,"div",5)(13,"span",6),c(14,"library_books"),s(),a(15,"p"),c(16),s()(),a(17,"div",5)(18,"span",6),c(19,"calendar_month"),s(),a(20,"p"),c(21),s()(),a(22,"div",5)(23,"span",7),c(24,"timer"),s(),a(25,"p"),c(26),s()(),a(27,"div",5)(28,"span",7),c(29,"mail"),s(),a(30,"p",8),c(31),s()(),a(32,"div",5)(33,"span",7),c(34,"smartphone"),s(),a(35,"p",8),c(36),s()()()()),n&2&&(d("ngClass",oe(10,Ee,o.reserve.teacher_status==="reserved"&&o.reserve.student_status==="reserved")),l(3),E(" ",o.reserve.course_name," "),l(),R(4,o.expired?4:5),l(7),E("\u5B78\u751F\uFF1A",(o.reserve.student==null?null:o.reserve.student.nick_name)||(o.reserve.student==null?null:o.reserve.student.name),""),l(5),J("\u5802\u6B21\uFF1A",o.reserve.reserved_amount,"/",o.reserve.total,""),l(5),E("\u65E5\u671F\uFF1A",o.reserve.reserve_date,""),l(5),E("\u6642\u9593\uFF1A",o.reserve.reserve_time,""),l(5),E(" \u4FE1\u7BB1\uFF1A",o.reserve.student==null?null:o.reserve.student.email," "),l(5),E(" \u96FB\u8A71\uFF1A",o.reserve.student!=null&&o.reserve.student.contact_phone?o.reserve.student==null?null:o.reserve.student.contact_phone:"-"," "))},dependencies:[L]});let t=e;return t})();function F(t,e){let r=!e?.manualCleanup;r&&!e?.injector&&ie(F);let i=r?e?.injector?.get(Y)??f(Y):null,n;e?.requireSync?n=v({kind:0}):n=v({kind:1,value:e?.initialValue});let o=t.subscribe({next:p=>n.set({kind:1,value:p}),error:p=>{if(e?.rejectErrors)throw p;n.set({kind:2,error:p})}});return i?.onDestroy(o.unsubscribe.bind(o)),P(()=>{let p=n();switch(p.kind){case 1:return p.value;case 2:throw p.error;case 0:throw new ne(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}var pe=(t,e)=>e._id,ke=(t,e)=>({itemsPerPage:6,totalItems:t,currentPage:e,showFirstButton:!1,showLastButton:!1});function De(t,e){if(t&1&&m(0,"tmf-option",4),t&2){let r=e.$implicit;d("label",r.name)("value",r._id)}}function Pe(t,e){if(t&1&&m(0,"tmf-option",4),t&2){let r=e.$implicit;d("label",r.nick_name)("value",r._id)}}function Le(t,e){if(t&1){let r=w();a(0,"tmf-reserve-card",11),_("click",function(){let n=g(r).$implicit,o=u(2);return h(o.completeReserve(n))}),s()}if(t&2){let r=e.$implicit;d("reserve",r)("expired",!0)}}function Ie(t,e){if(t&1){let r=w();a(0,"div",7),x(1,Le,1,2,"tmf-reserve-card",8,D),s(),a(3,"div",9)(4,"tmf-pagination",10),_("pageChange",function(n){g(r);let o=u();return h(o.pageChange(n))}),s()()}if(t&2){let r=u();l(),C(r.expired_reserves()),l(3),d("config",M(1,ke,r.totalCount(),r.currentPage()))}}var fe=(()=>{let e=class e{constructor(){this.teacherReserveService=f(T),this.fb=f(G),this.dialogService=f(K),this.courseList=[],this.studentList=[],this.expired_reserves=v([]),this.fg=this.fb.group({course:[""],student:[""]}),this.totalCount=v(0),this.currentPage=v(1),this.courseSig=F(this.fg.controls.course.valueChanges.pipe(U(()=>this.fg.controls.student.setValue("")))),this.studentSig=F(this.fg.controls.student.valueChanges),this.filterStudentList=P(()=>{let i=this.courseSig();return this.studentList.find(o=>o.course_id===i)?.students||[]})}ngOnInit(){this.fetchExpiredReserves()}pageChange(i){this.currentPage.set(i),this.fetchExpiredReserves()}searchReserves(){this.currentPage.set(1),this.fetchExpiredReserves()}fetchExpiredReserves(){this.teacherReserveService.apiTeacherReservesExpiredReservesGet({page:this.currentPage(),courseId:this.courseSig()==="all"?"":this.courseSig(),studentId:this.studentSig()==="all"?"":this.studentSig()}).subscribe(i=>{this.expired_reserves.set(i.data?.expired_reserves||[]),this.totalCount.set(i.data?.totalCount||0)})}completeReserve(i){i.teacher_status!=="completed"&&this.dialogService.openConfirmDialog({title:"\u5B8C\u6210\u8AB2\u7A0B",content:"\u78BA\u8A8D\u5B8C\u6210\u9810\u7D04\uFF1F",confirmBtnText:"\u78BA\u8A8D",btnType:"primary"}).subscribe(o=>{o&&this.teacherReserveService.apiTeacherReservesReservesPatch({updateReserveRequestModel:{reserve_id:i._id}}).subscribe(()=>{this.fetchExpiredReserves()})})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["tmf-expired-reserve"]],inputs:{courseList:"courseList",studentList:"studentList"},standalone:!0,features:[S],decls:15,vars:8,consts:[[1,"w-full","overflow-auto","rounded-lg","border","border-tmf-gray-2","p-4","shadow-md"],[1,"flex","min-w-[768px]","items-center","gap-4",3,"formGroup"],[1,"whitespace-nowrap","text-2xl","font-bold"],["formControlName","course",1,"!w-[250px]"],[3,"label","value"],["formControlName","student",1,"!w-[250px]"],[1,"whitespace-nowrap","rounded-md","bg-tmf-orange-1","px-4","py-[6px]","text-center","text-white",3,"click"],[1,"mb-5","flex","min-h-[654px]","flex-wrap","gap-5"],[3,"reserve","expired"],[1,"flex","justify-center"],[1,"mx-auto",3,"pageChange","config"],[3,"click","reserve","expired"]],template:function(n,o){n&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"\u5DF2\u903E\u671F\u9810\u7D04"),s(),a(4,"tmf-select",3),m(5,"tmf-option",4),x(6,De,1,2,"tmf-option",4,pe),s(),a(8,"tmf-select",5),m(9,"tmf-option",4),x(10,Pe,1,2,"tmf-option",4,pe),s(),a(12,"button",6),_("click",function(){return o.searchReserves()}),c(13," \u67E5\u8A62 "),s()(),y(14,Ie,5,4),s()),n&2&&(l(),z("mb-4",o.totalCount()),d("formGroup",o.fg),l(4),d("label","\u5168\u90E8")("value","all"),l(),C(o.courseList),l(3),d("label","\u5168\u90E8")("value","all"),l(),C(o.filterStudentList()),l(4),R(14,o.totalCount()>0?14:-1))},dependencies:[I,j,O,B,V,$,A,N,q,Q],encapsulation:2});let t=e;return t})();var ge=(t,e)=>e._id,Oe=(t,e)=>({itemsPerPage:6,totalItems:t,currentPage:e,showFirstButton:!1,showLastButton:!1});function Be(t,e){if(t&1&&m(0,"tmf-option",4),t&2){let r=e.$implicit;d("label",r.name)("value",r._id)}}function Ve(t,e){if(t&1&&m(0,"tmf-reserve-card",8),t&2){let r=e.$implicit;d("reserve",r)}}function $e(t,e){if(t&1){let r=w();a(0,"div",7),x(1,Ve,1,1,"tmf-reserve-card",8,ge),s(),a(3,"div",9)(4,"tmf-pagination",10),_("pageChange",function(n){g(r);let o=u();return h(o.pageChange(n))}),s()()}if(t&2){let r=u();l(),C(r.reserves()),l(3),d("config",M(1,Oe,r.totalCount(),r.currentPage()))}}var he=(()=>{let e=class e{constructor(){this.teacherReserveService=f(T),this.fb=f(G),this.courseList=[],this.fg=this.fb.group({range:["twoDays"],course:[""]}),this.totalCount=v(0),this.rangeSig=F(this.fg.controls.range.valueChanges),this.courseSig=F(this.fg.controls.course.valueChanges),this.currentPage=v(1),this.reserves=v([])}ngOnInit(){this.fetchReserves()}pageChange(i){this.currentPage.set(i),this.fetchReserves()}searchReserves(){this.currentPage.set(1),this.fetchReserves()}fetchReserves(){this.teacherReserveService.apiTeacherReservesReservesGet({courseId:this.courseSig()==="all"?"":this.courseSig(),range:this.rangeSig(),page:this.currentPage()}).subscribe(i=>{this.reserves.set(i.data?.reserves||[]),this.totalCount.set(i.data?.totalCount||0)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["tmf-recent-reserve"]],inputs:{courseList:"courseList"},standalone:!0,features:[S],decls:15,vars:12,consts:[[1,"w-full","overflow-auto","rounded-lg","border","border-tmf-gray-2","p-4","shadow-md"],[1,"flex","min-w-[768px]","items-center","gap-4",3,"formGroup"],[1,"whitespace-nowrap","text-2xl","font-bold"],["formControlName","range",1,"!w-[250px]"],[3,"label","value"],["formControlName","course",1,"!w-[250px]"],[1,"whitespace-nowrap","rounded-md","bg-tmf-orange-1","px-4","py-[6px]","text-center","text-white",3,"click"],[1,"mb-5","flex","min-h-[654px]","flex-wrap","gap-5"],[3,"reserve"],[1,"flex","justify-center"],[1,"mx-auto",3,"pageChange","config"]],template:function(n,o){n&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"\u8FD1\u671F\u9810\u7D04"),s(),a(4,"tmf-select",3),m(5,"tmf-option",4)(6,"tmf-option",4)(7,"tmf-option",4),s(),a(8,"tmf-select",5),m(9,"tmf-option",4),x(10,Be,1,2,"tmf-option",4,ge),s(),a(12,"button",6),_("click",function(){return o.searchReserves()}),c(13," \u67E5\u8A62 "),s()(),y(14,$e,5,4),s()),n&2&&(l(),z("mb",o.totalCount()),d("formGroup",o.fg),l(4),d("label","\u8FD1\u5169\u5929")("value","twoDays"),l(),d("label","\u8FD1\u4E00\u9031")("value","week"),l(),d("label","\u8FD1\u4E00\u500B\u6708")("value","month"),l(2),d("label","\u5168\u90E8")("value","all"),l(),C(o.courseList),l(4),R(14,o.totalCount()?14:-1))},dependencies:[I,j,O,B,V,$,A,N,q,Q],encapsulation:2});let t=e;return t})();var Ge=(t,e)=>({itemsPerPage:5,totalItems:t,currentPage:e,showFirstButton:!1,showLastButton:!1}),je=(t,e)=>({"bg-white":t,"bg-tmf-gray-7":e});function Ne(t,e){if(t&1&&(a(0,"tr",4)(1,"td"),c(2),s(),a(3,"td"),c(4),s(),a(5,"td"),c(6),s(),a(7,"td"),c(8),s(),a(9,"td"),c(10),s(),a(11,"td"),c(12),s()()),t&2){let r=e.$implicit,i=e.$index;d("ngClass",M(8,je,i%2===0,i%2!==0)),l(2),k(r.course_name),l(2),k(r.student==null?null:r.student.nick_name),l(2),J("",r.reserved_amount,"/",r.total,""),l(2),k(r.reserve_date),l(2),k(r.reserve_time),l(2),k(r.student==null?null:r.student.email)}}function Ae(t,e){if(t&1){let r=w();a(0,"div",0)(1,"table",1)(2,"thead",2)(3,"tr")(4,"th"),c(5,"\u8AB2\u7A0B"),s(),a(6,"th"),c(7,"\u5B78\u751F"),s(),a(8,"th"),c(9,"\u9810\u7D04\u5802\u6B21"),s(),a(10,"th"),c(11,"\u65E5\u671F"),s(),a(12,"th"),c(13,"\u6642\u9593"),s(),a(14,"th"),c(15,"\u5B78\u751F\u806F\u7D61\u8CC7\u6599"),s()()(),a(16,"tbody",3),x(17,Ne,13,11,"tr",4,D),s()()(),a(19,"div",5)(20,"tmf-pagination",6),_("pageChange",function(n){g(r);let o=u();return h(o.pageChange(n))}),s()()}if(t&2){let r=u();l(17),C(r.tableReserves()),l(3),d("config",M(1,Ge,r.totalCount(),r.currentPage()))}}var _e=(()=>{let e=class e{constructor(){this.totalCount=Z.required(),this.tableReserves=Z.required(),this.currentPage=v(1),this.changePageEvent=re()}ngOnInit(){}pageChange(i){this.currentPage.set(i),this.changePageEvent.emit(i)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["tmf-reserve-table"]],inputs:{totalCount:[X.SignalBased,"totalCount"],tableReserves:[X.SignalBased,"tableReserves"]},outputs:{changePageEvent:"changePageEvent"},standalone:!0,features:[S],decls:1,vars:1,consts:[[1,"mb-5","h-[286px]"],[1,"reserved_table","w-full"],[1,"border-b","border-tmf-gray-5","text-base","font-normal","text-tmf-gray-2"],[1,"text-center"],[1,"border-b","border-tmf-gray-5",3,"ngClass"],[1,"flex","justify-center"],[1,"mx-auto",3,"pageChange","config"]],template:function(n,o){n&1&&y(0,Ae,21,4),n&2&&R(0,o.totalCount()>0?0:-1)},dependencies:[L,q],styles:["table.reserved_table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]{padding:.5rem .75rem}table.reserved_table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{padding:.75rem}table.reserved_table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]:first-child, table.reserved_table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child{padding-left:.75rem}table.reserved_table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]:last-child, table.reserved_table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:last-child{padding-right:.75rem}"]});let t=e;return t})();var xe=(t,e)=>e._id;function qe(t,e){if(t&1&&m(0,"tmf-option",9),t&2){let r=e.$implicit;d("label",r.name)("value",r._id)}}function We(t,e){if(t&1&&m(0,"tmf-option",9),t&2){let r=e.$implicit;d("label",r.nick_name)("value",r._id)}}function He(t,e){if(t&1){let r=w();a(0,"div",3)(1,"tmf-select",8),m(2,"tmf-option",9),x(3,qe,1,2,"tmf-option",9,xe),s(),a(5,"tmf-select",10),m(6,"tmf-option",9),x(7,We,1,2,"tmf-option",9,xe),s(),a(9,"button",11),_("click",function(){g(r);let n=u();return h(n.fetchReserveTable())}),c(10," \u67E5\u8A62 "),s()()}if(t&2){let r=u();d("formGroup",r.fg),l(2),d("label","\u5168\u90E8")("value","all"),l(),C(r.courseList),l(3),d("label","\u5168\u90E8")("value","all"),l(),C(r.filterStudentList())}}function Ue(t,e){if(t&1){let r=w();a(0,"tmf-reserve-table",12),_("changePageEvent",function(n){g(r);let o=u();return h(o.changeTablePage(n))}),s()}if(t&2){let r=u();d("totalCount",r.tableCount())("tableReserves",r.tableReserves())}}function ze(t,e){if(t&1&&m(0,"full-calendar",13),t&2){let r=u();d("options",r.calendarOptions)}}var Ce=(()=>{let e=class e{constructor(){this.teacherReserveService=f(T),this.fb=f(G),this.courseList=[],this.studentList=[],this.tableReserves=v([]),this.tableCount=v(0),this.fg=this.fb.group({course:[""],student:[""],viewMode:["table"]}),this.courseSig=F(this.fg.controls.course.valueChanges.pipe(U(()=>this.fg.controls.student.setValue("")))),this.studentSig=F(this.fg.controls.student.valueChanges),this.filterStudentList=P(()=>{let i=this.courseSig();return this.studentList.find(o=>o.course_id===i)?.students||[]})}ngOnInit(){this.fetchReserveTable(),this.calendarOptions={initialView:"dayGridMonth",plugins:[ue,me],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek"},locale:"zh-tw",showNonCurrentDates:!0,weekends:!0,selectable:!0,allDaySlot:!1,eventContent:function(i){let[n,o]=i.event.title.split(" "),p=i.event.start?.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),H=i.event.end?.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1});return{html:`
              <div style="display: flex; flex-direction: column;">
                <p class="">${p} - ${H}</p>
                <div style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${n}</div>
                <div>${o}</div>
              </div>
            `}},dayMaxEventRows:!0,dayMaxEvents:2,views:{timeGrid:{dayMaxEventRows:1,dayMaxEvents:1}},moreLinkContent:function(i){return"+"+i.num+" \u7B46\u9810\u7D04"},windowResize:({view:i})=>{window.innerWidth<=1024&&i.calendar.changeView("dayGridMonth"),this.handleWindowResize(i)},datesSet:({view:i})=>{let n=i.calendar.getDate().toLocaleDateString().split("/").join("-").slice(0,6);this.handleDatesSet(n)}},this.fg.controls.viewMode.valueChanges.subscribe(i=>{i==="table"&&(this.fg.controls.course.setValue(""),this.fg.controls.student.setValue(""),this.fetchReserveTable())})}fetchReserveTable(i=1){this.teacherReserveService.apiTeacherReservesListGet({studentId:this.studentSig()==="all"?"":this.studentSig(),courseId:this.courseSig()==="all"?"":this.courseSig(),page:i}).subscribe(n=>{let{reserves:o,totalCount:p}=n.data;this.tableReserves.set(o),this.tableCount.set(p)})}changeTablePage(i){this.fetchReserveTable(i)}handleDatesSet(i){this.teacherReserveService.apiTeacherReservesCalendarGet({date:i}).subscribe(n=>{let o=this.transformDataToEvents(n.data);this.calendarOptions.events=o})}getHeaderToolbar(){return window.innerWidth<=1024?{left:"dayGridMonth",center:"title",right:"prev,next"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek"}}handleWindowResize(i){this.calendarOptions.headerToolbar=this.getHeaderToolbar()}transformDataToEvents(i){let n=[];return i.calendar.forEach(o=>{let p=o.date;o.courses.forEach(H=>{let we=H.courseName;H.students.forEach(ee=>{let Se=ee.studentName,ye=ee.time,te=`${p}T${ye}`,Re=`${p}T${this.calculateEndTime(te)}`;n.push({title:`${we} ${Se}`,start:te,end:Re})})})}),n}calculateEndTime(i){let n=new Date(i);return n.setHours(n.getHours()+1),n.toLocaleTimeString("en-US",{hour12:!1}).slice(0,5)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["tmf-reserved-block"]],inputs:{courseList:"courseList",studentList:"studentList"},standalone:!0,features:[S],decls:14,vars:3,consts:[[1,"w-full","overflow-auto"],[1,"flex","min-w-[900px]","items-center","justify-between"],[1,"whitespace-nowrap","text-2xl","font-bold"],[1,"flex","items-center","justify-end","gap-4",3,"formGroup"],[1,"flex","items-center","gap-2",3,"formGroup"],[1,"custom-radio"],["type","radio","name","viewMode","formControlName","viewMode","value","table","checked","",1,"hidden"],["type","radio","name","viewMode","formControlName","viewMode","value","calendar",1,"hidden"],["formControlName","course",1,"!w-[250px]"],[3,"label","value"],["formControlName","student",1,"!w-[250px]"],[1,"whitespace-nowrap","rounded-md","bg-tmf-orange-1","px-4","py-[6px]","text-center","text-white",3,"click"],[3,"changePageEvent","totalCount","tableReserves"],[3,"options"]],template:function(n,o){if(n&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"\u5DF2\u9810\u7D04\u6642\u6BB5"),s(),y(4,He,11,5,"div",3),a(5,"div",4)(6,"label",5),m(7,"input",6),c(8," \u5217\u8868 "),s(),a(9,"label",5),m(10,"input",7),c(11," \u65E5\u66C6 "),s()()(),y(12,Ue,1,2)(13,ze,1,1),s()),n&2){let p;l(4),R(4,o.fg.controls.viewMode.value==="table"?4:-1),l(),d("formGroup",o.fg),l(7),R(12,(p=o.fg.controls.viewMode.value)==="table"?12:p==="calendar"?13:-1)}},dependencies:[A,N,j,ae,le,O,B,V,$,de,ce,_e],styles:[".custom-radio[_ngcontent-%COMP%]{display:flex;cursor:pointer;align-items:center;justify-content:space-between;white-space:nowrap;border-radius:.5rem;border-width:1px;--tw-border-opacity: 1;border-color:rgb(212 212 212 / var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity));padding-left:1rem;padding-right:1rem;padding-top:6px;padding-bottom:6px;--tw-text-opacity: 1;color:rgb(51 51 51 / var(--tw-text-opacity))}.custom-radio[_ngcontent-%COMP%]:has(input[type=radio]:checked){--tw-border-opacity: 1;border-color:rgb(255 255 255 / var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:rgb(141 0 153 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity))}"]});let t=e;return t})();var Je=(t,e)=>e.time,Ke=(t,e,r,i)=>({"bg-tmf-gray-4":t,"bg-green-300":e,"cursor-pointer":r,"cursor-not-allowed":i});function Qe(t,e){if(t&1){let r=w();a(0,"button",8),_("click",function(){g(r);let n=u();return h(n.toggleEditMode())}),c(1," \u7DE8\u8F2F "),s()}}function Xe(t,e){if(t&1){let r=w();a(0,"div",9)(1,"button",10),_("click",function(){g(r);let n=u();return h(n.toggleEditMode())}),c(2," \u53D6\u6D88 "),s(),a(3,"button",11),_("click",function(){g(r);let n=u();return h(n.saveCanReserveTime())}),c(4," \u5132\u5B58 "),s()()}}function Ye(t,e){if(t&1&&(a(0,"th",6),c(1),s()),t&2){let r=e.$implicit;l(),E(" ",r," ")}}function Ze(t,e){if(t&1){let r=w();a(0,"td",15)(1,"div",16),_("mousedown",function(){let n=g(r).$implicit,o=u(2);return h(o.startSelection(n.day,n))})("mouseover",function(){let n=g(r).$implicit,o=u(2);return h(o.continueSelection(n.day,n))})("mouseup",function(){let n=g(r).$implicit,o=u(2);return h(o.endSelection(n.day,n))}),a(2,"span",17),c(3),s()()()}if(t&2){let r=e.$implicit,i=u(2);l(),d("ngClass",se(2,Ke,!r.status,r.status,i.isEditMode(),!i.isEditMode())),l(2),E(" ",r.status?"done":"do_not_disturb_on"," ")}}function et(t,e){if(t&1&&(a(0,"tr",7)(1,"td",12)(2,"p",13),c(3),s(),a(4,"p",14),c(5),s()(),x(6,Ze,4,7,"td",15,D),s()),t&2){let r=e.$implicit,i=e.$index;l(3),k(i+1),l(2),E(" ",r.time," "),l(),C(r.statues)}}var be=(()=>{let e=class e{constructor(){this.teacherReserveService=f(T),this.dialogService=f(K),this.isEditMode=v(!1),this.days=["\u9031\u65E5","\u9031\u4E00","\u9031\u4E8C","\u9031\u4E09","\u9031\u56DB","\u9031\u4E94","\u9031\u516D"],this.hours=[9,10,11,13,14,15,16,17,19,20],this.can_reserve_week=v({mon:[],tue:[],wed:[],thu:[],fri:[],sat:[],sun:[]}),this.can_reserve_time=[],this.isSelecting=v(!1),this.startSelect=v(null)}ngOnInit(){this.teacherReserveService.apiTeacherReservesCanReserveWeekGet().subscribe(i=>{let[n]=i.data?.can_reserve_week||[];this.can_reserve_week.set(n),this.generateReservationStatus()})}generateReservationStatus(){this.can_reserve_time=this.hours.map(i=>{let n=this.formatHour(i),o=["sun","mon","tue","wed","thu","fri","sat"].map(p=>({day:p,status:!!this.can_reserve_week()[p].includes(i)}));return{time:n,statues:o}})}formatHour(i){return`${i.toString().padStart(2,"0")}:00`}startSelection(i,n){this.isEditMode()&&(this.isSelecting.set(!0),n.status?(n.status=!1,this.startSelect.set({week:i,hour:n.time,toggleTo:!1})):(n.status=!0,this.startSelect.set({week:i,hour:n.time,toggleTo:!0})))}continueSelection(i,n){this.isSelecting()&&this.startSelect().week===i&&(n.status=this.startSelect().toggleTo)}endSelection(i,n){this.isSelecting.set(!1),this.startSelect.set(null)}toggleEditMode(){this.isEditMode.set(!this.isEditMode())}saveCanReserveTime(){let i={mon:[],tue:[],wed:[],thu:[],fri:[],sat:[],sun:[]};this.can_reserve_time.forEach(n=>{n.statues.forEach(o=>{o.status&&i[o.day].push(parseInt(n.time.split(":")[0]))})}),this.teacherReserveService.apiTeacherReservesCanReserveWeekPatch({updateCanReserveWeekRequestModel:{can_reserve_week:[i]}}).subscribe(n=>{this.dialogService.openAlertDialog({title:"\u6210\u529F",content:n.data?.message||"\u66F4\u65B0\u6210\u529F"}),this.isEditMode.set(!1)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["tmf-can-reserve-time"]],standalone:!0,features:[S],decls:15,vars:1,consts:[[1,"mb-4","flex","items-center","justify-between","gap-4"],[1,"text-2xl","font-bold","whitespace-nowrap"],[1,"box-border","rounded-md","border","border-tmf-gray-2","bg-white","px-4","py-[6px]","text-center","text-tmf-gray-2"],[1,"w-full","overflow-x-auto"],[1,"w-full","select-none","border","border-tmf-orange-1","min-w-[768px]"],[1,"w-[60px]","bg-tmf-orange-4","px-3","py-2"],[1,"bg-tmf-orange-4","px-3","py-2"],[1,"text-center"],[1,"box-border","rounded-md","border","border-tmf-gray-2","bg-white","px-4","py-[6px]","text-center","text-tmf-gray-2",3,"click"],[1,"flex","items-center","gap-2"],[1,"rounded-md","border","border-tmf-gray-2","bg-white","px-4","py-[6px]","text-center","text-tmf-gray-2","whitespace-nowrap",3,"click"],[1,"rounded-md","bg-tmf-orange-1","px-4","py-[6px]","text-center","text-white","whitespace-nowrap",3,"click"],[1,"bg-tmf-orange-4","py-2.5"],[1,"text-base","font-bold"],[1,"text-sm","font-bold","text-tmf-orange-1"],[1,"p-2"],[1,"flex","items-center","justify-center","rounded-lg","py-3","xl:px-3",3,"mousedown","mouseover","mouseup","ngClass"],[1,"material-icons-outlined","text-base","leading-4","text-white","xl:text-[24px]","xl:leading-6"]],template:function(n,o){n&1&&(a(0,"div",0)(1,"h2",1),c(2,"\u53EF\u9810\u7D04\u6642\u6BB5"),s(),y(3,Qe,2,0,"button",2)(4,Xe,5,0),s(),a(5,"div",3)(6,"table",4)(7,"thead")(8,"tr"),m(9,"th",5),x(10,Ye,2,1,"th",6,D),s()(),a(12,"tbody"),x(13,et,8,2,"tr",7,Je),s()()()),n&2&&(l(3),R(3,o.isEditMode()?4:3),l(7),C(o.days),l(3),C(o.can_reserve_time))},dependencies:[L]});let t=e;return t})();var mn=(()=>{let e=class e{constructor(){this.teacherReserveService=f(T),this.courseList=[],this.studentList=[]}ngOnInit(){this.teacherReserveService.apiTeacherReservesCourseListGet().subscribe(i=>{this.courseList=i.data?.courseList||[],this.studentList=i.data?.studentList||[]})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-teacher-calendar-page"]],standalone:!0,features:[S],decls:9,vars:5,consts:[[1,"mb-6","text-3xl","font-bold","text-tmf-gray-1"],[1,"flex","flex-col","gap-3"],[3,"courseList"],[3,"courseList","studentList"],[1,"rounded-lg","border","border-tmf-gray-2","p-4","shadow-md"]],template:function(n,o){n&1&&(a(0,"h1",0),c(1,"\u8AB2\u7A0B\u9810\u7D04\u7BA1\u7406"),s(),a(2,"div",1),m(3,"tmf-recent-reserve",2)(4,"tmf-expired-reserve",3),a(5,"div",4),m(6,"tmf-reserved-block",3),s(),a(7,"div",4),m(8,"tmf-can-reserve-time"),s()()),n&2&&(l(3),d("courseList",o.courseList),l(),d("courseList",o.courseList)("studentList",o.studentList),l(2),d("courseList",o.courseList)("studentList",o.studentList))},dependencies:[I,he,fe,Ce,be]});let t=e;return t})();export{mn as default};

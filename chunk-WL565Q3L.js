import{a as A}from"./chunk-XPLGP64B.js";import{i as $}from"./chunk-UCUMTS2Y.js";import"./chunk-INKIBVR7.js";import{e as w,k as V,q as M,s as T}from"./chunk-BJV7KTFY.js";import{a as D}from"./chunk-SFQLGEEG.js";import"./chunk-AII6RJAH.js";import{v as F}from"./chunk-GONTSOGY.js";import{Gb as g,Na as f,Ob as k,Za as x,aa as p,db as y,fa as b,fb as C,jb as S,lb as P,mb as v,nb as E,ob as s,pa as d,pb as a,qa as u,ub as _,xb as m,yb as l}from"./chunk-Y7HHJWJT.js";import"./chunk-MON7YFGF.js";function I(i,r){if(i&1){let o=_();s(0,"div",2)(1,"button",4),m("click",function(){d(o);let e=l();return u(e.updatePreferences())}),g(2," \u5132\u5B58 "),a(),s(3,"button",5),m("click",function(){d(o);let e=l();return u(e.cancelEditMode())}),g(4," \u53D6\u6D88 "),a()()}}function O(i,r){if(i&1){let o=_();s(0,"button",6),m("click",function(){d(o);let e=l();return u(e.openEditMode())}),s(1,"span",7),g(2," edit_square "),a(),g(3," \u7DE8\u8F2F "),a()}}function j(i,r){if(i&1){let o=_();s(0,"div",3)(1,"tmf-checkbox",8),m("checkedChange",function(e){let n=d(o).$index,c=l();return u(c.handleMainCategoryChange(e,n))}),a(),s(2,"div",9)(3,"tmf-checkbox",10),m("checkedChange",function(e){let n=d(o).$index,c=l();return u(c.handleSubCategoryChange(e,n))}),a()()()}if(i&2){let o=r.$implicit,t=r.$index,e=l();f(),C("label",o.main_category)("direct","horizontal")("formControl",e.tagsFormArray.at(t).controls.main_category),f(2),C("formControl",e.tagsFormArray.at(t).controls.sub_category)("single",!1)("options",e.getSubTagOptions(o.sub_category))}}var L=(()=>{let r=class r{constructor(){this.commonService=p(D),this.fb=p(M),this.studentPreferenceService=p($),this.tags=[],this.tagsFormArray=this.fb.array([]),this.isEditMode=x(!1)}ngOnInit(){this.commonService.apiCommonTagGet().subscribe(t=>{this.tags=t.data,this.tags.forEach(e=>{this.tagsFormArray.push(this.fb.group({id:this.fb.control(e._id),main_category:this.fb.control(!1),sub_category:this.fb.control([])}))}),this.cancelEditMode(),this.getPreferences()}),this.getPreferences()}openEditMode(){this.isEditMode.set(!0),this.tagsFormArray.enable()}cancelEditMode(){this.isEditMode.set(!1),this.tagsFormArray.disable()}getPreferences(){this.studentPreferenceService.apiStudentPreferenceGet().subscribe(t=>{let e=t.data;this.tagsFormArray.controls.forEach((n,c)=>{let h=e?.find(B=>B.preference_id===n.get("id")?.value);h&&n.patchValue({main_category:h.preference_tags?.length===this.tags[c].sub_category?.length,sub_category:h.preference_tags})})})}updatePreferences(){let t=this.tagsFormArray.value.filter(e=>e.sub_category&&e.sub_category.length).map(e=>({preference_id:e.id,preference_tags:e.sub_category}));this.studentPreferenceService.apiStudentPreferencePost({updateStudentPreferencesRequestModelInner:t}).subscribe(e=>{this.cancelEditMode(),this.getPreferences()})}getSubTagOptions(t){return t.map(e=>({label:e,value:e}))}handleMainCategoryChange(t,e){let n=this.tagsFormArray.controls[e].get("sub_category");t?n?.setValue(this.tags[e].sub_category.map(c=>c)):n?.setValue([])}handleSubCategoryChange(t,e){let n=this.tagsFormArray.controls[e].get("main_category");t.length===this.tags[e].sub_category?.length?n?.setValue(!0):n?.setValue(!1)}};r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=b({type:r,selectors:[["app-student-preference-page"]],standalone:!0,features:[k],decls:7,vars:1,consts:[[1,"mb-5","flex","w-full","justify-between"],[1,"text-[22px]","md:text-[26px]","lg:text-[30px]","font-bold","leading-9"],[1,"flex","gap-2"],[1,"mb-5","flex","flex-col","items-start","gap-3"],[1,"rounded-md","bg-tmf-orange-1","px-5","py-2","text-white",3,"click"],[1,"rounded-md","bg-tmf-gray-3","px-5","py-2","text-white",3,"click"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","px-3","py-2","text-white",3,"click"],[1,"material-symbols-outlined"],[3,"checkedChange","label","direct","formControl"],[1,"rounded-lg","bg-tmf-gray-6","p-3"],[3,"checkedChange","formControl","single","options"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"h1",1),g(2,"\u559C\u597D\u985E\u5225"),a(),y(3,I,5,0,"div",2)(4,O,4,0),a(),v(5,j,4,6,"div",3,P)),e&2&&(f(3),S(3,n.isEditMode()?3:4),f(2),E(n.tags))},dependencies:[F,T,w,V,A]});let i=r;return i})();export{L as default};

import{a as $,b as X}from"./chunk-EIWDFQ3O.js";import{a as W}from"./chunk-CSQAIJWP.js";import{c as K}from"./chunk-ICY3H276.js";import"./chunk-6CFFCDSB.js";import"./chunk-EFXHSPSL.js";import"./chunk-FDJYYR2J.js";import{a as Y,d as U}from"./chunk-T3Y2OTFZ.js";import{n as J,o as Q}from"./chunk-IXL4YB3E.js";import"./chunk-N764XXSV.js";import"./chunk-UXLL4RDX.js";import{a as j,b as H}from"./chunk-5IRIJ7EB.js";import"./chunk-M6PVZGW2.js";import{c as v,e as k,f as B,l as L,o as M,q,s as G}from"./chunk-VOBGA6RN.js";import"./chunk-P2WCFEXO.js";import"./chunk-TCRDAKVE.js";import{a as z}from"./chunk-3E6NSQOV.js";import"./chunk-5GUPSS47.js";import{v as O}from"./chunk-3PMTIMLI.js";import{Fb as D,Gb as a,Hb as V,Ib as F,Na as l,Ob as N,P as I,Za as P,aa as h,db as T,fa as R,fb as s,jb as y,lb as E,mb as b,nb as S,ob as n,pa as p,pb as o,qa as _,qb as x,ub as g,xb as f,y as A,yb as m}from"./chunk-3A66ECCW.js";import{a as w}from"./chunk-MON7YFGF.js";function ne(i,d){if(i&1){let t=g();n(0,"button",6),f("click",function(){p(t);let e=m();return _(e.changeView(e.ViewMode.Create))}),n(1,"span",7),a(2," add "),o(),a(3," \u65B0\u589E\u5F71\u7247 "),o()}}function oe(i,d){if(i&1){let t=g();n(0,"button",8),f("click",function(){p(t);let e=m();return _(e.changeView(e.ViewMode.List))}),n(1,"span",9),a(2," reply "),o(),n(3,"span",10),a(4," \u8FD4\u56DE "),o()(),n(5,"button",8),f("click",function(){p(t);let e=m();return _(e.save())}),n(6,"span",9),a(7),o(),n(8,"span",10),a(9),o()()}if(i&2){let t=m();l(7),F(" ",t.mode()===t.ViewMode.Create?"add":"save"," "),l(2),F(" ",t.mode()===t.ViewMode.Create?"\u5275\u5EFA":"\u5132\u5B58"," ")}}function re(i,d){if(i&1){let t=g();n(0,"div",11)(1,"div",12),x(2,"tmf-video-card",13),n(3,"div",14)(4,"div",15)(5,"button",8),f("click",function(){let e=p(t).$implicit,c=m(2);return _(c.changeView(c.ViewMode.Edit,e))}),n(6,"span",9),a(7," edit_square "),o()(),n(8,"button",8),f("click",function(){let e=p(t).$implicit,c=m(2);return _(c.deleteVideo(e))}),n(9,"span",9),a(10," delete "),o()()(),n(11,"div",5)(12,"p")(13,"span",16),a(14,"\u540D\u7A31\uFF1A"),o(),n(15,"span",17),a(16),o()(),n(17,"p")(18,"span",16),a(19,"\u985E\u5225\uFF1A"),o(),n(20,"span",17),a(21),o()(),n(22,"p")(23,"span",16),a(24,"\u7C21\u4ECB\uFF1A"),o(),n(25,"span",17),a(26),o()()()()()()}if(i&2){let t=d.$implicit;l(2),s("data",t),l(14),V(t.name),l(5),V(t.category),l(5),V(t.intro)}}function ae(i,d){if(i&1&&(n(0,"div",5),b(1,re,27,4,"div",11,E),o()),i&2){let t=m();l(),S(t.videos)}}function le(i,d){if(i&1&&x(0,"tmf-option",21),i&2){let t=d.$implicit;s("value",t.main_category)("label",t.main_category||"")}}function de(i,d){if(i&1&&x(0,"tmf-input",28),i&2){let t=m(2);s("isRequired",!0)("formControlName",t.UploadFormKey.URL)("inputType",t.InputType.Outline)}}function ce(i,d){if(i&1){let t=g();n(0,"p",24)(1,"span",25),a(2,"\u5F71\u7247\u6A94\u6848"),o(),n(3,"span",26),a(4,"*"),o()(),n(5,"div",29)(6,"button",30),f("click",function(){p(t);let e=D(11);return _(e.click())}),a(7," \u4E0A\u50B3\u6A94\u6848 "),o(),n(8,"p"),a(9),o()(),n(10,"input",31,0),f("change",function(e){p(t);let c=m(2);return _(c.hanldeVideoChange(e))}),o()}if(i&2){let t=m(2);l(9),V(t.currentFile==null?null:t.currentFile.name)}}function ue(i,d){if(i&1&&(n(0,"div",18),x(1,"tmf-input",19),n(2,"tmf-select",20),b(3,le,1,2,"tmf-option",21,E),o(),x(5,"tmf-textarea",22),n(6,"div",23)(7,"p",24)(8,"span",25),a(9,"\u5F71\u7247\u70BA\u5916\u90E8\u9023\u7D50"),o(),n(10,"span",26),a(11,"*"),o()(),x(12,"tmf-switch",27),o(),T(13,de,1,3,"tmf-input",28)(14,ce,12,1),o()),i&2){let t=m();s("formGroup",t.uploadForm),l(),s("isRequired",!0)("formControlName",t.UploadFormKey.NAME)("inputType",t.InputType.Outline),l(),s("isRequired",!0)("formControlName",t.UploadFormKey.CATEGORY),l(),S(t.categoryOptions),l(2),s("isRequired",!0)("formControlName",t.UploadFormKey.INTRO),l(7),s("formControlName",t.UploadFormKey.VIDEO_TYPE),l(),y(13,t.videoType.value?13:14)}}var C=function(i){return i.List="list",i.Edit="edit",i.Create="create",i}(C||{}),u=function(i){return i.NAME="name",i.CATEGORY="category",i.INTRO="intro",i.VIDEO_TYPE="video_type",i.URL="url",i.TEACHER_ID="teacher_id",i}(u||{}),ye=(()=>{let d=class d{constructor(){this.teacherVideoService=h(J),this.commonService=h(z),this.uploadService=h(Q),this.fb=h(q),this.dialogService=h(K),this.mode=P(C.List),this.videos=[],this.categoryOptions=[],this.uploadForm=this.fb.group({[u.NAME]:this.fb.control(null,[v.required]),[u.CATEGORY]:this.fb.control(null,[v.required]),[u.INTRO]:this.fb.control(null,[v.required]),[u.VIDEO_TYPE]:this.fb.control(!1,[v.required]),[u.URL]:this.fb.control(null)}),this.currentFile=null,this.ViewMode=C,this.UploadFormKey=u,this.InputType=Y}get videoType(){return this.uploadForm.controls[u.VIDEO_TYPE]}ngOnInit(){this.getVideoList(),this.commonService.apiCommonTagGet().subscribe(r=>this.categoryOptions=r.data)}getVideoList(){this.teacherVideoService.apiTeacherVideoGet().subscribe(r=>{this.videos=r.data.map(e=>w({video_id:e._id,name:e.name,category:e.category,intro:e.intro,video_type:e.video_type,url:e.url,teacher_id:e.teacher_id},e.course_id?{course_id:e.course_id}:{}))})}changeView(r,e){this.mode.set(r),r===C.List?(this.uploadForm.reset(),this.currentFile=null):r===C.Edit&&this.uploadForm.patchValue({[u.NAME]:e?.name||"",[u.CATEGORY]:e?.category||"",[u.INTRO]:e?.intro||"",[u.VIDEO_TYPE]:e?.video_type==="youtube"||!1,[u.URL]:e?.video_type==="youtube"?e?.url:""})}deleteVideo(r){this.dialogService.openConfirmDialog({title:"\u662F\u5426\u522A\u9664\u6B64\u5F71\u7247?",content:"\u522A\u9664\u5F8C\u7121\u6CD5\u5FA9\u539F",confirmBtnText:"\u78BA\u5B9A",btnType:"danger"}).pipe(A(e=>e),I(()=>this.teacherVideoService.apiTeacherVideoVideoIdDelete({videoId:r.video_id}))).subscribe(()=>{this.getVideoList()})}save(){let r=()=>{let{name:c,category:Z,intro:ee,url:te,video_type:ie}=this.uploadForm.getRawValue();this.teacherVideoService.apiTeacherVideoPost({addTeacherVideoRequestModel:{name:c,category:Z,intro:ee,url:te,video_type:ie?"youtube":"storage"}}).subscribe(()=>{this.getVideoList(),this.uploadForm.reset(),this.currentFile=null,this.changeView(C.List)})};if(this.uploadForm.controls[u.VIDEO_TYPE].value===!1){if(!this.currentFile)return;this.uploadService.apiUploadFilePost({fileType:"video",path:"user",file:this.currentFile}).subscribe(({fileUrl:c})=>{this.uploadForm.controls[u.URL].setValue(c||""),r()})}else r()}hanldeVideoChange(r){let e=r.target.files?.[0];e&&(this.currentFile=e)}};d.\u0275fac=function(e){return new(e||d)},d.\u0275cmp=R({type:d,selectors:[["app-teacher-videos-page"]],standalone:!0,features:[N],decls:8,vars:2,consts:[["file",""],[1,"mb-5","flex","w-full","justify-between"],[1,"text-[22px]","font-bold","leading-9","md:text-[26px]","lg:text-[30px]"],[1,"flex","items-center","gap-x-2"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","px-3","py-2","text-white"],[1,"flex","flex-col","gap-3"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","px-3","py-2","text-white",3,"click"],[1,"material-symbols-outlined"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","p-1","text-white","md:px-3","md:py-2",3,"click"],[1,"material-symbols-outlined","text-[20px]","md:text-[22px]"],[1,"hidden","lg:block"],[1,"flex","w-full","items-center","gap-3","rounded-lg","border","p-3","md:p-5"],[1,"flex","w-full","flex-col","gap-5","lg:flex-row"],[1,"order-2","lg:order-1",3,"data"],[1,"order-1","flex-grow","lg:order-2"],[1,"mb-3","flex","justify-end","gap-3"],[1,"text-base","text-gray-500","md:text-lg"],[1,"text-sm","md:text-base"],[1,"flex","flex-col","overflow-auto",3,"formGroup"],["label","\u8AB2\u7A0B\u540D\u7A31","placeholder","\u8ACB\u8F38\u5165\u8AB2\u7A0B\u540D\u7A31",3,"isRequired","formControlName","inputType"],["label","\u5F71\u7247\u985E\u5225",1,"mb-6",3,"isRequired","formControlName"],[3,"value","label"],["label","\u5F71\u7247\u7C21\u4ECB","placeholder","\u8ACB\u8F38\u5165\u5F71\u7247\u7C21\u4ECB",3,"isRequired","formControlName"],[1,"mb-6","flex","flex-col"],[1,"mb-1"],[1,"select-label"],[1,"text-red-500"],[3,"formControlName"],["label","\u5F71\u7247\u9023\u7D50","placeholder","\u8ACB\u8F38\u5165\u5F71\u7247\u9023\u7D50",3,"isRequired","formControlName","inputType"],[1,"flex","items-center","gap-1"],[1,"w-[100px]","rounded-md","bg-tmf-orange-1","py-1","text-white",3,"click"],["type","file","hidden","","accept","video/*",3,"change"]],template:function(e,c){e&1&&(n(0,"div",1)(1,"h1",2),a(2," \u5F71\u7247\u7BA1\u7406 "),o(),n(3,"div",3),T(4,ne,4,0,"button",4)(5,oe,10,2),o()(),T(6,ae,3,0,"div",5)(7,ue,15,10)),e&2&&(l(4),y(4,c.mode()===c.ViewMode.List?4:5),l(2),y(6,c.mode()===c.ViewMode.List?6:7))},dependencies:[O,G,k,B,L,M,W,U,H,j,$,X]});let i=d;return i})();export{C as ViewMode,ye as default};

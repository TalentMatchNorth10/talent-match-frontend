import{a as N}from"./chunk-Y2VEVUA6.js";import{e as G,f as M,i as D,j as k,k as V,l as B}from"./chunk-DLADY7WT.js";import{d as O,e as U}from"./chunk-273FSB7P.js";import"./chunk-IWZQJP7X.js";import{Ea as s,Fa as p,G as I,Ha as c,La as r,Ma as i,Na as f,Pa as v,Qa as C,Ra as d,S as g,Ta as l,Ua as _,V as E,Y as b,Ya as w,ab as P,bb as F,ca as x,da as h,k as S,qa as y,sa as m,za as T}from"./chunk-PVGZUZXN.js";import"./chunk-2XJVAMHT.js";var A=(()=>{let n=class n{constructor(){}transform(e){let a=new Date(e);return new Date(a.getTime()-a.getTimezoneOffset()*6e4).toISOString().split("T")[0]}};n.\u0275fac=function(a){return new(a||n)},n.\u0275pipe=b({name:"tmfDate",type:n,pure:!0,standalone:!0});let t=n;return t})();function z(t,n){if(t&1&&f(0,"img",4),t&2){let o=d();p("src",o.formGroup.controls.avator_image.value,y)}}function R(t,n){t&1&&f(0,"div",9)}function q(t,n){if(t&1){let o=v();r(0,"input",10),C("change",function(a){x(o);let u=d();return h(u.uploadImage(a))}),i()}}function H(t,n){t&1&&f(0,"tmf-input",6),t&2&&p("formControlName","name")}function J(t,n){if(t&1&&(r(0,"p"),l(1),i()),t&2){let o=d();m(),_(o.studentInfo==null?null:o.studentInfo.name)}}function K(t,n){t&1&&f(0,"tmf-input",6),t&2&&p("formControlName","nick_name")}function L(t,n){if(t&1&&(r(0,"p"),l(1),i()),t&2){let o=d();m(),_(o.studentInfo==null?null:o.studentInfo.nick_name)}}function Q(t,n){t&1&&f(0,"tmf-input",7),t&2&&p("formControlName","birthday")}function W(t,n){if(t&1&&(r(0,"p"),l(1),P(2,"tmfDate"),i()),t&2){let o=d();m(),_(F(2,1,o.studentInfo==null?null:o.studentInfo.birthday))}}function X(t,n){t&1&&f(0,"tmf-input",6),t&2&&p("formControlName","contact_phone")}function Y(t,n){if(t&1&&(r(0,"p"),l(1),i()),t&2){let o=d();m(),_(o.studentInfo==null?null:o.studentInfo.contact_phone)}}function Z(t,n){t&1&&f(0,"tmf-input",6),t&2&&p("formControlName","email")}function $(t,n){if(t&1&&(r(0,"p"),l(1),i()),t&2){let o=d();m(),_(o.studentInfo==null?null:o.studentInfo.email)}}function tt(t,n){if(t&1){let o=v();r(0,"div",8)(1,"button",11),C("click",function(){x(o);let a=d();return h(a.updateStudentInfo())}),l(2," \u5132\u5B58 "),i(),r(3,"button",12),C("click",function(){x(o);let a=d();return h(a.cancelEditMode())}),l(4," \u53D6\u6D88 "),i()()}}function et(t,n){if(t&1){let o=v();r(0,"button",11),C("click",function(){x(o);let a=d();return h(a.isEditMode.set(!0))}),l(1," \u7DE8\u8F2F "),i()}}var st=(()=>{let n=class n{constructor(){this.isEditMode=T(!1),this.fb=g(V),this.studentInfoService=g(O),this.uploadService=g(U),this.formGroup=this.fb.group({avator_image:this.fb.control(null),name:this.fb.control(null),nick_name:this.fb.control(null),birthday:this.fb.control(null),contact_phone:this.fb.control(null),email:this.fb.control(null)})}ngOnInit(){this.studentInfoService.apiStudentInfoBasicInfoGet().subscribe({next:e=>{e.status?(this.studentInfo=e.data,this.updateFormControls(this.studentInfo)):console.error(e)},error:e=>{console.error(e)}})}updateStudentInfo(){this.studentInfoService.apiStudentInfoBasicInfoPatch({updateStudentInfoRequestModel:{avator_image:this.formGroup.controls.avator_image.value,name:this.formGroup.controls.name.value,nick_name:this.formGroup.controls.nick_name.value,birthday:this.formGroup.controls.birthday.value,contact_phone:this.formGroup.controls.contact_phone.value,email:this.formGroup.controls.email.value}}).pipe(I(e=>e.status?this.studentInfoService.apiStudentInfoBasicInfoGet():S(()=>new Error("Failed to update student info")))).subscribe({next:e=>{e.status&&(this.studentInfo=e.data,console.log(this.studentInfo),this.updateFormControls(this.studentInfo),this.isEditMode.set(!1))}})}uploadImage(e){console.log(e),this.uploadService.apiUploadFilePost({file:e.target.files[0],path:"user"}).subscribe({next:a=>{this.formGroup.controls.avator_image.setValue(a.fileUrl)},error:a=>{console.error(a)}})}cancelEditMode(){this.isEditMode.set(!1),this.formGroup.controls.avator_image.setValue(this.studentInfo.avator_image)}updateFormControls(e){this.formGroup.setValue({avator_image:e.avator_image,name:e.name,nick_name:e.nick_name,birthday:new Date(e.birthday).toISOString().split("T")[0],contact_phone:e.contact_phone,email:e.email})}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=E({type:n,selectors:[["app-student-info-page"]],standalone:!0,features:[w],decls:38,vars:9,consts:[[1,"flex","items-center","justify-center"],[1,"text-xl","mb-4"],[1,"flex","flex-col","gap-4","mb-4",3,"formGroup"],[1,"font-bold"],["alt","",1,"w-[200px]","h-[200px]",3,"src"],["type","file","name","","id",""],[3,"formControlName"],["placeholder","yyyy-mm-dd",3,"formControlName"],[1,"flex","gap-2"],[1,"w-[200px]","h-[200px]","bg-tmf-gray-3"],["type","file","name","","id","",3,"change"],[1,"p-4","bg-tmf-orange-1","text-white","rounded-md",3,"click"],[1,"p-4","bg-tmf-gray-3","text-white","rounded-md",3,"click"]],template:function(a,u){a&1&&(r(0,"div",0)(1,"div")(2,"h1",1),l(3,"\u5B78\u751F\u57FA\u672C\u8CC7\u6599"),i(),r(4,"div",2)(5,"div")(6,"h2",3),l(7,"\u5927\u982D\u8CBC"),i(),s(8,z,1,1,"img",4)(9,R,1,0)(10,q,1,0,"input",5),i(),r(11,"div")(12,"h2",3),l(13,"\u59D3\u540D"),i(),s(14,H,1,1,"tmf-input",6)(15,J,2,1),i(),r(16,"div")(17,"h2",3),l(18,"\u66B1\u7A31"),i(),s(19,K,1,1,"tmf-input",6)(20,L,2,1),i(),r(21,"div")(22,"h2",3),l(23,"\u751F\u65E5"),i(),s(24,Q,1,1,"tmf-input",7)(25,W,3,3),i(),r(26,"div")(27,"h2",3),l(28,"\u806F\u7D61\u96FB\u8A71"),i(),s(29,X,1,1,"tmf-input",6)(30,Y,2,1),i(),r(31,"div")(32,"h2",3),l(33,"\u96FB\u5B50\u90F5\u4EF6"),i(),s(34,Z,1,1,"tmf-input",6)(35,$,2,1),i()(),s(36,tt,5,0,"div",8)(37,et,2,0),i()()),a&2&&(m(4),p("formGroup",u.formGroup),m(4),c(8,u.formGroup.controls.avator_image.value?8:9),m(2),c(10,u.isEditMode()?10:-1),m(4),c(14,u.isEditMode()?14:15),m(5),c(19,u.isEditMode()?19:20),m(5),c(24,u.isEditMode()?24:25),m(5),c(29,u.isEditMode()?29:30),m(5),c(34,u.isEditMode()?34:35),m(2),c(36,u.isEditMode()?36:37))},dependencies:[N,B,G,M,D,k,A]});let t=n;return t})();export{st as default};

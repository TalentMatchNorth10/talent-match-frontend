import{c as k,d as V,e as B,f as D,g as N,h as U,i as Y}from"./chunk-AN3YMRWG.js";import{c as j,d as A}from"./chunk-6TNVDKHT.js";import{h as v}from"./chunk-YBWMHS76.js";import{Aa as p,Ca as s,Ea as c,F as E,Ia as a,Ja as n,Ka as f,La as I,Oa as h,Pa as u,Q as g,Qa as l,Ra as _,T as b,Ta as M,Ua as T,Wa as w,Xa as G,aa as x,ba as C,k as S,oa as y,qa as m,ra as P,va as F}from"./chunk-M5BZCX2I.js";import"./chunk-2XJVAMHT.js";function R(t,o){if(t&1&&f(0,"img",4),t&2){let i=u();s("src",i.formGroup.controls.avator_image.value,y)}}function q(t,o){t&1&&f(0,"div",9)}function z(t,o){if(t&1){let i=I();a(0,"input",10),h("change",function(r){x(i);let d=u();return C(d.uploadImage(r))}),n()}}function O(t,o){t&1&&f(0,"tmf-input",6),t&2&&s("formControlName","name")}function H(t,o){if(t&1&&(a(0,"p"),l(1),n()),t&2){let i=u();m(),_(i.studentInfo==null?null:i.studentInfo.name)}}function J(t,o){t&1&&f(0,"tmf-input",6),t&2&&s("formControlName","nick_name")}function K(t,o){if(t&1&&(a(0,"p"),l(1),n()),t&2){let i=u();m(),_(i.studentInfo==null?null:i.studentInfo.nick_name)}}function L(t,o){t&1&&f(0,"tmf-input",7),t&2&&s("formControlName","birthday")}function Q(t,o){if(t&1&&(a(0,"p"),l(1),w(2,"date"),n()),t&2){let i=u();m(),_(G(2,1,i.studentInfo==null?null:i.studentInfo.birthday,"YYYY-MM-dd"))}}function W(t,o){t&1&&f(0,"tmf-input",6),t&2&&s("formControlName","contact_phone")}function X(t,o){if(t&1&&(a(0,"p"),l(1),n()),t&2){let i=u();m(),_(i.studentInfo==null?null:i.studentInfo.contact_phone)}}function Z(t,o){t&1&&f(0,"tmf-input",6),t&2&&s("formControlName","email")}function $(t,o){if(t&1&&(a(0,"p"),l(1),n()),t&2){let i=u();m(),_(i.studentInfo==null?null:i.studentInfo.email)}}function tt(t,o){if(t&1){let i=I();a(0,"div",8)(1,"button",11),h("click",function(){x(i);let r=u();return C(r.updateStudentInfo())}),l(2," \u5132\u5B58 "),n(),a(3,"button",12),h("click",function(){x(i);let r=u();return C(r.cancelEditMode())}),l(4," \u53D6\u6D88 "),n()()}}function et(t,o){if(t&1){let i=I();a(0,"button",11),h("click",function(){x(i);let r=u();return C(r.isEditMode.set(!0))}),l(1," \u7DE8\u8F2F "),n()}}var st=(()=>{let o=class o{constructor(e){this.datePipe=e,this.isEditMode=F(!1),this.fb=g(N),this.studentInfoService=g(j),this.uploadService=g(A),this.formGroup=this.fb.group({avator_image:this.fb.control(null),name:this.fb.control(null),nick_name:this.fb.control(null),birthday:this.fb.control(null),contact_phone:this.fb.control(null),email:this.fb.control(null)})}ngOnInit(){this.studentInfoService.apiStudentInfoBasicInfoGet().subscribe({next:e=>{e.status?(this.studentInfo=e.data,this.updateFormControls(this.studentInfo)):console.error(e)},error:e=>{console.error(e)}})}updateStudentInfo(){this.studentInfoService.apiStudentInfoBasicInfoPatch({updateStudentInfoRequestModel:{avator_image:this.formGroup.controls.avator_image.value,name:this.formGroup.controls.name.value,nick_name:this.formGroup.controls.nick_name.value,birthday:this.formGroup.controls.birthday.value,contact_phone:this.formGroup.controls.contact_phone.value,email:this.formGroup.controls.email.value}}).pipe(E(e=>e.status?this.studentInfoService.apiStudentInfoBasicInfoGet():S(()=>new Error("Failed to update student info")))).subscribe({next:e=>{e.status&&(this.studentInfo=e.data,this.isEditMode.set(!1))}}),this.updateFormControls(this.studentInfo)}uploadImage(e){console.log(e),this.uploadService.apiUploadFilePost({file:e.target.files[0],path:"user"}).subscribe({next:r=>{this.formGroup.controls.avator_image.setValue(r.fileUrl)},error:r=>{console.error(r)}})}cancelEditMode(){this.isEditMode.set(!1),this.formGroup.controls.avator_image.setValue(this.studentInfo.avator_image)}updateFormControls(e){this.formGroup.setValue({avator_image:e.avator_image,name:e.name,nick_name:e.nick_name,birthday:this.datePipe.transform(e.birthday,"yyyy-MM-dd"),contact_phone:e.contact_phone,email:e.email})}};o.\u0275fac=function(r){return new(r||o)(P(v))},o.\u0275cmp=b({type:o,selectors:[["app-student-info-page"]],standalone:!0,features:[M([v]),T],decls:38,vars:9,consts:[[1,"flex","items-center","justify-center"],[1,"text-xl","mb-4"],[1,"flex","flex-col","gap-4","mb-4",3,"formGroup"],[1,"font-bold"],["alt","",1,"w-[200px]","h-[200px]",3,"src"],["type","file","name","","id",""],[3,"formControlName"],["placeholder","yyyy-mm-dd",3,"formControlName"],[1,"flex","gap-2"],[1,"w-[200px]","h-[200px]","bg-tmf-gray-3"],["type","file","name","","id","",3,"change"],[1,"p-4","bg-tmf-orange-1","text-white","rounded-md",3,"click"],[1,"p-4","bg-tmf-gray-3","text-white","rounded-md",3,"click"]],template:function(r,d){r&1&&(a(0,"div",0)(1,"div")(2,"h1",1),l(3,"\u5B78\u751F\u57FA\u672C\u8CC7\u6599"),n(),a(4,"div",2)(5,"div")(6,"h2",3),l(7,"\u5927\u982D\u8CBC"),n(),p(8,R,1,1,"img",4)(9,q,1,0)(10,z,1,0,"input",5),n(),a(11,"div")(12,"h2",3),l(13,"\u59D3\u540D"),n(),p(14,O,1,1,"tmf-input",6)(15,H,2,1),n(),a(16,"div")(17,"h2",3),l(18,"\u66B1\u7A31"),n(),p(19,J,1,1,"tmf-input",6)(20,K,2,1),n(),a(21,"div")(22,"h2",3),l(23,"\u751F\u65E5"),n(),p(24,L,1,1,"tmf-input",7)(25,Q,3,4),n(),a(26,"div")(27,"h2",3),l(28,"\u806F\u7D61\u96FB\u8A71"),n(),p(29,W,1,1,"tmf-input",6)(30,X,2,1),n(),a(31,"div")(32,"h2",3),l(33,"\u96FB\u5B50\u90F5\u4EF6"),n(),p(34,Z,1,1,"tmf-input",6)(35,$,2,1),n()(),p(36,tt,5,0,"div",8)(37,et,2,0),n()()),r&2&&(m(4),s("formGroup",d.formGroup),m(4),c(8,d.formGroup.controls.avator_image.value?8:9),m(2),c(10,d.isEditMode()?10:-1),m(4),c(14,d.isEditMode()?14:15),m(5),c(19,d.isEditMode()?19:20),m(5),c(24,d.isEditMode()?24:25),m(5),c(29,d.isEditMode()?29:30),m(5),c(34,d.isEditMode()?34:35),m(2),c(36,d.isEditMode()?36:37))},dependencies:[Y,U,k,V,B,D,v]});let t=o;return t})();export{st as default};

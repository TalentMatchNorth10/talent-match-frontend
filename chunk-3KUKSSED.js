import{a as nt}from"./chunk-LP35TBS3.js";import{a as Ee}from"./chunk-YRMYBXY3.js";import{a as at,b as lt,c as st,d as xe}from"./chunk-5GU7ZIPD.js";import{c as ot,d as rt,e as be}from"./chunk-TOW3IQ3Y.js";import"./chunk-S5ANE635.js";import{a as he,d as _e}from"./chunk-IS5OBR6K.js";import{e as ye,i as we,l as Se,m as Te}from"./chunk-YH74APUB.js";import"./chunk-MGU5CCGQ.js";import"./chunk-I5WI4YOI.js";import{a as ge,b as Ce}from"./chunk-NITHV4GF.js";import"./chunk-M2DQCRHQ.js";import{a as U,b as Ze,c as ee,e as $,f as se,g as de,h as et,i as tt,k as ue,l as ce,o as me,p as pe,q as fe,r as it,s as J}from"./chunk-RMO7XV7S.js";import"./chunk-Y655OG7N.js";import"./chunk-ZTPLRKJ3.js";import{a as ve}from"./chunk-54M4AXZ3.js";import"./chunk-5WI6KTPY.js";import"./chunk-5FFZCFNQ.js";import{k as F,l as le,m as K,r as Xe,v as I}from"./chunk-H5KDQO7F.js";import{Ba as re,Cb as ze,Db as Ye,Eb as We,Fb as H,Gb as d,Hb as S,Ib as A,Ja as ae,Jb as Qe,Lb as Pe,Mb as Be,Na as s,Nb as Le,O as Ae,Ob as N,P as De,Pb as T,Rb as E,S as Oe,Sb as j,V as L,W as je,Za as Z,_b as Je,aa as b,db as _,ea as Re,fa as w,fb as u,gb as $e,jb as y,k as ne,lb as D,mb as O,nb as R,oa as Ke,ob as a,oc as Ne,pa as f,pb as l,qa as h,qb as x,tb as ke,u as He,ub as v,xb as p,ya as oe,yb as m,za as Me}from"./chunk-J7CIAQUA.js";import{a as Q,b as Ge}from"./chunk-MON7YFGF.js";var Et=(e,o)=>({"switch-on switch-enabled":e,"switch-disabled":o}),Ie=(()=>{let o=class o{constructor(){this.valeuChange=new re,this._disabled=!1,this.value=!1,this.onChange=t=>{},this.onTouched=()=>{}}set isDisabled(t){this._disabled=t,setTimeout(()=>{this.setDisabledState(t)})}get isDisabled(){return this._disabled}writeValue(t){this.value=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._disabled=t}toggleSwitch(){this.isDisabled||(this.value=!this.value,this.valeuChange.emit(this.value),this.onChange(this.value),this.onTouched())}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["tmf-switch"]],inputs:{isDisabled:"isDisabled"},outputs:{valeuChange:"valeuChange"},standalone:!0,features:[N([{provide:U,useExisting:L(()=>o),multi:!0}]),T],decls:2,vars:4,consts:[[1,"switch",3,"click","ngClass"],[1,"switch-circle"]],template:function(i,n){i&1&&(a(0,"div",0),p("click",function(){return n.toggleSwitch()}),x(1,"div",1),l()),i&2&&u("ngClass",j(1,Et,n.value,n.isDisabled))},dependencies:[I,F],styles:["[_nghost-%COMP%]{display:block}.switch[_ngcontent-%COMP%]{position:relative;height:22px;width:42px;cursor:pointer;border-radius:9999px;--tw-bg-opacity: 1;background-color:rgb(229 231 235 / var(--tw-bg-opacity));transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.switch-enabled[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(249 115 22 / var(--tw-bg-opacity))}.switch-disabled[_ngcontent-%COMP%]{cursor:not-allowed;--tw-bg-opacity: 1;background-color:rgb(159 159 159 / var(--tw-bg-opacity))}.switch-circle[_ngcontent-%COMP%]{position:absolute;left:3px;top:3px;height:1rem;width:1rem;border-radius:9999px;--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity));transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.switch-circle[_ngcontent-%COMP%]:disabled{--tw-bg-opacity: 1;background-color:rgb(29 29 29 / var(--tw-bg-opacity))}.switch-on[_ngcontent-%COMP%]   .switch-circle[_ngcontent-%COMP%]{--tw-translate-x: 20px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.switch-disabled[_ngcontent-%COMP%]   .switch-circle[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(102 102 102 / var(--tw-bg-opacity))}"]});let e=o;return e})();var te=function(e){return e.Name="name",e.Published="published",e}(te||{}),Y=function(e){return e[e.DRAFT=0]="DRAFT",e[e.PUBLISHED=1]="PUBLISHED",e[e.UNPUBLISHED=2]="UNPUBLISHED",e}(Y||{}),Ue=function(e){return e.View="view",e.Edit="edit",e.Delete="delete",e}(Ue||{}),ie=function(e){return e.Published="published",e.Unpublished="unpublished",e}(ie||{});var It=e=>({text:"\u540D\u7A31",column:e}),dt=e=>({$implicit:e}),Vt=e=>({text:"\u4E0A/\u4E0B\u67B6",column:e});function Ft(e,o){e&1&&ke(0)}function At(e,o){e&1&&ke(0)}function Dt(e,o){if(e&1&&x(0,"img",14),e&2){let r=m().$implicit;u("src",r.main_image,ae)}}function Ot(e,o){if(e&1&&(a(0,"div",17),d(1),l()),e&2){let r=m().$implicit;s(),A(" ",r.main_category," ")}}function Rt(e,o){if(e&1&&(a(0,"div",17),d(1),l()),e&2){let r=m().$implicit;s(),A(" ",r.sub_category," ")}}function Mt(e,o){e&1&&(a(0,"p"),d(1,"\u672A\u9078\u64C7\u985E\u5225"),l())}function kt(e,o){if(e&1){let r=v();a(0,"tmf-switch",23),p("valeuChange",function(){f(r);let i=m().$index,n=m();return h(n.togglePublished(i))}),l()}if(e&2){let r=m().$index,t=m();u("formControl",t.publishedArray.controls[r])}}function Pt(e,o){if(e&1){let r=v();a(0,"button",20),p("click",function(){f(r);let i=m().$implicit,n=m();return h(n.handleAction({type:n.ActionType.Edit,data:i}))}),d(1," \u7DE8\u8F2F "),l()}}function Bt(e,o){if(e&1){let r=v();a(0,"tr")(1,"td",12)(2,"div",13),_(3,Dt,1,1,"img",14),l()(),a(4,"td",12)(5,"p",15),d(6),l()(),a(7,"td",12)(8,"div",16),_(9,Ot,2,1,"div",17)(10,Rt,2,1,"div",17)(11,Mt,2,0,"p"),l()(),a(12,"td",12)(13,"div",11),_(14,kt,1,1,"tmf-switch",18),l()(),a(15,"td",12)(16,"div",19)(17,"button",20),p("click",function(){let i=f(r).$implicit,n=m();return h(n.handleAction({type:n.ActionType.View,data:i}))}),d(18," \u6AA2\u8996 "),l(),_(19,Pt,2,0,"button",21),a(20,"button",22),p("click",function(){let i=f(r).$implicit,n=m();return h(n.handleAction({type:n.ActionType.Delete,data:i}))}),d(21," \u522A\u9664 "),l()()()()}if(e&2){let r=o.$implicit,t=o.$index,i=m();s(3),y(3,r.main_image?3:-1),s(3),A(" ",r.name," "),s(3),y(9,r.main_category?9:-1),s(),y(10,r.sub_category?10:-1),s(),y(11,r.main_category&&r.sub_category?-1:11),s(3),u("ngIf",i.publishedArray.controls[t]),s(5),y(19,r.status!==i.CourseStatus.PUBLISHED?19:-1)}}function Lt(e,o){e&1&&(a(0,"span",5),d(1," arrow_upward_alt "),l())}function Nt(e,o){e&1&&(a(0,"span",5),d(1," arrow_downward_alt "),l())}function Ut(e,o){e&1&&(a(0,"span",5),d(1," swap_vert "),l())}function qt(e,o){if(e&1){let r=v();a(0,"div",24),p("click",function(){let i=f(r).$implicit,n=m();return h(n.changeSort(i.column,n.sort()&&n.sort().split("-")[1]==="asc"?"desc":"asc"))}),a(1,"p",9),d(2),l(),_(3,Lt,2,0)(4,Nt,2,0)(5,Ut,2,0),l()}if(e&2){let r,t=o.$implicit,i=m();s(2),S(t.text),s(),y(3,(r=i.sort())===t.column+"-asc"?3:r===t.column+"-desc"?4:5)}}var ut=(()=>{let o=class o{constructor(){this.dialogService=b(xe),this.teacherCourseService=b(we),this.changeView=oe(),this.dataSource=[],this.sort=Z(null),this.publishedArray=new pe([]),this.SortColumn=te,this.ViewMode=M,this.ActionType=Ue,this.CourseStatus=Y}ngOnInit(){this.getAllCourses()}getAllCourses(){this.teacherCourseService.apiTeacherCourseCoursesGet().subscribe(t=>{this.dataSource=t.data,this.resetPublishedArray()})}resetPublishedArray(){this.publishedArray.clear(),this.dataSource.length&&this.dataSource.forEach(t=>{let i=new de(t.status===Y.PUBLISHED);this.publishedArray.push(i),t.status===Y.DRAFT&&i.disable()})}changeSort(t,i){if(this.sort.set(`${t}-${i}`),t===te.Name){let n=[...this.dataSource];n.sort((c,C)=>i==="asc"?c.name.localeCompare(C.name):C.name.localeCompare(c.name)),this.dataSource=n}else if(t===te.Published){let n=[...this.dataSource];n.sort((c,C)=>{let g=i==="asc"?1:-1;return(c.status-C.status)*g}),this.dataSource=n}this.resetPublishedArray()}togglePublished(t){let i=this.publishedArray.at(t);this.handlePublishedChange(i,{type:i.value?ie.Published:ie.Unpublished,courseId:this.dataSource[t].id})}handleAction(t){switch(t.type){case"view":this.changeView.emit({mode:M.View,courseId:t.data.id});break;case"edit":this.changeView.emit({mode:M.Edit,courseId:t.data.id});break;case"delete":this.dialogService.openConfirmDialog({title:"\u78BA\u5B9A\u8981\u522A\u9664\u55CE?",content:"\u522A\u9664\u5F8C\u5C07\u7121\u6CD5\u6062\u5FA9\uFF0C\u4F60\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F",confirmBtnText:"\u78BA\u5B9A\u522A\u9664",btnType:"danger"}).subscribe(i=>{i&&this.teacherCourseService.apiTeacherCourseCoursesCourseIdDelete({courseId:t.data.id}).subscribe(n=>this.getAllCourses())});break}}handlePublishedChange(t,i){i.type===ie.Published?this.teacherCourseService.apiTeacherCourseCoursesCourseIdUnpublishPost({courseId:i.courseId}).subscribe({next:n=>{this.getAllCourses(),t.setValue(!t.value)},error:n=>{this.dialogService.openAlertDialog({title:"\u767C\u751F\u932F\u8AA4",content:n.error.message}).closed.subscribe(()=>this.getAllCourses())}}):this.teacherCourseService.apiTeacherCourseCoursesCourseIdPublishPost({courseId:i.courseId}).subscribe({next:n=>{this.getAllCourses(),t.setValue(!t.value)},error:n=>{this.dialogService.openAlertDialog({title:"\u767C\u751F\u932F\u8AA4",content:n.error.message}).closed.subscribe(()=>this.getAllCourses())}})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["app-course-table"]],outputs:{changeView:"changeView"},standalone:!0,features:[T],decls:31,vars:12,consts:[["sortTh",""],[1,"mb-5","flex","w-full","justify-between"],[1,"text-[22px]","font-bold","leading-9","md:text-[26px]","lg:text-[30px]"],[1,"flex","items-center","gap-x-2"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","px-3","py-2","text-white",3,"click"],[1,"material-symbols-outlined"],[1,"w-full","overflow-auto"],[1,"w-full","min-w-[768px]"],[1,"py-2"],[1,"flex","justify-start"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"flex","justify-center"],[1,"py-[2px]"],[1,"flex","justify-start","h-[112px]","w-[200px]","bg-tmf-gray-5","rounded-md"],["alt","\u8AB2\u7A0B\u5716",1,"h-full","w-full","rounded-md","object-cover",3,"src"],[1,"flex","justify-start","text-[16px]","leading-6","text-tmf-gray-2"],[1,"flex","justify-start","gap-2"],[1,"rounded","bg-tmf-gray-5","px-2","py-1"],[3,"formControl","valeuChange",4,"ngIf"],[1,"flex","flex-col","items-center","gap-y-2"],[1,"rounded","border","border-tmf-gray-3","px-2","py-1","text-[14px]","leading-5","text-tmf-gray-3","duration-100","hover:border-tmf-orange-1","hover:bg-tmf-orange-1","hover:text-white","active:scale-95",3,"click"],[1,"rounded","border","border-tmf-gray-3","px-2","py-1","text-[14px]","leading-5","text-tmf-gray-3","duration-100","hover:border-tmf-orange-1","hover:bg-tmf-orange-1","hover:text-white","active:scale-95"],[1,"rounded","border","border-red-500","px-2","py-1","text-[14px]","leading-5","text-red-500","duration-100","hover:bg-red-500","hover:text-white","active:scale-95",3,"click"],[3,"valeuChange","formControl"],[1,"flex","cursor-pointer","select-none","justify-center",3,"click"]],template:function(i,n){if(i&1){let c=v();a(0,"div",1)(1,"h1",2),d(2," \u8AB2\u7A0B\u7BA1\u7406 "),l(),a(3,"div",3)(4,"button",4),p("click",function(){return f(c),h(n.changeView.emit({mode:n.ViewMode.Create}))}),a(5,"span",5),d(6," add "),l(),d(7," \u65B0\u589E\u8AB2\u7A0B "),l()()(),a(8,"div",6)(9,"table",7)(10,"thead")(11,"tr")(12,"th",8)(13,"p",9),d(14,"\u8AB2\u7A0B\u5716"),l()(),a(15,"th",8)(16,"div",9),_(17,Ft,1,0,"ng-container",10),l()(),a(18,"th",8)(19,"p",9),d(20,"\u985E\u5225"),l()(),a(21,"th",8),_(22,At,1,0,"ng-container",10),l(),a(23,"th",8)(24,"p",11),d(25,"\u64CD\u4F5C"),l()()()(),a(26,"tbody"),O(27,Bt,22,7,"tr",null,D),l()()(),_(29,qt,6,2,"ng-template",null,0,Je)}if(i&2){let c=H(30);s(17),u("ngTemplateOutlet",c)("ngTemplateOutletContext",E(6,dt,E(4,It,n.SortColumn.Name))),s(5),u("ngTemplateOutlet",c)("ngTemplateOutletContext",E(10,dt,E(8,Vt,n.SortColumn.Published))),s(5),R(n.dataSource)}},dependencies:[I,K,Xe,J,$,ue,Ie],styles:["[_nghost-%COMP%]{display:block;width:100%}"]});let e=o;return e})();var P=function(e){return e.NAME="name",e.MAIN_IMAGE="main_image",e.CONTENT="content",e.PRICE_QUANTITY="price_quantity",e.MAIN_CATEGORY="main_category",e.SUB_CATEGORY="sub_category",e.CITY_ID="city_id",e.DIST_ID="dist_id",e.SURVEY_URL="survey_url",e.STATUS="status",e.TEACHER_ID="teacher_id",e.PURCHASE_MESSAGE="purchase_message",e.VIDEO_IDS="video_ids",e.FILE_DETAILS="file_details",e.FILE_URL_DETAILS="file_url_details",e}(P||{});var Gt=["textarea"],Ht=e=>({"!cursor-not-allowed bg-tmf-gray-5 !text-tmf-gray-3":e});function jt(e,o){if(e&1&&(a(0,"span",6),d(1),l()),e&2){let r=m();s(),S(r.label)}}function Kt(e,o){e&1&&(a(0,"span",7),d(1,"*"),l())}function $t(e,o){if(e&1&&(a(0,"p",8),d(1),l()),e&2){let r=m();s(),S(r.info)}}var Ve=(()=>{let o=class o{constructor(){this.label="",this.info="",this.isRequired=!1,this.value="",this.disabled=!1,this.onChange=t=>{},this.onTouched=()=>{}}writeValue(t){this.value=t,this.adjustTextarea()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}ngAfterViewInit(){this.adjustTextarea()}onInput(t){let i=t.target;this.value=i.value,this.onChange(this.value),this.onTouched(),this.adjustTextarea()}adjustTextarea(){if(this.textarea){let t=this.textarea.nativeElement;t.style.height="auto",t.style.height=`${t.scrollHeight}px`}}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["tmf-textarea"]],viewQuery:function(i,n){if(i&1&&ze(Gt,5),i&2){let c;Ye(c=We())&&(n.textarea=c.first)}},inputs:{label:"label",info:"info",isRequired:"isRequired"},standalone:!0,features:[N([{provide:U,useExisting:L(()=>o),multi:!0}]),T],decls:8,vars:8,consts:[["textarea",""],[1,"mb-1","flex","flex-col"],["class","select-label",4,"ngIf"],["class","text-red-500",4,"ngIf"],["class","mb-2 ml-2 text-sm text-gray-500",4,"ngIf"],[1,"w-full","resize-none","rounded-md","border","border-tmf-gray-4","p-2","outline-none","focus:border-tmf-orange-1",3,"input","ngClass","disabled","value"],[1,"select-label"],[1,"text-red-500"],[1,"mb-2","ml-2","text-sm","text-gray-500"]],template:function(i,n){if(i&1){let c=v();a(0,"div",1)(1,"p"),_(2,jt,2,1,"span",2)(3,Kt,2,0,"span",3),l(),_(4,$t,2,1,"p",4),l(),a(5,"textarea",5,0),p("input",function(g){return f(c),h(n.onInput(g))}),d(7,"    "),l()}i&2&&(s(2),u("ngIf",n.label),s(),u("ngIf",n.isRequired),s(),u("ngIf",n.info),s(),u("ngClass",E(6,Ht,n.disabled))("disabled",n.disabled)("value",n.value))},dependencies:[I,F,K],styles:["[_nghost-%COMP%]{display:block}"]});let e=o;return e})();var zt=e=>({"cursor-not-allowed !bg-tmf-gray-5":e});function Yt(e,o){if(e&1&&(a(0,"div",9),x(1,"tmf-checkbox",10),a(2,"div",11),x(3,"tmf-video-card",12),a(4,"div",13)(5,"p")(6,"span",14),d(7,"\u540D\u7A31\uFF1A"),l(),a(8,"span"),d(9),l()(),a(10,"p")(11,"span",14),d(12,"\u985E\u5225\uFF1A"),l(),a(13,"span"),d(14),l()(),a(15,"p")(16,"span",14),d(17,"\u7C21\u4ECB\uFF1A"),l(),a(18,"span"),d(19),l()()()()()),e&2){let r=o.$implicit,t=o.$index,i=m(3);s(),u("formControl",i.chks.at(t)),s(2),u("data",r),s(6),S(r.name),s(5),S(r.category),s(5),S(r.intro)}}function Wt(e,o){if(e&1&&(a(0,"div",8),O(1,Yt,20,5,"div",9,D),l()),e&2){let r=m(2);s(),R(r.videos)}}function Qt(e,o){if(e&1&&_(0,Wt,3,0,"div",8),e&2){let r=m();y(0,r.chks?0:-1)}}function Jt(e,o){if(e&1&&x(0,"tmf-option",18),e&2){let r=o.$implicit;u("value",r.main_category)("label",r.main_category||"")}}function Xt(e,o){if(e&1&&x(0,"tmf-input",25),e&2){let r=m(2);u("isRequired",!0)("formControlName",r.UploadFormKey.URL)("inputType",r.InputType.Outline)}}function Zt(e,o){if(e&1){let r=v();a(0,"p",21)(1,"span",22),d(2,"\u5F71\u7247\u6A94\u6848"),l(),a(3,"span",23),d(4,"*"),l()(),a(5,"div",26)(6,"button",27),p("click",function(){f(r);let i=H(11);return h(i.click())}),d(7," \u4E0A\u50B3\u6A94\u6848 "),l(),a(8,"p"),d(9),l()(),a(10,"input",28,0),p("change",function(i){f(r);let n=m(2);return h(n.hanldeVideoChange(i))}),l()}if(e&2){let r=m(2);s(9),S(r.currentFile==null?null:r.currentFile.name)}}function ei(e,o){if(e&1&&(a(0,"div",15),x(1,"tmf-input",16),a(2,"tmf-select",17),O(3,Jt,1,2,"tmf-option",18,D),l(),x(5,"tmf-textarea",19),a(6,"div",20)(7,"p",21)(8,"span",22),d(9,"\u5F71\u7247\u70BA\u5916\u90E8\u9023\u7D50"),l(),a(10,"span",23),d(11,"*"),l()(),x(12,"tmf-switch",24),l(),_(13,Xt,1,3,"tmf-input",25)(14,Zt,12,1),l()),e&2){let r=m();u("formGroup",r.uploadForm),s(),u("isRequired",!0)("formControlName",r.UploadFormKey.NAME)("inputType",r.InputType.Outline),s(),u("isRequired",!0)("formControlName",r.UploadFormKey.CATEGORY),s(),R(r.categoryOptions),s(2),u("isRequired",!0)("formControlName",r.UploadFormKey.INTRO),s(7),u("formControlName",r.UploadFormKey.VIDEO_TYPE),s(),y(13,r.videoType.value?13:14)}}var W=function(e){return e.Select="select",e.Upload="upload",e}(W||{}),B=function(e){return e.NAME="name",e.CATEGORY="category",e.INTRO="intro",e.VIDEO_TYPE="video_type",e.URL="url",e.TEACHER_ID="teacher_id",e}(B||{}),ct=(()=>{let o=class o{constructor(){this.teacherVideoService=b(Se),this.commonService=b(ve),this.uploadService=b(Te),this.data=b(rt),this.dialogRef=b(ot),this.fb=b(fe),this.mode=W.Select,this.videos=[],this.categoryOptions=[],this.uploadForm=this.fb.group({[B.NAME]:this.fb.control(null,[ee.required]),[B.CATEGORY]:this.fb.control(null,[ee.required]),[B.INTRO]:this.fb.control(null,[ee.required]),[B.VIDEO_TYPE]:this.fb.control(!1,[ee.required]),[B.URL]:this.fb.control(null)}),this.currentFile=null,this.VideoSelectMode=W,this.UploadFormKey=B,this.InputType=he}get videoType(){return this.uploadForm.controls[B.VIDEO_TYPE]}get selectedVideoIds(){return this.data.videoIds}get courseId(){return this.data.courseId}get teacherId(){return this.data.teacherId}get canSubmit(){return this.mode===W.Upload?this.uploadForm.controls[B.VIDEO_TYPE].value?!this.uploadForm.invalid:this.currentFile&&!this.uploadForm.invalid:!0}ngOnInit(){this.teacherVideoService.apiTeacherVideoGet().subscribe(t=>{if(this.videos=t.data.map(i=>Q({video_id:i._id,name:i.name,category:i.category,intro:i.intro,video_type:i.video_type,url:i.url,teacher_id:i.teacher_id},i.course_id?{course_id:i.course_id}:{})),this.videos&&this.videos.length){let i=new pe([]);this.videos.forEach(n=>{let c=this.selectedVideoIds.some(C=>C===n.video_id);i.push(new de(c))}),this.chks=i}}),this.commonService.apiCommonTagGet().subscribe(t=>this.categoryOptions=t.data)}submit(){if(this.mode===W.Upload){let t=()=>{let{name:n,category:c,intro:C,url:g,video_type:G}=this.uploadForm.getRawValue();this.teacherVideoService.apiTeacherVideoPost({addTeacherVideoRequestModel:{name:n,category:c,intro:C,url:g,video_type:G?"youtube":"storage",course_id:this.courseId,teacher_id:this.teacherId}}).subscribe(()=>this.dialogRef.close())};if(this.uploadForm.controls[B.VIDEO_TYPE].value===!1){if(!this.currentFile)return;this.uploadService.apiUploadFilePost({fileType:"video",path:"user",file:this.currentFile}).subscribe(({fileUrl:n})=>{this.uploadForm.controls[B.URL].setValue(n),t()})}else t()}else{let t=this.videos.filter((i,n)=>this.chks.at(n).value);this.dialogRef.close(t)}}cancel(){this.dialogRef.close()}toggleMode(t){this.mode=t||this.mode===W.Select?W.Upload:W.Select}hanldeVideoChange(t){let i=t.target.files?.[0];i&&(this.currentFile=i)}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["app-video-select"]],standalone:!0,features:[T],decls:13,vars:5,consts:[["file",""],[1,"flex","h-full","flex-col","justify-between","gap-y-5","bg-white","p-5"],[1,"flex","justify-between"],[1,"text-xl","font-bold"],[1,"rounded-md","bg-tmf-orange-1","px-2","py-1","text-white",3,"click"],[1,"flex","justify-end","gap-5"],[1,"w-[100px]","rounded-md","border","py-1",3,"click"],[1,"w-[100px]","rounded-md","bg-tmf-orange-1","py-1","text-white",3,"click","ngClass"],[1,"flex","h-[400px]","flex-col","gap-3","overflow-auto","rounded-xl","border","bg-tmf-orange-4","p-5"],[1,"flex","items-center","gap-3"],[3,"formControl"],[1,"flex","gap-5"],[3,"data"],[1,"flex","flex-col","gap-3"],[1,"text-gray-500"],[1,"flex","h-[400px]","flex-col","overflow-auto",3,"formGroup"],["label","\u8AB2\u7A0B\u540D\u7A31","placeholder","\u8ACB\u8F38\u5165\u8AB2\u7A0B\u540D\u7A31",3,"isRequired","formControlName","inputType"],["label","\u5F71\u7247\u985E\u5225",1,"mb-6",3,"isRequired","formControlName"],[3,"value","label"],["label","\u5F71\u7247\u7C21\u4ECB","placeholder","\u8ACB\u8F38\u5165\u5F71\u7247\u7C21\u4ECB",3,"isRequired","formControlName"],[1,"mb-6","flex","flex-col"],[1,"mb-1"],[1,"select-label"],[1,"text-red-500"],[3,"formControlName"],["label","\u5F71\u7247\u9023\u7D50","placeholder","\u8ACB\u8F38\u5165\u5F71\u7247\u9023\u7D50",3,"isRequired","formControlName","inputType"],[1,"flex","items-center","gap-1"],[1,"w-[100px]","rounded-md","bg-tmf-orange-1","py-1","text-white",3,"click"],["type","file","hidden","","accept","video/*",3,"change"]],template:function(i,n){i&1&&(a(0,"div",1)(1,"div",2)(2,"h2",3),d(3,"\u7BA1\u7406\u77ED\u5F71\u7247"),l(),a(4,"button",4),p("click",function(){return n.toggleMode()}),d(5),l()(),_(6,Qt,1,1)(7,ei,15,10),a(8,"div",5)(9,"button",6),p("click",function(){return n.cancel()}),d(10," \u53D6\u6D88 "),l(),a(11,"button",7),p("click",function(){return n.canSubmit?n.submit():null}),d(12," \u78BA\u5B9A "),l()()()),i&2&&(s(5),A(" ",n.mode===n.VideoSelectMode.Select?"\u4E0A\u50B3\u5F71\u7247":"\u7BA1\u7406\u5F71\u7247"," "),s(),y(6,n.mode===n.VideoSelectMode.Select?6:7),s(5),u("ngClass",E(3,zt,!n.canSubmit)))},dependencies:[I,F,J,$,se,ue,ce,me,Ee,nt,_e,Ce,ge,Ie,Ve],styles:["[_nghost-%COMP%]{display:block;height:100%}"]});let e=o;return e})();var ti=(e,o)=>({"mb-5":e,"cursor-not-allowed !bg-tmf-gray-3":o});function ii(e,o){if(e&1&&(a(0,"span",7),d(1),l()),e&2){let r=m();s(),S(r.label)}}function ni(e,o){e&1&&(a(0,"span",8),d(1,"*"),l())}function oi(e,o){if(e&1&&(a(0,"p",9),d(1),l()),e&2){let r=m();s(),S(r.info)}}function ri(e,o){if(e&1&&x(0,"tmf-video-card",6),e&2){let r=o.$implicit;u("data",r)}}var mt=(()=>{let o=class o{constructor(){this.teacherVideoService=b(Se),this.dialog=b(be),this.label="",this.info="",this.isRequired=!1,this.videoIds=[],this.disabled=!1,this.courseId="",this.teacherId="",this.selectVideoChange=new re,this.videos=[],this.selectedVideos=[]}get selectVideos(){return this.selectedVideos.length>0?this.selectedVideos:this.videos.filter(t=>this.videoIds.includes(t.video_id))}ngOnChanges(t){t.videoIds&&t.videoIds.currentValue&&this.videoIds.length&&this.getAllVideos()}getAllVideos(){this.teacherVideoService.apiTeacherVideoGet().subscribe(t=>{this.videos=t.data.map(i=>Q({video_id:i._id,name:i.name,category:i.category,intro:i.intro,video_type:i.video_type,url:i.url,teacher_id:i.teacher_id},i.course_id?{course_id:i.course_id}:{}))})}selectVideo(){this.dialog.open(ct,{width:"100%",height:"100%",maxHeight:"80vh",maxWidth:"80vw",data:{videoIds:this.selectedVideos.length?this.selectedVideos.map(i=>i.video_id):this.videoIds,courseId:this.courseId,teacherId:this.teacherId}}).closed.subscribe(i=>{i&&(this.selectedVideos=i,this.selectVideoChange.emit(this.selectedVideos.map(n=>n.video_id)))})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["app-video-list"]],inputs:{label:"label",info:"info",isRequired:"isRequired",videoIds:"videoIds",disabled:"disabled",courseId:"courseId",teacherId:"teacherId"},outputs:{selectVideoChange:"selectVideoChange"},standalone:!0,features:[Ke,T],decls:10,vars:7,consts:[[1,"mb-1","flex","flex-col"],["class","select-label",4,"ngIf"],["class","text-red-500",4,"ngIf"],["class","mb-2 ml-2 text-sm text-gray-500",4,"ngIf"],[1,"rounded-md","bg-tmf-orange-1","px-2","py-1","text-white",3,"click","ngClass"],[1,"flex","max-w-full","gap-3","overflow-auto"],[3,"data"],[1,"select-label"],[1,"text-red-500"],[1,"mb-2","ml-2","text-sm","text-gray-500"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"p"),_(2,ii,2,1,"span",1)(3,ni,2,0,"span",2),l(),_(4,oi,2,1,"p",3),l(),a(5,"button",4),p("click",function(){return n.disabled?null:n.selectVideo()}),d(6," \u7BA1\u7406\u77ED\u5F71\u7247 "),l(),a(7,"div",5),O(8,ri,1,1,"tmf-video-card",6,D),l()),i&2&&(s(2),u("ngIf",n.label),s(),u("ngIf",n.isRequired),s(),u("ngIf",n.info),s(),u("ngClass",j(4,ti,n.selectVideos.length>0,n.disabled)),s(3),R(n.selectVideos))},dependencies:[I,F,K,Ee],styles:["[_nghost-%COMP%]{display:block}"]});let e=o;return e})();var pt=e=>({"cursor-not-allowed !bg-tmf-gray-5":e}),ft=e=>({"cursor-not-allowed bg-tmf-gray-5 text-tmf-gray-3":e});function ai(e,o){if(e&1&&(a(0,"span",8),d(1),l()),e&2){let r=m();s(),S(r.label)}}function li(e,o){e&1&&(a(0,"span",9),d(1,"*"),l())}function si(e,o){if(e&1){let r=v();a(0,"div",10),x(1,"input",11),a(2,"label",12),d(3),l(),a(4,"div",13)(5,"input",14),Le("ngModelChange",function(i){let n=f(r).$implicit,c=m();return Be(n[c.itemKey1],i)||(n[c.itemKey1]=i),h(i)}),p("ngModelChange",function(){f(r);let i=m();return h(i.updateFormControlValue())}),l()(),a(6,"label",12),d(7),l(),a(8,"div",13)(9,"input",14),Le("ngModelChange",function(i){let n=f(r).$implicit,c=m();return Be(n[c.itemKey2],i)||(n[c.itemKey2]=i),h(i)}),p("ngModelChange",function(){f(r);let i=m();return h(i.updateFormControlValue())}),l()(),a(10,"button",15),p("click",function(){let i=f(r).index,n=m();return h(n.removePriceQuantity(i))}),a(11,"span",16),d(12," close "),l()()()}if(e&2){let r=o.$implicit,t=m();s(),u("value",r[t.idKey]),s(2),A("",t.itemLabel1,"\uFF1A"),s(),u("ngClass",E(16,pt,t.disabled)),s(),u("placeholder",t.itemPlaceHolder1)("type",t.itemType1)("ngClass",E(18,ft,t.disabled))("disabled",t.disabled),Pe("ngModel",r[t.itemKey1]),s(2),A("",t.itemLabel2,"\uFF1A"),s(),u("ngClass",E(20,pt,t.disabled)),s(),u("placeholder",t.itemPlaceHolder2)("type",t.itemType2)("ngClass",E(22,ft,t.disabled))("disabled",t.disabled),Pe("ngModel",r[t.itemKey2]),s(),u("disabled",t.disabled)}}var ht=(()=>{let o=class o{constructor(){this.label="",this.info="",this.isRequired=!1,this.idKey="",this.itemKey1="",this.itemLabel1="",this.itemPlaceHolder1="",this.itemType1="text",this.itemKey2="",this.itemLabel2="",this.itemPlaceHolder2="",this.itemType2="text",this.dataList=[],this.disabled=!1,this.onChange=()=>{},this.onTouched=()=>{}}addPriceQuantity(){this.dataList.push({[this.idKey]:null,[this.itemKey1]:null,[this.itemKey2]:null}),this.updateFormControlValue()}removePriceQuantity(t){this.dataList.splice(t,1),this.updateFormControlValue()}updateFormControlValue(){this.onChange(this.dataList),this.onTouched()}writeValue(t){t?this.dataList=t.map(i=>({[this.idKey]:i[this.idKey],[this.itemKey1]:i[this.itemKey1],[this.itemKey2]:i[this.itemKey2]})):this.dataList=[]}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["app-dynamic-input-list"]],inputs:{label:"label",info:"info",isRequired:"isRequired",idKey:"idKey",itemKey1:"itemKey1",itemLabel1:"itemLabel1",itemPlaceHolder1:"itemPlaceHolder1",itemType1:"itemType1",itemKey2:"itemKey2",itemLabel2:"itemLabel2",itemPlaceHolder2:"itemPlaceHolder2",itemType2:"itemType2"},standalone:!0,features:[N([{provide:U,useExisting:L(()=>o),multi:!0}]),T],decls:10,vars:4,consts:[[1,"mb-2","flex","items-center","justify-start","gap-2"],[1,"flex","flex-col"],["class","select-label",4,"ngIf"],["class","text-red-500",4,"ngIf"],["type","button",1,"flex","h-5","w-5","items-center","justify-center","rounded-full","bg-blue-500","text-white","hover:bg-blue-600","focus:outline-none","focus:ring-2","focus:ring-blue-500","disabled:cursor-not-allowed","disabled:bg-tmf-gray-3",3,"click","disabled"],[1,"material-icons","text-[16px]"],[1,"flex","max-w-[600px]","flex-col","gap-y-4"],["class","flex max-w-full flex-grow items-center",4,"ngFor","ngForOf"],[1,"select-label"],[1,"text-red-500"],[1,"flex","max-w-full","flex-grow","items-center"],["type","hidden",3,"value"],[1,"mr-1","whitespace-nowrap","text-[14px]","leading-4"],[1,"input-container","mr-2",3,"ngClass"],[1,"input",3,"ngModelChange","placeholder","type","ngClass","disabled","ngModel"],["type","button",1,"text-2xl","font-semibold","text-red-500","hover:text-red-700","focus:outline-none","focus:ring-2","focus:ring-red-500","disabled:cursor-not-allowed","disabled:text-tmf-gray-3",3,"click","disabled"],[1,"material-icons"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"div",1)(2,"p"),_(3,ai,2,1,"span",2)(4,li,2,0,"span",3),l()(),a(5,"button",4),p("click",function(){return n.addPriceQuantity()}),a(6,"span",5),d(7," add "),l()()(),a(8,"div",6),_(9,si,13,24,"div",7),l()),i&2&&(s(3),u("ngIf",n.label),s(),u("ngIf",n.isRequired),s(),u("disabled",n.disabled),s(4),u("ngForOf",n.dataList))},dependencies:[I,F,le,K,it,Ze,$,et],styles:["[_nghost-%COMP%]{display:block}.input-container[_ngcontent-%COMP%]{position:relative;display:flex;height:36px;flex-grow:1;align-items:center;border-radius:.5rem;border-width:1px;--tw-border-opacity: 1;border-color:rgb(159 159 159 / var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity));padding-left:.75rem;padding-right:.75rem;transition-duration:75ms}.input-container[_ngcontent-%COMP%]:focus-within{--tw-border-opacity: 1;border-color:rgb(243 105 35 / var(--tw-border-opacity))}@media (min-width: 768px){.input-container[_ngcontent-%COMP%]{height:38px}}@media (min-width: 1024px){.input-container[_ngcontent-%COMP%]{height:40px}}.input[_ngcontent-%COMP%]{width:100%;max-width:100%;flex-grow:1;overflow:hidden;text-overflow:ellipsis;font-size:14px;line-height:1.25rem;outline:2px solid transparent;outline-offset:2px}@media (min-width: 768px){.input[_ngcontent-%COMP%]{font-size:16px;line-height:1.5rem}}"]});let e=o;return e})();var di=e=>({"cursor-not-allowed !bg-tmf-gray-3":e});function ui(e,o){if(e&1&&(a(0,"span",3),d(1),l()),e&2){let r=m();s(),Qe("(\u5C3A\u5BF8\u9650\u5236 ",r.sizeLimitWidth,"*",r.sizeLimitHeight,")")}}function ci(e,o){e&1&&(a(0,"span",4),d(1,"*"),l())}function mi(e,o){if(e&1&&x(0,"img",9),e&2){let r=m();u("src",r.imageUrl,ae)}}function pi(e,o){e&1&&(a(0,"span",10),d(1,"\u5C1A\u672A\u4E0A\u50B3\u5716\u7247"),l())}var _t=(()=>{let o=class o{constructor(){this.dialog=b(be),this.isRequired=!1,this.label="",this.previewWidth=400,this.previewHeight=200,this.imageUrl=null,this.disabled=!1,this.onChange=()=>{},this.onTouched=()=>{}}onFileChange(t){let i=t.target;if(i.files&&i.files[0]){let n=i.files[0],c=new Image;c.src=URL.createObjectURL(n),c.onload=()=>{let C=g=>{let G=new FileReader;G.onload=()=>{this.imageUrl=G.result,this.onChange(g)},G.readAsDataURL(g)};this.sizeLimitWidth&&this.sizeLimitHeight?c.width===this.sizeLimitWidth&&c.height===this.sizeLimitHeight?C(n):this.openAlertDialog({title:"\u5716\u7247\u5C3A\u5BF8\u932F\u8AA4",content:`\u5716\u7247\u5C3A\u5BF8\u5FC5\u9808\u70BA ${this.sizeLimitWidth}x${this.sizeLimitHeight}\uFF0C\u8ACB\u91CD\u65B0\u4E0A\u50B3\u3002`}).closed.subscribe(()=>{this.imageUrl=null,this.onChange(null)}):C(n)}}}openAlertDialog(t){let i=t||new lt;return this.dialog.open(at,{data:i})}writeValue(t){t instanceof Blob||t instanceof File?this.imageUrl=URL.createObjectURL(t):typeof t=="string"?this.imageUrl=t:this.imageUrl=null}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}onTouchedHandler(){this.onTouched()}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["tmf-image-upload"]],inputs:{isRequired:"isRequired",label:"label",previewWidth:"previewWidth",previewHeight:"previewHeight",sizeLimitWidth:"sizeLimitWidth",sizeLimitHeight:"sizeLimitHeight"},standalone:!0,features:[N([{provide:U,useExisting:L(()=>o),multi:!0}]),T],decls:13,vars:16,consts:[["fileUpload",""],[1,"flex","items-center"],[1,"input-label"],[1,"text-sm","text-gray-500"],[1,"text-red-500"],[1,"ml-1","rounded-md","bg-tmf-orange-1","px-2","py-1","text-white",3,"click","ngClass"],[1,"flex","flex-col","space-y-2"],["type","file",1,"hidden",3,"change","disabled"],[1,"mt-4","flex","items-center","justify-center","bg-tmf-gray-5"],["alt","\u5DF2\u4E0A\u50B3\u7684\u5716\u7247\u9810\u89BD",1,"h-full","w-full","object-cover",3,"src"],[1,"text-tmf-gray-3"]],template:function(i,n){if(i&1){let c=v();a(0,"div",1)(1,"span",2),d(2),l(),_(3,ui,2,2,"span",3)(4,ci,2,0,"span",4),a(5,"button",5),p("click",function(){f(c);let g=H(9);return h(g.click())}),d(6," \u4E0A\u50B3\u5716\u7247 "),l()(),a(7,"div",6)(8,"input",7,0),p("change",function(g){return f(c),h(n.onFileChange(g))}),l(),a(10,"div",8),_(11,mi,1,1,"img",9)(12,pi,2,0),l()()}i&2&&(s(2),S(n.label),s(),y(3,n.sizeLimitWidth&&n.sizeLimitHeight?3:-1),s(),y(4,n.isRequired?4:-1),s(),u("ngClass",E(14,di,n.disabled)),s(3),u("disabled",n.disabled),s(2),$e("width",n.previewWidth,"px")("height",n.previewHeight,"px")("max-width","100%")("max-height","100%"),s(),y(11,n.imageUrl?11:12))},dependencies:[I,F],styles:["[_nghost-%COMP%]{display:block}"]});let e=o;return e})();var gt=(()=>{let o=class o{downloadFile(t,i){let n=window.URL.createObjectURL(t),c=document.createElement("a");c.href=n,c.download=i,c.click(),window.URL.revokeObjectURL(n)}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=je({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})();var fi=e=>({"cursor-not-allowed !bg-tmf-gray-3":e}),hi=(e,o)=>({"cursor-not-allowed bg-tmf-gray-5 text-tmf-gray-3":e,"cursor-pointer":o});function _i(e,o){e&1&&(a(0,"span",3),d(1,"*"),l())}function gi(e,o){if(e&1){let r=v();a(0,"div",8),p("click",function(){let i=f(r).$implicit,n=m();return h(n.disabled?null:n.downloadFile(i))}),a(1,"span",9),d(2),l(),a(3,"button",10),p("click",function(i){let n=f(r).index,c=m();return h(c.disabled?null:c.removeFile(i,n))}),a(4,"span",11),d(5,"close"),l()()()}if(e&2){let r=o.$implicit,t=m();u("ngClass",j(3,hi,t.disabled,(r.fileId||r.file)&&!t.disabled)),s(2),S(r.name),s(),u("disabled",t.disabled)}}var Ct=(()=>{let o=class o{constructor(){this.downloadService=b(gt),this.fileService=b(ye),this.isRequired=!1,this.label="",this.files=[],this.disabled=!1,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(t){t&&(this.files=t.map(i=>({id:i.id||null,name:i.name,file:i.file||null,fileId:i.fileId||null})))}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}onFileChange(t){let i=t.target.files;i.length>0&&(Array.from(i).forEach(c=>{this.files.some(({file:g})=>g&&g.name===c.name&&g.size===c.size&&g.lastModified===c.lastModified)||this.files.push({id:null,name:c.name,file:c,fileId:null})}),this.onChange(this.files),this.onTouched())}removeFile(t,i){t.stopPropagation(),this.files.splice(i,1),this.onChange(this.files)}downloadFile(t){t.fileId?this.fileService.apiFileFileIdGet({fileId:t.fileId}).subscribe(i=>{this.downloadService.downloadFile(i,t.name)}):t.file&&this.downloadService.downloadFile(t.file,t.name)}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["app-file-uploader"]],inputs:{isRequired:"isRequired",label:"label"},standalone:!0,features:[N([{provide:U,useExisting:L(()=>o),multi:!0}]),T],decls:10,vars:6,consts:[["fileUpload",""],[1,"mb-2","flex","items-center"],[1,"input-label"],[1,"text-red-500"],[1,"ml-1","rounded-md","bg-tmf-orange-1","px-2","py-1","text-white",3,"click","ngClass"],[1,"flex","flex-wrap","gap-2"],["type","file","multiple","",1,"hidden",3,"change"],["class","file-container",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"file-container",3,"click","ngClass"],[1,"file-text"],["type","button",1,"h-6","text-red-500","hover:text-red-700","focus:outline-none","disabled:cursor-not-allowed","disabled:text-tmf-gray-3",3,"click","disabled"],[1,"material-icons"]],template:function(i,n){if(i&1){let c=v();a(0,"div",1)(1,"span",2),d(2),l(),_(3,_i,2,0,"span",3),a(4,"button",4),p("click",function(){f(c);let g=H(8);return h(g.click())}),d(5," \u4E0A\u50B3\u6A94\u6848 "),l()(),a(6,"div",5)(7,"input",6,0),p("change",function(g){return f(c),h(n.onFileChange(g))}),l(),_(9,gi,6,6,"div",7),l()}i&2&&(s(2),S(n.label),s(),y(3,n.isRequired?3:-1),s(),u("ngClass",E(4,fi,n.disabled)),s(5),u("ngForOf",n.files))},dependencies:[I,F,le],styles:["[_nghost-%COMP%]{display:block}.file-container[_ngcontent-%COMP%]{position:relative;display:flex;height:36px;align-items:center;border-radius:.5rem;border-width:1px;--tw-border-opacity: 1;border-color:rgb(159 159 159 / var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity));padding-left:.75rem;padding-right:.75rem;transition-duration:75ms}@media (min-width: 768px){.file-container[_ngcontent-%COMP%]{height:38px}}@media (min-width: 1024px){.file-container[_ngcontent-%COMP%]{height:40px}}.file-text[_ngcontent-%COMP%]{margin-right:.25rem;width:100%;max-width:100%;flex-grow:1;overflow:hidden;text-overflow:ellipsis;font-size:14px;line-height:1.25rem;outline:2px solid transparent;outline-offset:2px}@media (min-width: 768px){.file-text[_ngcontent-%COMP%]{font-size:16px;line-height:1.5rem}}"]});let e=o;return e})();var Ci=(e,o)=>({"text-green-500":e,"text-red-500":o}),bi=e=>({"cursor-not-allowed !bg-tmf-gray-5 !text-white":e});function xi(e,o){if(e&1&&(a(0,"p",3),d(1," \u586B\u5BEB\u72C0\u614B\uFF1A "),a(2,"span",24),d(3),l()()),e&2){let r=m();s(2),u("ngClass",j(2,Ci,r.courseData.is_valid,!r.courseData.is_valid)),s(),A(" ",r.courseData.is_valid?"\u9A57\u8B49\u901A\u904E":"\u9A57\u8B49\u672A\u901A\u904E"," ")}}function vi(e,o){if(e&1){let r=v();a(0,"button",5),p("click",function(){f(r);let i=m();return h(i.changeView.emit({mode:i.ViewMode.Edit}))}),a(1,"span",6),d(2," edit_square "),l(),d(3," \u7DE8\u8F2F "),l()}}function yi(e,o){if(e&1){let r=v();a(0,"button",27),p("click",function(){f(r);let i=m(2);return h(i.togglePublished())}),a(1,"span",6),d(2),l(),a(3,"span",7),d(4),l()()}if(e&2){let r=m(2);u("ngClass",E(3,bi,!r.courseData.is_valid)),s(2),A(" ",r.courseData.status===r.CourseStatus.UNPUBLISHED?"publish":"unpublished"," "),s(2),A(" ",r.courseData.status===r.CourseStatus.UNPUBLISHED?"\u4E0A\u67B6":"\u4E0B\u67B6"," ")}}function wi(e,o){if(e&1){let r=v();a(0,"button",5),p("click",function(){f(r);let i=m();return h(i.reset())}),a(1,"span",25),d(2," refresh "),l(),a(3,"span",7),d(4," \u91CD\u8A2D "),l()(),a(5,"button",5),p("click",function(){f(r);let i=m();return h(i.save())}),a(6,"span",6),d(7," save "),l(),a(8,"span",7),d(9," \u5132\u5B58 "),l()(),_(10,yi,5,5,"button",26)}if(e&2){let r=m();s(10),y(10,r.courseData&&r.courseData.is_valid?10:-1)}}function Si(e,o){if(e&1&&x(0,"tmf-option",14),e&2){let r=o.$implicit;u("value",r.value)("label",r.label)}}function Ti(e,o){if(e&1&&x(0,"tmf-option",14),e&2){let r=o.$implicit;u("value",r.value)("label",r.label)}}function Ei(e,o){if(e&1&&x(0,"tmf-option",14),e&2){let r=o.$implicit;u("value",r.main_category)("label",r.main_category||"")}}function Ii(e,o){if(e&1&&x(0,"tmf-option",14),e&2){let r=o.$implicit;u("value",r)("label",r)}}var bt=(()=>{let o=class o{get content(){return this.formGroup.controls[P.CONTENT]}get videoIds(){return this.courseData&&this.courseData.video_ids&&this.courseData.video_ids.length?this.courseData.video_ids:[]}get subTagOptions(){let t=this.formGroup.value.main_category;return this.tagOptions.find(i=>i.main_category===t)?.sub_category||[]}constructor(){this.teacherCourseService=b(we),this.commonService=b(ve),this.fileService=b(ye),this.uploadService=b(Te),this.fb=b(fe),this.dialogService=b(xe),this.mode=Me(),this.courseId=Me(),this.changeView=oe(),this.courseData=null,this.cityOptions=[],this.distOptions=[],this.tagOptions=[],this.formGroup=this.fb.group({name:this.fb.control(null),main_image:this.fb.control(null),content:this.fb.control(null),price_quantity:this.fb.control(null),main_category:this.fb.control(null),sub_category:this.fb.control(null),city_id:this.fb.control(null),dist_id:this.fb.control(null),survey_url:this.fb.control(null),status:this.fb.control(null),teacher_id:this.fb.control(null),purchase_message:this.fb.control(null),video_ids:this.fb.control([]),file_details:this.fb.control([]),file_url_details:this.fb.control([])}),this.ViewMode=M,this.CourseStatus=Y,this.CourseDetailFormKey=P,this.InputType=he,Ne(()=>{this.courseId()&&this.getCourse()}),Ne(()=>{this.mode()===M.View?this.formGroup.disable():this.formGroup.enable()})}ngOnInit(){this.initOptions(),this.handleValueChange()}handleValueChange(){this.formGroup.controls[P.CITY_ID].valueChanges.pipe(Ae(null),De(t=>{let i=this.formGroup.controls[P.DIST_ID];return t?(this.mode()!==M.View&&i.enable(),this.commonService.apiCommonOptionsDistPost({districtRequestModel:{is_oversea:!1,city_id:t}})):(i.reset(),i.disable(),ne(null))})).subscribe(t=>{t&&(this.distOptions=t.data)}),this.formGroup.controls[P.MAIN_CATEGORY].valueChanges.pipe(Ae(null)).subscribe(t=>{let i=this.formGroup.controls[P.SUB_CATEGORY];if(!t){i.reset(),i.disable();return}this.mode()!==M.View&&i.enable()})}handleSelectVideo(t){this.formGroup.controls[P.VIDEO_IDS].setValue(t)}initOptions(){this.commonService.apiCommonOptionsCityPost({cityRequestModel:{is_oversea:!1}}).subscribe(t=>this.cityOptions=t.data),this.commonService.apiCommonTagGet().subscribe(t=>{this.tagOptions=t.data})}getCourse(){this.teacherCourseService.apiTeacherCourseCoursesCourseIdGet({courseId:this.courseId()}).subscribe(t=>{this.courseData=t.data,this.setFormValues(this.courseData)})}save(){let t=this.formGroup.getRawValue(),i=t[P.FILE_DETAILS],c=(this.courseData?.file_details||[]).filter(V=>!i.some(X=>X.id===V.id)).filter(V=>V.fileId).map(V=>this.fileService.apiFileFileIdDelete({fileId:V.fileId})),C=i.filter(V=>V.file).map(V=>this.fileService.apiFilePost({file:V.file}).pipe(Oe(X=>V.fileId=X.data))),g=t[P.MAIN_IMAGE],G=typeof g!="string"&&g?this.uploadService.apiUploadFilePost({fileType:"image",path:"course",file:g}).pipe(Oe(V=>t.main_image=V.fileUrl)):ne(null),Fe=[...c,...C,G,ne(null)];He(Fe).pipe(De(()=>this.teacherCourseService.apiTeacherCourseCoursesDraftPost({postTeacherCourseDraftRequestModel:Ge(Q(Q({},this.courseId()?{_id:this.courseId()}:{}),t),{file_details:i.map(V=>({id:V.id||null,name:V.name,fileId:V.fileId||null}))})}))).subscribe(()=>this.getCourse())}reset(){this.courseData?this.setFormValues(this.courseData):this.formGroup.reset()}togglePublished(){if(!this.courseId())return;(this.courseData?.status===Y.PUBLISHED?this.teacherCourseService.apiTeacherCourseCoursesCourseIdUnpublishPost({courseId:this.courseId()}):this.teacherCourseService.apiTeacherCourseCoursesCourseIdPublishPost({courseId:this.courseId()})).subscribe({next:()=>{this.getCourse()},error:i=>{this.dialogService.openAlertDialog({title:"\u767C\u751F\u932F\u8AA4",content:i.error.message}).closed.subscribe(()=>this.getCourse())}})}setFormValues(t){let{name:i="",main_image:n="",content:c="",price_quantity:C=[],main_category:g=null,sub_category:G=null,city_id:Fe=null,dist_id:V=null,survey_url:X=null,status:xt=null,teacher_id:vt=null,purchase_message:yt=null,video_ids:wt=[],file_details:St=[],file_url_details:Tt=[]}=t;this.formGroup.setValue({name:i,main_image:n,content:c,price_quantity:C.map(k=>({_id:k._id||null,price:k.price||null,quantity:k.quantity||null})),main_category:g,sub_category:G,city_id:Fe,dist_id:V,survey_url:X,status:xt,teacher_id:vt,purchase_message:yt,video_ids:wt,file_details:St.map(k=>({id:k.id||null,name:k.name||null,fileId:k.fileId||null})),file_url_details:Tt.map(k=>({id:k.id||null,name:k.name||null,url:k.url||null}))})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["app-course-detail"]],inputs:{mode:[Re.SignalBased,"mode"],courseId:[Re.SignalBased,"courseId"]},outputs:{changeView:"changeView"},standalone:!0,features:[T],decls:37,vars:32,consts:[[1,"mb-5","flex","w-full","justify-between"],[1,"text-[22px]","font-bold","leading-9","md:text-[26px]","lg:text-[30px]"],[1,"flex","flex-col","items-end","gap-x-2","md:flex-row","md:items-center"],[1,"font-bold","leading-9"],[1,"flex","h-full","items-center","gap-1"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","p-1","text-white","md:px-3","md:py-2",3,"click"],[1,"material-symbols-outlined","text-[20px]","md:text-[22px]"],[1,"hidden","lg:block"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","p-1","text-white","md:px-3","md:py-2"],[3,"formGroup"],["label","\u8AB2\u7A0B\u540D\u7A31","placeholder","\u8ACB\u8F38\u5165\u8AB2\u7A0B\u540D\u7A31",3,"isRequired","formControlName","inputType"],["label","\u5B9A\u50F9","idKey","_id","itemKey1","price","itemLabel1","\u50F9\u683C","itemPlaceholder1","\u8ACB\u8F38\u5165\u50F9\u683C","itemType1","number","itemKey2","quantity","itemLabel2","\u5802\u6578","itemPlaceholder2","\u8ACB\u8F38\u5165\u5802\u6578","itemType2","number",1,"mb-6",3,"isRequired","formControlName"],[1,"mb-6","flex","items-end","gap-2"],["label","\u6388\u8AB2\u5730\u9EDE",3,"isRequired","formControlName"],[3,"value","label"],[3,"isRequired","formControlName"],["label","\u8AB2\u7A0B\u985E\u5225",3,"isRequired","formControlName"],["label","\u6587\u7AE0\u5167\u6587","height","400px",1,"mb-6",3,"contentChangeEvent","isRequired","diabled","defaultContent"],["label","\u8AB2\u7A0B\u77ED\u5F71\u7247",1,"mb-6",3,"selectVideoChange","disabled","videoIds","courseId","teacherId"],["label","\u6587\u7AE0\u5C01\u9762\u5716\u7247",1,"mb-6",3,"isRequired","formControlName"],["label","\u8CFC\u8CB7\u6210\u529F\u8A0A\u606F",1,"mb-6",3,"isRequired","formControlName"],["label","\u8AB2\u7A0B\u6A94\u6848",1,"mb-6",3,"formControlName"],["label","\u8AB2\u7A0B\u6A94\u6848\u9023\u7D50","idKey","id","itemKey1","name","itemLabel1","\u6A94\u6848\u540D\u7A31","itemPlaceholder1","\u8ACB\u8F38\u5165\u6A94\u6848\u540D\u7A31","itemKey2","url","itemLabel2","\u6A94\u6848\u9023\u7D50","itemPlaceholder2","\u8ACB\u8F38\u5165\u6A94\u6848\u9023\u7D50",1,"mb-6",3,"formControlName"],["label","\u8AB2\u524D\u8AEE\u8A62\u554F\u5238\u9023\u7D50","placeholder","\u8ACB\u8F38\u5165\u8AB2\u524D\u8AEE\u8A62\u554F\u5238\u9023\u7D50",3,"isRequired","formControlName","inputType"],[3,"ngClass"],[1,"material-symbols-outlined","-scale-x-100","text-[20px]","md:text-[22px]"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","p-1","text-white","md:px-3","md:py-2",3,"ngClass"],[1,"flex","items-center","gap-2","rounded-md","bg-tmf-orange-1","p-1","text-white","md:px-3","md:py-2",3,"click","ngClass"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"h1",1),d(2," \u8AB2\u7A0B\u7BA1\u7406 "),l(),a(3,"div",2),_(4,xi,4,5,"p",3),a(5,"div",4)(6,"button",5),p("click",function(){return n.changeView.emit({mode:n.ViewMode.List})}),a(7,"span",6),d(8," reply "),l(),a(9,"span",7),d(10," \u8FD4\u56DE "),l()(),_(11,vi,4,0,"button",8)(12,wi,11,1),l()()(),a(13,"form",9),x(14,"tmf-input",10)(15,"app-dynamic-input-list",11),a(16,"div",12)(17,"tmf-select",13),O(18,Si,1,2,"tmf-option",14,D),l(),a(20,"tmf-select",15),O(21,Ti,1,2,"tmf-option",14,D),l()(),a(23,"div",12)(24,"tmf-select",16),O(25,Ei,1,2,"tmf-option",14,D),l(),a(27,"tmf-select",15),O(28,Ii,1,2,"tmf-option",14,D),l()(),a(30,"tmf-quill-editor",17),p("contentChangeEvent",function(C){return n.content.setValue(C)}),l(),a(31,"app-video-list",18),p("selectVideoChange",function(C){return n.handleSelectVideo(C)}),l(),x(32,"tmf-image-upload",19)(33,"tmf-textarea",20)(34,"app-file-uploader",21)(35,"app-dynamic-input-list",22)(36,"tmf-input",23),l()),i&2&&(s(4),y(4,(n.mode()===n.ViewMode.Edit||n.mode()===n.ViewMode.Create)&&n.courseData?4:-1),s(7),y(11,n.mode()===n.ViewMode.View&&n.courseData&&n.courseData.status!==n.CourseStatus.PUBLISHED?11:n.mode()===n.ViewMode.Edit||n.mode()===n.ViewMode.Create?12:-1),s(2),u("formGroup",n.formGroup),s(),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.NAME)("inputType",n.InputType.Outline),s(),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.PRICE_QUANTITY),s(2),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.CITY_ID),s(),R(n.cityOptions),s(2),u("isRequired",!1)("formControlName",n.CourseDetailFormKey.DIST_ID),s(),R(n.distOptions),s(3),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.MAIN_CATEGORY),s(),R(n.tagOptions),s(2),u("isRequired",!1)("formControlName",n.CourseDetailFormKey.SUB_CATEGORY),s(),R(n.subTagOptions),s(2),u("isRequired",!0)("diabled",n.content.disabled)("defaultContent",(n.courseData==null?null:n.courseData.content)||""),s(),u("disabled",n.formGroup.get(n.CourseDetailFormKey.VIDEO_IDS).disabled)("videoIds",n.videoIds)("courseId",n.courseId()||"")("teacherId",(n.courseData==null?null:n.courseData.teacher_id)||""),s(),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.MAIN_IMAGE),s(),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.PURCHASE_MESSAGE),s(),u("formControlName",n.CourseDetailFormKey.FILE_DETAILS),s(),u("formControlName",n.CourseDetailFormKey.FILE_URL_DETAILS),s(),u("isRequired",!0)("formControlName",n.CourseDetailFormKey.SURVEY_URL)("inputType",n.InputType.Outline))},dependencies:[I,F,J,tt,$,se,ce,me,_e,Ce,ge,Ve,st,mt,ht,_t,Ct],styles:["[_nghost-%COMP%]{display:block}"]});let e=o;return e})();function Vi(e,o){if(e&1){let r=v();a(0,"app-course-table",0),p("changeView",function(i){f(r);let n=m();return h(n.handleChangeView(i))}),l()}}function Fi(e,o){if(e&1){let r=v();a(0,"app-course-detail",1),p("changeView",function(i){f(r);let n=m();return h(n.handleChangeView(i))}),l()}if(e&2){let r=m();u("mode",r.mode())("courseId",r.currentCourseId())}}var M=function(e){return e.List="list",e.View="view",e.Edit="edit",e.Create="create",e}(M||{}),xo=(()=>{let o=class o{constructor(){this.mode=Z(M.List),this.currentCourseId=Z(null),this.ViewMode=M}handleChangeView(t){this.mode.set(t.mode),t.courseId&&this.currentCourseId.set(t.courseId)}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["app-teacher-courses-page"]],standalone:!0,features:[T],decls:2,vars:1,consts:[[3,"changeView"],[3,"changeView","mode","courseId"]],template:function(i,n){i&1&&_(0,Vi,1,0,"app-course-table")(1,Fi,1,2),i&2&&y(0,n.mode()===n.ViewMode.List?0:1)},dependencies:[I,ut,bt],styles:["[_nghost-%COMP%]{display:block}"]});let e=o;return e})();export{M as ViewMode,xo as default};

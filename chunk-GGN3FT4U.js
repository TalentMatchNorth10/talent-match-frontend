import{a as J}from"./chunk-WCPI2NXP.js";import"./chunk-WE7DUPO4.js";import{a as q}from"./chunk-QGAZUIWH.js";import{a as G,g as N}from"./chunk-SWYI2ROI.js";import{a as z}from"./chunk-TG64K5S4.js";import"./chunk-TGEFNR3I.js";import"./chunk-O2MZCC7V.js";import"./chunk-7REWYPIF.js";import"./chunk-7PEPFG7H.js";import{k as O,v as U}from"./chunk-OU7DBEEA.js";import{$ as f,Bb as a,Cb as I,Db as v,Ea as B,Eb as R,Ia as d,Kb as V,Mb as j,Rb as M,Sb as $,Ua as A,V as D,_a as S,ab as g,ea as k,eb as b,fb as y,hb as E,ib as P,jb as o,kb as s,lb as w,na as x,oa as C,pb as F,sb as h,tb as l}from"./chunk-ZYASN54F.js";import{a as m,b as _}from"./chunk-CWTPBX7D.js";var W=(()=>{let i=class i{constructor(){this.purchasedCourses=A([]),this.purchasedCoursesSig=this.purchasedCourses.asReadonly()}updatePurchasedCourses(r){this.purchasedCourses.set(r)}};i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"});let e=i;return e})();var Q=e=>({expanded:e});function X(e,i){e&1&&a(0," \u5F85\u78BA\u8A8D ")}function Y(e,i){e&1&&a(0," \u5DF2\u5B8C\u8AB2 ")}function Z(e,i){e&1&&a(0," \u5DF2\u8A55\u50F9 ")}function ee(e,i){e&1&&a(0," \u5DF2\u9810\u7D04 ")}function te(e,i){if(e&1){let t=F();o(0,"button",25),h("click",function(){x(t);let n=l().$implicit,u=l().$implicit,c=l();return C(c.completeCourse(n.reserve_id,u))}),a(1," \u5B8C\u6210\u8AB2\u7A0B "),s()}}function ie(e,i){if(e&1){let t=F();o(0,"button",26),h("click",function(){x(t);let n=l().$implicit,u=l().$implicit,c=l();return C(c.openReviewDialog(u,n))}),a(1," \u7D66\u4E88\u8A55\u50F9 "),s()}}function ne(e,i){e&1&&w(0,"p",27)}function re(e,i){if(e&1&&(o(0,"li",17)(1,"p",22),a(2),M(3,"tmfDateTime"),s(),o(4,"p",23),S(5,X,1,0)(6,Y,1,0)(7,Z,1,0)(8,ee,1,0),s(),S(9,te,2,0,"button",24)(10,ie,2,0)(11,ne,1,0),s()),e&2){let t=i.$implicit;d(2),v(" ",$(3,3,t.reserve_time)," "),d(3),b(5,t.teacher_status==="completed"&&t.student_status==="reserved"?5:t.teacher_status==="completed"&&t.student_status==="completed"&&!t.review?6:t.teacher_status==="completed"&&t.student_status==="completed"&&t.review?7:8),d(4),b(9,t.teacher_status!=="reserved"&&t.student_status==="reserved"?9:t.teacher_status!=="reserved"&&t.student_status!=="reserved"&&!t.review?10:11)}}function oe(e,i){e&1&&(o(0,"li",18)(1,"p"),a(2,"\u5C1A\u7121\u9810\u7D04\u8AB2\u7A0B"),s()())}function se(e,i){e&1&&(o(0,"span",21),a(1," arrow_drop_up "),s())}function ae(e,i){e&1&&(o(0,"span",21),a(1," arrow_drop_down "),s())}function ue(e,i){if(e&1){let t=F();o(0,"div",2)(1,"div",3),w(2,"img",4),o(3,"div",5)(4,"h2",6),a(5),s(),o(6,"p"),a(7),s(),o(8,"div",7)(9,"p"),a(10),s(),o(11,"div",8),w(12,"tmf-star-rating",9),s(),o(13,"p"),a(14),s()(),o(15,"p",10),a(16),s(),o(17,"div",11)(18,"button",12),a(19," \u67E5\u770B\u6559\u6750 "),s(),o(20,"button",13),h("click",function(){let n=x(t).$implicit,u=l();return C(u.openReserrveDialog(n))}),a(21," \u9810\u7D04\u4E0A\u8AB2 "),s()()()(),o(22,"div",14)(23,"div",15)(24,"ul",16),E(25,re,12,5,"li",17,y,!1,oe,3,0,"li",18),s()()(),o(28,"div",19),h("click",function(){let n=x(t).$implicit;return C(n.isExpanded=!n.isExpanded)}),o(29,"div",20),S(30,se,2,0,"span",21)(31,ae,2,0),s()()()}if(e&2){let t=i.$implicit;d(2),g("src",t.main_image,B),d(3),v(" ",t.course_name," "),d(2),R(" ",t.main_category,"\uFF5C",t.city_id," "),d(3),I(t.teacher_name),d(2),g("starSize","20px")("rating",t.course_rate),d(2),v("( ",t.review_count," )"),d(2),v(" \u5269\u9918 ",t.remain_quantity," \u5802 "),d(4),g("disabled",t.remain_quantity===0),d(2),g("ngClass",j(13,Q,t.isExpanded)),d(3),P(t.reserved_course),d(5),b(30,t.isExpanded?30:31)}}var be=(()=>{let i=class i{constructor(){this.studentService=f(N),this.dialogService=f(J),this.studetnCourseService=f(W),this.studentReservationService=f(G),this.purchasedCourses=this.studetnCourseService.purchasedCoursesSig,this.isExpanded=!1}ngOnInit(){this.studentService.apiStudentPurchasedCoursesGet().subscribe(r=>{r.data?.purchased_courses&&this.studetnCourseService.updatePurchasedCourses(r.data?.purchased_courses.map(n=>_(m({},n),{isExpanded:!1})))})}openReserrveDialog(r){let{course_id:n,teacher_id:u,course_name:c}=r,{id:p}=this.decodeJWT(localStorage.getItem("access_token")||sessionStorage.getItem("access_token")||"");this.dialogService.openReserveDialog({student_id:p,course_id:n,teacher_id:u,course_name:c}).subscribe(H=>{H&&this.studentService.apiStudentPurchasedCoursesGet().subscribe(T=>{T.data?.purchased_courses&&this.studetnCourseService.updatePurchasedCourses(T.data?.purchased_courses.map(K=>_(m({},K),{isExpanded:!1})))})})}decodeJWT(r){let u=r.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),c=decodeURIComponent(atob(u).split("").map(function(p){return"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(c)}completeCourse(r,n){this.dialogService.openConfirmDialog({title:"\u78BA\u8A8D",content:"\u662F\u5426\u78BA\u8A8D\u5B8C\u6210\u6B64\u8AB2\u7A0B\uFF1F",btnType:"primary"}).subscribe(u=>{u&&this.updateCourseStatus(r,n)})}updateCourseStatus(r,n){this.studentReservationService.apiStudentReservationStatusUpdatePatch({statusUpdateRequestModel:{reservation_id:r,update_status:"completed"}}).subscribe(()=>{this.studentService.apiStudentPurchasedCoursesGet().subscribe(u=>{u.data?.purchased_courses&&this.studetnCourseService.updatePurchasedCourses(u.data?.purchased_courses.map(c=>_(m({},c),{isExpanded:c.course_id===n.course_id&&n.isExpanded})))})})}openReviewDialog(r,n){this.dialogService.openReviewDialog({purchasedCourse:r,reserve:n}).closed.subscribe(u=>{u&&this.studentService.apiStudentPurchasedCoursesGet().subscribe(c=>{c.data?.purchased_courses&&this.studetnCourseService.updatePurchasedCourses(c.data?.purchased_courses.map(p=>_(m({},p),{isExpanded:r.isExpanded})))})})}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=k({type:i,selectors:[["app-student-courses-page"]],standalone:!0,features:[V],decls:5,vars:0,consts:[[1,"mb-6","text-3xl","font-bold","text-tmf-gray-2"],[1,"flex","flex-col","gap-5"],[1,"relative","rounded-lg","border","border-tmf-gray-4","p-4","shadow-md"],[1,"flex","gap-4"],["alt","",1,"h-[166px]","w-[250px]","rounded-md",3,"src"],[1,"flex","flex-grow","flex-col","gap-1"],[1,"text-2xl","text-tmf-gray-2"],[1,"flex","items-center","gap-2"],[1,"felx","items-center"],[3,"starSize","rating"],[1,"text-right","text-lg"],[1,"flex","items-center","justify-end","gap-4"],[1,"rounded-lg","border","border-tmf-gray-4","bg-white","px-4","py-2","text-tmf-gray-2"],[1,"rounded-lg","bg-tmf-orange-1","px-4","py-2","text-white","disabled:bg-tmf-gray-5",3,"click","disabled"],[1,"content",3,"ngClass"],[1,"inside"],[1,"flex","flex-col","gap-4","px-4","text-tmf-gray-2"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","justify-center"],[1,"absolute","cursor-pointer","-bottom-4","left-1/2","h-8","w-8","-translate-x-1/2","rounded-full","border","border-tmf-gray-4","bg-white",3,"click"],[1,"flex","h-full","w-full","items-center","justify-center"],[1,"material-symbols-outlined","text-[32px]","leading-8"],[1,"min-w-[9.375rem]"],[1,"min-w-[3.75rem]"],[1,"min-w-24","rounded-md","bg-tmf-orange-1","px-4","py-1","text-center","text-white"],[1,"min-w-24","rounded-md","bg-tmf-orange-1","px-4","py-1","text-center","text-white",3,"click"],[1,"min-w-24","rounded-md","bg-tmf-purple","px-4","py-1","text-center","text-white",3,"click"],[1,"min-w-24"]],template:function(n,u){n&1&&(o(0,"h1",0),a(1,"\u5DF2\u8CFC\u8CB7\u8AB2\u7A0B"),s(),o(2,"div",1),E(3,ue,32,15,"div",2,y),s()),n&2&&(d(3),P(u.purchasedCourses()))},dependencies:[U,O,z,q],styles:[".grid-cols-custom[_ngcontent-%COMP%]{grid-template-columns:50px 1fr 1fr 1fr 1fr 1fr 1fr 1fr}.content[_ngcontent-%COMP%]{display:grid;grid-template-rows:0fr;transition:.2s;overflow:hidden}.content[_ngcontent-%COMP%]   .inside[_ngcontent-%COMP%]{min-height:0}.content.expanded[_ngcontent-%COMP%]{grid-template-rows:1fr;padding-top:16px;padding-bottom:16px}"]});let e=i;return e})();export{be as default};
